(window.webpackJsonp=window.webpackJsonp||[]).push([[12,25],{"0RDm":function(t,e,a){},1:function(t,e){},2:function(t,e){},"45Hi":function(t,e,a){t.exports=a.p+"static/img/tdt-vec.png"},"5Ynx":function(t,e,a){},"5zrt":function(t,e,a){t.exports=a.p+"static/img/tdt-ter.png"},"9/5/":function(n,t,e){!function(t){function b(){return a.Date.now()}var r=NaN,i="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,p=parseInt,e="object"==typeof t&&t&&t.Object===Object&&t,t="object"==typeof self&&self&&self.Object===Object&&self,a=e||t||Function("return this")(),u=Object.prototype.toString,v=Math.max,O=Math.min;function I(t){var e=typeof t;return t&&("object"==e||"function"==e)}function w(t){if("number"==typeof t)return t;if("symbol"==typeof(e=t)||!!(a=e)&&"object"==typeof a&&u.call(e)==i)return r;var e,a;if("string"!=typeof(t=I(t)?I(n="function"==typeof t.valueOf?t.valueOf():t)?n+"":n:t))return 0===t?t:+t;t=t.replace(o,"");var n=c.test(t);return n||l.test(t)?p(t.slice(2),n?2:8):s.test(t)?r:+t}n.exports=function(n,a,t){var r,i,o,s,c,l,p=0,u=!1,m=!1,e=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function d(t){var e=r,a=i;return r=i=void 0,p=t,s=n.apply(a,e)}function h(t){var e=t-l;return void 0===l||a<=e||e<0||m&&o<=t-p}function f(){var t,e=b();if(h(e))return g(e);c=setTimeout(f,(e=a-((t=e)-l),m?O(e,o-(t-p)):e))}function g(t){return c=void 0,e&&r?d(t):(r=i=void 0,s)}function y(){var t=b(),e=h(t);if(r=arguments,i=this,l=t,e){if(void 0===c)return p=e=l,c=setTimeout(f,a),u?d(e):s;if(m)return c=setTimeout(f,a),d(l)}return void 0===c&&(c=setTimeout(f,a)),s}return a=w(a)||0,I(t)&&(u=!!t.leading,m="maxWait"in t,o=m?v(w(t.maxWait)||0,a):o,e="trailing"in t?!!t.trailing:e),y.cancel=function(){void 0!==c&&clearTimeout(c),r=l=i=c=void(p=0)},y.flush=function(){return void 0===c?s:g(b())},y}}.call(this,e("yLpj"))},"9ad+":function(t,e,a){t.exports=a.p+"static/img/tdt-img.png"},FzCa:function(t,e,a){},GAzf:function(t,e,a){"use strict";var n=a("4zwu"),r=a("FuRH"),i=a("3Dh3"),o=a("+NyJ");e.a={data:function(){return{listenMapLoad:!1}},computed:{dataIds:function(){return this.component.dataIds||[]},dataId:function(){return this.dataIds[0]},currentDataCache:function(){return this.$store.getters.getDataCache(this.dataId)},components:function(){return this.$store.getters.components},componentType:function(){return this.component.componentType},mapTarget:function(){return this.component.propDatas.mapTarget},currentProps:function(){var t,e;return"server"===(t=this.renderProps).dataType&&0<this.dataIds.length&&(e=this.getValueProps(t),Object.assign(t,e)),t},labelConfig:function(){return Object(o.f)(this.component.componentId,this.dataId)}},beforeCreate:function(){this.watcher=[]},mounted:function(){this.listenMapLoad&&r.a.$on("load-map",this.loadMapSucceed)},beforeDestroy:function(){this.listenMapLoad&&r.a.$off("load-map",this.loadMapSucceed)},methods:{cleanWatcher:function(){this.watcher.forEach(function(t){t()}),this.watcher=[]},loadMapSucceed:function(t,e){e===this.mapTarget&&this.loadMap(e)},loadMap:function(){},getValueProps:function(t){var e=this.getFeatureId(this.dataId),e=this.currentDataCache&&this.currentDataCache.type&&-1!==this.currentDataCache.type.indexOf("time")&&t.filterCategoryValue?n.a.$options.getDataByCategory(this.currentDataCache,[t.filterCategoryValue])||{}:n.a.$options.getData(e)||{};return this.updateDataPropsHandler(t,{features:e})},getValueByField:function(t,e){var a=this.currentDataCache&&this.currentDataCache.type&&-1!==this.currentDataCache.type.indexOf("time"),t=t&&t.features&&t.features.features,a=a?t&&t.length-1:0,e=t&&0<=a&&t[a]&&t[a].properties[e];return e||0===e?e.toString():""},hasField:function(t,e){return t&&t.features&&t.features.features[0]&&t.features.features[0].properties.hasOwnProperty(e)},getFeatureId:function(t){return Object(i.f)(this.$store.getters.getDataCache,t)}}}},Lb6U:function(t,e,a){"use strict";e.a={highlight:"featureSelection"}},MYbg:function(t,e,a){"use strict";a("0RDm")},OcSP:function(t){t.exports=JSON.parse('[{"name":"jiuzhaigou","thumbnail":"static/templates/img/jiuzhaigou.png","templatePath":"static/templates/jiuzhaigou.json"},{"name":"wisdomPark","thumbnail":"static/templates/img/wisdomPark.png","templatePath":"static/templates/wisdom-park.json"},{"name":"citySmartCityOverview","thumbnail":"static/templates/img/city-smart-city-overview.png","templatePath":"static/templates/city-smart-city-overview.json"},{"name":"citySmartCityManagement","thumbnail":"static/templates/img/city-smart-city-management.png","templatePath":"static/templates/city-smart-city-management.json"},{"name":"citySmartCityEconomy","thumbnail":"static/templates/img/city-smart-city-economy.png","templatePath":"static/templates/city-smart-city-economy.json"},{"name":"citySmartCityLivelihood","thumbnail":"static/templates/img/city-smart-city-livelihood.png","templatePath":"static/templates/city-smart-city-livelihood.json"},{"name":"seventhCensus","thumbnail":"static/templates/img/seventh-census.png","templatePath":"static/templates/seventh-census.json"},{"name":"securityMonitoring","thumbnail":"static/templates/img/securityMonitoring.png","templatePath":"static/templates/security-monitoring.json"},{"name":"NatureResourcePlatform","thumbnail":"static/templates/img/resource.png","templatePath":"static/templates/natureResource.json"},{"name":"EcologicalBigDataPlatform","thumbnail":"static/templates/img/ecological-big-data-platform.png","templatePath":"static/templates/ecological-big-data-platform.json"},{"name":"Interaction","thumbnail":"static/templates/img/interaction.png","templatePath":"static/templates/interaction.json"},{"name":"TrackPlayback","thumbnail":"static/templates/img/track-playback.png","templatePath":"static/templates/track-playback.json"},{"name":"MultiMap-Interaction","thumbnail":"static/templates/img/multi-map-interaction.png","templatePath":"static/templates/multi-map-interaction.json"},{"name":"operationMonitoring","thumbnail":"static/templates/img/operation-monitoring.png","templatePath":"static/templates/operation-monitoring.json"},{"name":"Ncp","thumbnail":"static/templates/img/ncp.png","templatePath":"static/templates/ncp.json"},{"name":"SuperMap Building","thumbnail":"static/templates/img/supermap-building.png","templatePath":"static/templates/supermap.json"},{"name":"Qixiang Cloud","thumbnail":"static/templates/img/qixiang-cloud.png","templatePath":"static/templates/qixiang-cloud.json"},{"name":"NcpSwitch","thumbnail":"static/templates/img/ncp-switch1.png","templatePath":"static/templates/ncp-switch.json"},{"name":"NcpGlobal","thumbnail":"static/templates/img/ncp-global.png","templatePath":"static/templates/ncp-global.json"},{"name":"NcpTimeline","thumbnail":"static/templates/img/ncp-timeline.png","templatePath":"static/templates/ncp-timeline.json"},{"name":"NcpCompare","thumbnail":"static/templates/img/ncp-compare.png","templatePath":"static/templates/ncp-compare.json"},{"name":"LandUse","thumbnail":"static/templates/img/landuse.png","templatePath":"static/templates/landuse.json"},{"name":"RealEstateMonitoring","thumbnail":"static/templates/img/estatemonitor.png","templatePath":"static/templates/estatemonitor.json"},{"name":"tianditu","thumbnail":"static/templates/img/tianditu.png","templatePath":"static/templates/tianditu.json"},{"name":"travelMonitoring","thumbnail":"static/templates/img/travel-monitoring.png","templatePath":"static/templates/travel-monitoring.json"},{"name":"businessRevenue","thumbnail":"static/templates/img/business-revenue.png","templatePath":"static/templates/business-revenue.json"}]')},QDzv:function(t,e,a){"use strict";a("R4ge")},R4ge:function(t,e,a){},SknJ:function(t,e,a){"use strict";a("5Ynx")},"YY/H":function(G,t,e){!function(t){var n="__lodash_hash_undefined__",a=9007199254740991,r="[object Arguments]",e="[object Function]",i="[object GeneratorFunction]",o=/^\[object .+?Constructor\]$/,s="object"==typeof t&&t&&t.Object===Object&&t,c="object"==typeof self&&self&&self.Object===Object&&self,l=s||c||Function("return this")();function h(t,e){return!!(t?t.length:0)&&-1<function(t,e,a){if(e!=e)return function(t,e,a,n){var r=t.length,i=a+(n?1:-1);for(;n?i--:++i<r;)if(e(t[i],i,t))return i;return-1}(t,p,a);var n=a-1,r=t.length;for(;++n<r;)if(t[n]===e)return n;return-1}(t,e,0)}function f(t,e,a){for(var n=-1,r=t?t.length:0;++n<r;)if(a(e,t[n]))return!0;return!1}function p(t){return t!=t}function g(t,e){return t.has(e)}var u=Array.prototype,t=Function.prototype,s=Object.prototype,c=l["__core-js_shared__"],m=(c=/[^.]+$/.exec(c&&c.keys&&c.keys.IE_PROTO||""))?"Symbol(src)_1."+c:"",d=t.toString,y=s.hasOwnProperty,b=s.toString,v=RegExp("^"+d.call(y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),t=l.Symbol,O=s.propertyIsEnumerable,I=u.splice,w=t?t.isConcatSpreadable:void 0,S=Math.max,M=N(l,"Map"),_=N(Object,"create");function T(t){var e=-1,a=t?t.length:0;for(this.clear();++e<a;){var n=t[e];this.set(n[0],n[1])}}function C(t){var e=-1,a=t?t.length:0;for(this.clear();++e<a;){var n=t[e];this.set(n[0],n[1])}}function k(t){var e=-1,a=t?t.length:0;for(this.clear();++e<a;){var n=t[e];this.set(n[0],n[1])}}function D(t){var e=-1,a=t?t.length:0;for(this.__data__=new k;++e<a;)this.add(t[e])}function P(t,e){for(var a,n,r=t.length;r--;)if((a=t[r][0])===(n=e)||a!=a&&n!=n)return r;return-1}function j(t,e,a,n){var r,i=-1,o=h,s=!0,c=t.length,l=[],p=e.length;if(!c)return l;a&&(e=function(t,e){for(var a=-1,n=t?t.length:0,r=Array(n);++a<n;)r[a]=e(t[a],a,t);return r}(e,(r=a,function(t){return r(t)}))),n?(o=f,s=!1):200<=e.length&&(o=g,s=!1,e=new D(e));t:for(;++i<c;){var u=t[i],m=a?a(u):u,u=n||0!==u?u:0;if(s&&m==m){for(var d=p;d--;)if(e[d]===m)continue t;l.push(u)}else o(e,m,n)||l.push(u)}return l}function x(t,e,a,n,r){var i=-1,o=t.length;for(a=a||E,r=r||[];++i<o;){var s=t[i];0<e&&a(s)?1<e?x(s,e-1,a,n,r):function(t,e){for(var a=-1,n=e.length,r=t.length;++a<n;)t[r+a]=e[a]}(r,s):n||(r[r.length]=s)}return r}function L(t){var e;return K(t)&&(e=t,!(m&&m in e))&&(B(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?v:o).test(function(t){if(null!=t){try{return d.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function $(t,e){var a,n=t.__data__;return("string"==(t=typeof(a=e))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==a:null===a)?n["string"==typeof e?"string":"hash"]:n.map}function N(t,e){e=e,e=null==(t=t)?void 0:t[e];return L(e)?e:void 0}function E(t){return F(t)||R(e=t)&&y.call(e,"callee")&&(!O.call(e,"callee")||b.call(e)==r)||!!(w&&t&&t[w]);var e}T.prototype.clear=function(){this.__data__=_?_(null):{}},T.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},T.prototype.get=function(t){var e=this.__data__;if(_){var a=e[t];return a===n?void 0:a}return y.call(e,t)?e[t]:void 0},T.prototype.has=function(t){var e=this.__data__;return _?void 0!==e[t]:y.call(e,t)},T.prototype.set=function(t,e){return this.__data__[t]=_&&void 0===e?n:e,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(t){var e=this.__data__;return!((t=P(e,t))<0)&&(t==e.length-1?e.pop():I.call(e,t,1),!0)},C.prototype.get=function(t){var e=this.__data__;return(t=P(e,t))<0?void 0:e[t][1]},C.prototype.has=function(t){return-1<P(this.__data__,t)},C.prototype.set=function(t,e){var a=this.__data__,n=P(a,t);return n<0?a.push([t,e]):a[n][1]=e,this},k.prototype.clear=function(){this.__data__={hash:new T,map:new(M||C),string:new T}},k.prototype.delete=function(t){return $(this,t).delete(t)},k.prototype.get=function(t){return $(this,t).get(t)},k.prototype.has=function(t){return $(this,t).has(t)},k.prototype.set=function(t,e){return $(this,t).set(t,e),this},D.prototype.add=D.prototype.push=function(t){return this.__data__.set(t,n),this},D.prototype.has=function(t){return this.__data__.has(t)};var A,z,l=(A=function(t,e){return R(t)?j(t,x(e,1,R,!0)):[]},z=S(void 0===z?A.length-1:z,0),function(){for(var t=arguments,e=-1,a=S(t.length-z,0),n=Array(a);++e<a;)n[e]=t[z+e];for(var e=-1,r=Array(z+1);++e<z;)r[e]=t[e];return r[z]=n,function(t,e,a){switch(a.length){case 0:return t.call(e);case 1:return t.call(e,a[0]);case 2:return t.call(e,a[0],a[1]);case 3:return t.call(e,a[0],a[1],a[2])}return t.apply(e,a)}(A,this,r)});var F=Array.isArray;function U(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=a)&&!B(t);var e}function R(t){return!!(e=t)&&"object"==typeof e&&U(t);var e}function B(t){t=K(t)?b.call(t):"";return t==e||t==i}function K(t){var e=typeof t;return t&&("object"==e||"function"==e)}G.exports=l}.call(this,e("yLpj"))},aXEy:function(t,e,a){"use strict";a.r(e);var n=a("hdLw"),d=a.n(n),r=(a("xKWM"),a("oUIn")),h=a("QCDS"),u=a("3Dh3"),i=a("GAzf"),o=a("zT9C"),f=a.n(o),s=a("wd/R"),g=a.n(s),c=a("YY/H"),m=a.n(c),y=a("FuRH"),b=a("M7pi"),v=a("wyqS");function l(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function O(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){var e,a;e=n,t=r[a=t],a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function p(t){var n,r,i,o,e,a=t.layerNames,s=t.mapTarget,c=t.dataCache,l=t.transformSucceeded,p=t.getFeaturesSucceeded;a instanceof Array&&(n=y.a.$options.getWebMap(s)||{},r=n._layers,i=[],o=[],a.forEach(function(e){var t,c,l,p,u,m,d,a=r.find(function(t){return t.layerID===e});a&&(o.push((a=(t={layer:a,webMap:n,mapTarget:s}).layer,c=t.webMap,l=t.mapName,p=t.mapTarget,u=a.dataSource,m=a.layerID,d=(u||{}).serverId||a.serverId,new Promise(function(e){var a={dataInfo:{name:m,displayName:"".concat(l||c.mapParams.title,"-").concat(m),mapTarget:p},frequency:2,timing:!1},t=u||{},n=t.type,r=t.dataSourceName,i=t.url,o=t.layerName,s=t.accessType;-1!==["REST_DATA","REST_MAP"].indexOf(n)?(n={type:"iServer",withCredentials:!1,url:i},o&&(n.layerName=o),r&&(n.dataName=[r]),n.id=i+(o||r||""),a.hashId=n.id,a.proxy="",Object.assign(a.dataInfo,n),e(a)):d?Object(v.d)("".concat(c.serverUrl,"web/datas/").concat(d),c.withCredentials).then(function(t){t={type:"iPortal",id:d,url:t.url,dataType:t.dataType,updateTime:g()(t.lastModfiedTime).format("YYYY-MM-DD HH:mm:ss"),serviceStatus:t.serviceStatus,dataItemServices:t.dataItemServices,withCredentials:!0,preferContent:"DIRECT"===s};a.hashId=d.toString(),a.proxy="",Object.assign(a.dataInfo,t),e(a)},function(){return e()}):e()}))),i.push(e))}),e=m()(a,i),o&&o.length&&Promise.all(o).then(function(t){t=b.a.deduplicateData(t);t.forEach(function(s){s.dataInfo.attributeFilter||(s.dataInfo.attributeFilter="SmID>0"),s.dataInfo.maxFeatures||(s.dataInfo.maxFeatures=8),Object(v.a)(O(O({},s.dataInfo),{},{proxy:s.proxy}),function(t){var e,a=t.features,n=t.fields,r=t.fieldCaptions,i=t.fieldValues,o=t.transformed,t=t.error;a&&!t||(e="failed"),c[s.hashId]||p&&p(O(O({},s),{},{status:e}),{features:a,fields:n,fieldCaptions:r,fieldValues:i,transformed:o})})});t=Object(u.a)(t.map(function(t){return t.dataInfo||{}})),t=Object.assign(t,{layerNames:e});l&&l(t)}))}var n={computed:{layerNames:function(){var t=this.component.propDatas,e=t.searchControl,a=t.layerNames;return(void 0===e?{}:e).layerNames||a}},created:function(){this.layerNames&&this.layerNames.length&&(this.listenMapLoad=!0)},methods:{loadMap:function(){p({layerNames:this.layerNames,mapTarget:this.mapTarget,dataCache:this.$store.getters.dataCache,transformSucceeded:this.updateSearchProps,getFeaturesSucceeded:this.addDataCache})},dispatchUpdateDataProps:function(t){this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.component.componentId,propDatas:t})},updateSearchProps:function(t){var e,a=f()(this.component.propDatas),n=a.searchControl||a;for(e in t){var r,i,o=t[e];"layerNames"===e?n[e]=o:0<o.length&&(r=n[e],i=n.dataIds||[],n[e]=r?r.concat(o):o,o=Array.from(new Set(i.concat(o.map(function(t){return t.hashId})))),n.dataIds=o)}this.dispatchUpdateDataProps(a)},addDataCache:function(t,e){this.$store.dispatch("ADD_DATA",{dataInfo:t,data:e})}}},I=a("qAG6"),w=a("4zwu");function S(t){return function(t){if(Array.isArray(t))return M(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return M(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(a="Object"===a&&t.constructor?t.constructor.name:a)||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?M(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function _(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function T(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach(function(t){var e,a;e=n,t=r[a=t],a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var o={mixins:[i.a,n],computed:{layerDataIds:function(){var t={};if(this.dataIds)for(var e in this.dataIds)"searchControl"!==e&&"queryControl"!==e&&this.dataIds[e]&&0<this.dataIds[e].length&&(t[e]=this.dataIds[e]);return t},currentProps:function(){var t;return(t=this.defaultParams.props).layers=this.getFilterLayerFeatures(),t.trackLayers=this.getTrackLayersFeatures(),t},layerDataCache:function(){var a=this;return function(t,e){t=a.$store.getters.getDataCache(t)||{};return Object.assign({},t,a.filterActionData[e]||{})}}},watch:{dataIds:{handler:function(t,e){var n=this;if(this.cleanWatcher(),this.dataProps={},this.dataIds)for(var a in this.dataIds)!function(a){var t=n.dataIds[a];t?t.forEach(function(t){n.watcher.push(n.$watch(function(){return n.$store.getters.getDataIdFromDataCache(t)},function(t,e){!t&&!e&&n.component.componentId||t===e||n.handleWebMapUpdate(a)},{deep:!0,immediate:!0}))}):e&&e[a]&&n.resetWebMapInfo(),"trackLayers"===a&&n.resetTrackLayers(n.dataIds.trackLayers,e&&e.trackLayers)}(a)},immediate:!0},"currentProps.layersIdField":function(t,e){var a;if(t)for(var n in t)e&&t[n]!==e[n]&&((a=a||{})[n]=t[n]);a&&this.updateMapSelfLayers()}},methods:{handleWebMapUpdate:function(t){"searchControl"!==t&&"queryControl"!==t&&(this.getFilterLayerFeatures(),this.getTrackLayersFeatures())},getLayerFeatures:function(){var t,n=this,r={};for(t in this.layerDataIds)!function(a){n.layerDataIds[a]&&0<n.layerDataIds[a].length&&(r[a]=[],n.layerDataIds[a].forEach(function(t,e){t?(e="trackLayers"===a?"track-layer".concat(0<e?e:""):a,e=(e=n.layerDataCache(t,e)).featureId||e.data,r[a].push(w.a.$options.getData(e)||{})):r[a].push(void 0)}))}(t);return r},updateMapSelfLayers:function(i){var o,s,c=this,t=this.currentProps.target;!y.a.$options.getMap(t)||(t=(o=y.a.$options.getWebMap(t))._layers)&&(s=this.getLayerFeatures(),t.forEach(function(t){var e,a,n,r="".concat(t.layerID);(i&&i[t.layerID]||c.dataIds.hasOwnProperty(r))&&(e=(n=i&&i[t.layerID]||{}).mergeField,a=(n=(a=n.featureId)&&w.a.$options.getData(a)||s[r]&&s[r][0]||{}).features&&n.features.features,t.hasOwnProperty("themeSetting")&&a&&!Object(I.i)(a[0]&&a[0].properties,t.themeSetting.themeField)&&0!==Object(I.i)(a[0]&&a[0].properties,t.themeSetting.themeField)?c.$message.error(c.$t("setting.webMap.inValidDataTip")):(n=c.defaultParams.props.layersIdField||{},(t=f()(t)).projection="EPSG:4326",o.updateOverlayLayer(t,a,e||n[r])))}))},resetWebMapInfo:function(){this.updateMapSelfLayers()},diffData:function(t,e){var a,n;for(n in t)e&&e[n]&&t[n]!==e[n]&&((a=a||{})[n]=t[n]);return a},getFilterLayerFeatures:function(){var i,o=this.defaultParams.props.layers;return o&&o.length&&(i=this.getLayerFeatures(),o.forEach(function(t,e){var a=t.propDatas,n=a.attributeFilter,r=a.maxFeatures,a="layers_".concat(t.ref),t=i[a]&&i[a][0],a=t&&t.features,t={};n&&(t=Object(v.b)(n,r,a)),r&&!n&&(t=Object(v.c)(r,a)),o[e].propDatas.features=Object.freeze(t)})),Object.freeze(o)},getTrackLayersFeatures:function(){var o=this,s=this.defaultParams.props.trackLayers;if(!s||!s.length)return s;var c=this.getLayerFeatures().trackLayers,l=this.layerDataIds.trackLayers;return c?(s.forEach(function(t,e){s[e].propDatas.trackPoints=o.getTrackLayerDatas(l[e]);var a=o.layerDataCache(l[e],s[e].ref),n=c[e]&&c[e].features,r=n&&n.features&&n.features[0]&&n.features[0].properties,i=a.nextTimeStamp,n=a.playInterval,a=a.currentTimeStamp,r=(r=(r||{}).timestamp)&&+new Date(r);s[e].propDatas.position={prevTimestamp:r,currentTimestamp:a||r,nextTimestamp:i&&1e3*i,step:n}}),Object.freeze(s)):s},getTrackAllDatas:function(t){t=this.$store.getters.getDataCache(t);if(t){t="timeData"===t.type?t.timeDataId:t.data;return w.a.$options.getData(t)}},getTrackLayerDatas:function(t){var a=this.getTrackAllDatas(t);if(a){var e,n=[];for(e in a)!function(e){var t=a[e];t&&0<t.length&&(0<(t=t.filter(function(t){return t.geometry&&"Point"===t.geometry.type}).map(function(t){return T(T({},t),{},{properties:T(T({},t.properties),{},{timestamp:1e3*e})})})).length&&n.push.apply(n,S(t)))}(e);return Object.freeze(n)}},resetTrackLayers:function(t,e){var a=this,e=this.diffData(t,e);e&&Object.keys(e).forEach(function(t){a.currentProps.trackLayers&&a.currentProps.trackLayers[t]&&(t=a.currentProps.trackLayers[t].ref,(t=a.$refs[t])&&t[0].reset())})}}},s=a("l6bU"),C=a("bG4Z"),c=a("9ad+"),i=a.n(c),n=a("5zrt"),c=a.n(n),n=a("45Hi"),n=a.n(n),k=a("mSNy"),D=[{id:"tianditu_vec_3857",title:Object(k.d)().t("internetMap.tiandituVec3857"),thumbnail:n.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/vec_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=vec&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cva_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cva&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_ter_3857",title:Object(k.d)().t("internetMap.tiandituTer3857"),thumbnail:c.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/ter_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=ter&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cta_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cta&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_img_3857",title:Object(k.d)().t("internetMap.tiandituImg3857"),thumbnail:i.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/img_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=img&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cia_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cia&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_vec_4326",title:Object(k.d)().t("internetMap.tiandituVec4326"),thumbnail:n.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/vec_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=vec&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cva_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cva&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8},{id:"tianditu_ter_4326",title:Object(k.d)().t("internetMap.tiandituTer4326"),thumbnail:c.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/ter_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=ter&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cta_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cta&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8},{id:"tianditu_img_4326",title:Object(k.d)().t("internetMap.tiandituImg4326"),thumbnail:i.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/img_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=img&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cia_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cia&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8}],P=a("OcSP");function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function L(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach(function(t){var e,a;e=n,t=r[a=t],a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function $(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function N(t,e){return(N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function E(a){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=A(a);return function(t,e){{if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined")}return function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t)}(this,n?(t=A(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var z=Object(h.g)(),F=Object(h.h)(),U="".concat(z,"/web/static/portal/img/mapDashboard/defaultThumbnail.png"),R={Map:function(t,e,a){a.url=e?F:z,a.withCredentials=!e},DrillMap:function(t,e,a){a.url=e?F:z,a.withCredentials=!e},Dashboard:function(t,e,a){a.name&&(a.title=a.name),a.thumbnail||(a.thumbnail=U),a.url="".concat(z,"/web/mapdashboards/").concat(a.id,".json"),a.withCredentials=!0},Scene:function(t,e,a){a.name&&(a.title=a.name),a.url||(a.url="".concat(z,"/web/scenes/").concat(a.id)),a.withCredentials=!0}},B={publicMap:!1,myMap:!0,publicDashboard:!1,myDashboard:!0,publicScene:!1,myScene:!0,online:!1},K=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(r,d.a.Evented);var t,e,a,n=E(r);function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=n.call(this)).url=t,e.getDrillMaps=C.b,e.getMaps=C.b,e.getDashboards=C.a,e.getScenes=C.c,e.templates=P.map(function(t,e){return L(L({},t),{},{id:e+1,title:Object(k.d)().t("templatesName.".concat(t.name)),content:null})}),e.templates.unshift({content:{name:"empty"},id:0,thumbnail:"static/templates/img/empty.png",title:Object(k.d)().t("templatesName.newblankTemplate")}),e}return t=r,(e=[{key:"getResourceInfo",value:function(a,t,n,e,r){var i=this;this["get".concat(a,"s")]({params:t,isMyContent:n,permissionType:e,isOnline:r}).then(function(t){var e;t&&t.content&&(t.content.forEach(R[a].bind(i,n,r)),e=t.total?{current:t.currentPage,pageSize:t.pageSize,total:t.total}:null,i.fire("getresourceinfosucceeded",{result:t.content,pagination:e}))})}},{key:"getResourceContent",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length?arguments[4]:void 0,i={currentPage:a,pageSize:n};r&&(i.keywords=encodeURIComponent(r));var o=B[e],n="READ",r=!1;if("internetMap"!==e&&"service"!==e){if("Template"===t){if("template"===e)return void this.getTemplates(i);t="Dashboard",n="ALL"}this.getResourceInfo(t,i,o,n,r="online"===e?!0:r)}else"internetMap"===e&&this.fire("getresourceinfosucceeded",{result:D,pagination:{total:D.length,current:a,pageSize:8}})}},{key:"getTemplates",value:function(t){var e=t.currentPage,a=t.pageSize,n=(e-1)*a,t=this.templates.slice(n,n+a),n=this.templates.length;this.fire("getresourceinfosucceeded",{result:t,pagination:n?{current:e,pageSize:a,total:n}:null})}}])&&$(t.prototype,e),a&&$(t,a),r}(),n=a("9/5/"),G=a.n(n),c={name:"Input",model:{prop:"value",event:"change"},props:{type:{type:String,default:"text"},title:{type:String},placeholder:{type:String,default:function(){return this.$t("setting.common.input")}},value:{type:[String,Number]},input:{type:Function},wrap:{type:Boolean,default:!1},unit:{type:String},tips:{type:String},defaultValue:{type:Number,default:0},formatter:{type:Function},parser:{type:Function},max:{type:Number},min:{type:Number},precisionLimit:{type:Boolean,default:!0},precision:{type:Number,default:2},step:{type:Number,default:.5},decimalSeparator:{type:String,default:"."},disabled:{type:Boolean},icon:{type:Boolean,default:!1},iconClickCallback:{type:Function},iconTitle:String,colon:{type:Boolean,default:!1},useDebounce:{type:Boolean,default:!1},debounceTime:{type:Number,default:2e3}},computed:{precisionProps:function(){return this.precisionLimit?{precision:this.precision,step:this.step}:null}},created:function(){this.useDebounce&&(this.handleChangeFn=G()(this.emitChange,this.debounceTime,{trailing:!0}))},methods:{handleInput:function(t){this.$emit("input",t.target.value),this.input&&this.input(t.target.value)},handleBlur:function(t){this.$emit("blur",t.target.value)},handleFocus:function(t){this.$emit("focus",t.target.value)},handleClick:function(t){this.$emit("click",t.target.value)},handlePressEnter:function(t){this.$emit("pressEnter",t.target.value)},emitChange:function(t){this.$emit("change",""===t?void 0:t)},handleChange:function(t){this.useDebounce?this.handleChangeFn(t):this.emitChange(t)}}},i=(a("pc/F"),a("KHd+")),n=Object(i.a)(c,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{class:["sm-setting-panel",{"is-wrap":e.wrap}]},[e.title?t("div",{staticClass:"sm-setting-panel__header"},[e._v("\n    "+e._s(e.colon?e.title+"：":e.title)+"\n    "),e.iconClickCallback?[e.icon?t("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-4px","font-size":"12px",cursor:"pointer"},attrs:{title:e.iconTitle},on:{click:e.iconClickCallback}}):e._e()]:[t("a-popover",{attrs:{trigger:"hover",placement:"bottom"}},[t("template",{slot:"content"},[t("div",[e._t("iconTip")],2)]),e._v(" "),e.icon?t("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-3px","font-size":"12px"},attrs:{title:e.iconTitle}}):e._e()],2)]],2):e._e(),e._v(" "),t("div",{staticClass:"sm-setting-panel__content",attrs:{title:e.tips}},["textArea"===e.type?t("sm-textarea",{attrs:{value:e.value,placeholder:e.placeholder},on:{input:e.handleInput,change:function(t){return e.handleChange(t.target.value)}}}):e._e(),e._v(" "),"text"===e.type?t("sm-input",{attrs:{value:e.value,placeholder:e.placeholder,disabled:e.disabled},on:{input:e.handleInput,blur:e.handleBlur,focus:e.handleFocus,click:e.handleClick,pressEnter:e.handlePressEnter,change:function(t){return e.handleChange(t.target.value)}}}):e._e(),e._v(" "),"number"===e.type?t("div",{class:{"input-number-holder":!0,"unit-gap":!!e.unit}},[t("sm-input-number",e._b({attrs:{value:e.value,placeholder:e.placeholder,formatter:e.formatter,defaultValue:e.defaultValue,parser:e.parser,max:e.max,min:e.min},on:{input:e.handleInput,change:function(t){return e.handleChange(t)}}},"sm-input-number",e.precisionProps,!1)),e._v(" "),e.unit?t("span",{staticClass:"sm-setting-unit"},[e._v(e._s(e.unit))]):e._e()],1):e._e()],1)])},[],!1,null,null,null).exports,q=a("GSdF"),c={name:"SmSettingTdtKey",components:{InputElement:n},props:{wrap:{type:Boolean,default:!0},resourceStyle:{type:Boolean,default:!1}},data:function(){return{tiandituToken:""}},watch:{"$store.getters.tdtKey":{handler:function(t){this.tiandituToken=this.$store.getters.tdtKey,this.checkKey(this.tiandituToken)},immediate:!0}},created:function(){var t=this;this.debounceFn=q.b.debounce(function(){t.$store.dispatch("SET_TDT_TOKEN",t.tiandituToken)},1e3)},methods:{changeKey:function(){this.debounceFn()},checkKey:function(t){this.$emit("correctTdtKeyFn",t)}}},c=(a("nSvo"),Object(i.a)(c,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{class:["sm-setting-tdt-key",e.resourceStyle?"sm-setting-resource":""]},[t("InputElement",{attrs:{wrap:e.wrap,icon:!0,title:e.$t("setting.webMap.key")},on:{change:e.changeKey},model:{value:e.tiandituToken,callback:function(t){e.tiandituToken=t},expression:"tiandituToken"}},[t("span",{attrs:{slot:"iconTip"},slot:"iconTip"},[t("a",{attrs:{target:"_blank",rel:"noopener noreferrer",href:"http://lbs.tianditu.gov.cn/authorization/authorization.html"}},[e._v(e._s(e.$t("setting.webMap.keyInfo")))])])])],1)},[],!1,null,"778da793",null).exports),W=a("tWJv"),V=a("fr48");function H(t,e,a,n,r,i,o){try{var s=t[i](o),c=s.value}catch(t){return void a(t)}s.done?e(c):Promise.resolve(c).then(n,r)}var Y=[3857,4326,4214,4610,4490],n={name:"SmResourceSelector",components:{InputElement:n,"sm-setting-tdt-token":c},props:{dialogVisible:{type:Boolean,default:!1},useType:{type:String,default:"Map"},selectId:{type:[String,Number]},defaultSelectId:{type:[String,Number]},proxy:{type:Boolean,default:!1},filter:{type:Function}},data:function(){return{activeName:"",visible:!1,title:this.$t("setting.webMap.selectMap"),pagination:null,searchKey:null,cacheParam:{},resourceInfo:null,tiandituToken:"",correctKey:!1,allTabs:{Dashboard:[{key:"publicDashboard",name:this.$t("setting.dashboardSwitch.publicMD")},{key:"myDashboard",name:this.$t("setting.dashboardSwitch.myMD")}],Map:[{key:"publicMap",name:this.$t("setting.webMap.publicMap")},{key:"myMap",name:this.$t("setting.webMap.myMap")},{key:"internetMap",name:this.$t("setting.webMap.internetMap")},{key:"service",name:this.$t("setting.webMap.service")}],DrillMap:[{key:"publicMap",name:this.$t("setting.webMap.publicMap")},{key:"myMap",name:this.$t("setting.webMap.myMap")}],Scene:[{key:"publicScene",name:this.$t("setting.webScene.publicScene")},{key:"myScene",name:this.$t("setting.webScene.myScene")}],Template:[{key:"template",name:this.$t("templatesName.template")},{key:"publicDashboard",name:this.$t("setting.dashboardSwitch.publicMD")},{key:"myDashboard",name:this.$t("setting.dashboardSwitch.myMD")}]},crossAgent:this.proxy}},computed:{disableComfirmBtn:function(){return!this.cacheParam[this.activeName]},currentSelectType:function(){return this.allTabs[this.useType]},isInternetMap:function(){return"internetMap"===this.activeName},isIServerMap:function(){return"service"===this.activeName},filterResourceInfo:function(){var e=this;return this.resourceInfo.map(function(t){return t.notAllowedTip="",t.notAllowed=!1,"TIANDITU"!==t.sourceType||e.correctKey||(t.notAllowedTip+=e.$t("setting.webMap.configKey"),t.notAllowed=!0),t.id===e.selectId&&(t.notAllowedTip+=e.$t("setting.webMap.notAllowedSelectSameMap"),t.notAllowed=!0),e.filter&&e.filter(t)&&(t.notAllowedTip+=e.$t("setting.webMap.notMatchCurrentProjection"),t.notAllowed=!0),t})},isEmptyTemplate:function(){return function(t){return t.content&&"empty"===t.content.name}},lockPublicDashboard:function(t){var e=this;return function(t){return!("Template"!==e.useType||"publicDashboard"!==e.activeName||"READWRITE"===e.dashboardAuthorize(t)||"DELETE"===e.dashboardAuthorize(t))}}},watch:{dialogVisible:function(){this.getDatas(),this.visible=this.dialogVisible,this.dialogVisible&&(this.activeName=this.lastModifyActiveName||this.activeName)},visible:function(){!1===this.visible&&(this.$emit("dialogvisible",!1),this.clearData())},activeName:function(){this.pagination=null,this.searchKey=null,this.resourceInfo=null,this.getDatas()},"$store.getters.tdtKey":{handler:function(t){this.tiandituToken=t},immediate:!0}},created:function(){Object(h.l)()||(this.allTabs.Map.splice(2,0,{key:"online",name:this.$t("setting.webMap.onlineMap")}),this.allTabs.DrillMap.splice(2,0,{key:"online",name:this.$t("setting.webMap.onlineMap")}))},mounted:function(){this.url=Object(h.g)(),this.viewModel=new K(this.url),this.registerEvents(),this.init()},methods:{init:function(){var e=this;this.title={DrillMap:this.$t("setting.webMap.selectMap"),Map:this.$t("setting.webMap.selectMap"),Dashboard:this.$t("setting.dashboardSwitch.selectMD"),Template:this.$t("setting.dashboardSwitch.selectMD"),Scene:this.$t("setting.webScene.selectScene")}[this.useType],this.activeName=this.currentSelectType[0].key,this.dialogVisible&&this.getDatas(),this.viewModel.on("getresourceinfosucceeded",function(t){"Template"===e.useType&&e.resourceInfoClicked(null,e.resourceInfo[e.defaultSelectId])})},refresh:function(){this.resourceInfo=[],this.getDatas()},getDatas:function(t,e){var a;this.dialogVisible&&(a=this.searchKey&&JSON.stringify([this.searchKey]),this.viewModel.getResourceContent(this.useType,this.activeName,t,e,a))},getEpsgCodeWKT:function(t,e){if(t)return SuperMap.FetchRequest.get(t,null,e).then(function(t){return t.text()}).then(function(t){return t}).catch(function(t){console.log(t)})},onOk:function(){var s,m=this;return s=regeneratorRuntime.mark(function t(){var e,a,n,r,i,o,s,c,l,p,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(m.lastModifyActiveName=m.activeName,e=f()(m.cacheParam[m.activeName]),-1===m.useType.indexOf("Map")){t.next=48;break}if(!m.isInternetMap){t.next=14;break}t.t0=e.sourceType,t.next="TIANDITU"===t.t0?7:9;break;case 7:return a=m.createTilesInfo(e,m.tiandituToken),t.abrupt("break",10);case 9:return t.abrupt("break",10);case 10:e.mapOptions=m.createInternetMapInfo(a),e.url="",t.next=46;break;case 14:if(m.isIServerMap)return o=(n=e).split("/"),r=o[o.length-1],t.next=20,Object(W.g)(n);t.next=45;break;case 20:return i=t.sent,t.next=23,m.getiServerMapInfo(n,i);case 23:if(o=t.sent,s="EPSG:3857",!o){t.next=43;break}if(c=o.dynamicProjection,p=o.prjCoordSys,l=o.bounds,p=p.epsgCode,-1!==Y.indexOf(p)){t.next=42;break}if(!c){t.next=34;break}p=3857,s="EPSG:".concat(p),t.next=42;break;case 34:return t.next=36,m.getEpsgCodeWKT("".concat(n,"/prjCoordSys.wkt"),{withoutFormatSuffix:!0});case 36:u=t.sent,Object(V.b)("EPSG:".concat(p),u),u=[l.leftBottom.x,l.leftBottom.y,l.rightTop.x,l.rightTop.y],u=new d.a.CRS("EPSG:".concat(p),u,180<u[2]?"meter":"degree"),d.a.CRS.set(u),s=u;case 42:e={url:n,title:r,withCredentials:i,mapOptions:{crs:s,style:{version:8,sources:{"iserver-tiles":{type:"raster",tiles:[n],tileSize:256,prjCoordSys:p<0?"":{epsgCode:p},rasterSource:"iserver",proxy:m.crossAgent?Object(h.i)("image"):null}},layers:[{id:"simple-tiles",type:"raster",source:"iserver-tiles",minzoom:0,maxzoom:22}]}}};case 43:t.next=46;break;case 45:"online"!==m.activeName&&(e.proxy=m.crossAgent);case 46:u={serverUrl:m.isInternetMap||m.isIServerMap?null:e.url,mapId:m.isInternetMap||m.isIServerMap?null:e.id,mapOptions:e.mapOptions,withCredentials:e.withCredentials},Object(v.f)(u);case 48:m.$emit("resourceinfoclicked",{resourceParam:e,activeName:m.activeName}),m.isIServerMap||m.$emit("changeselectid",e.id),m.$emit("dialogvisible",!1);case 51:case"end":return t.stop()}},t)}),function(){var t=this,o=arguments;return new Promise(function(e,a){var n=s.apply(t,o);function r(t){H(n,e,a,r,i,"next",t)}function i(t){H(n,e,a,r,i,"throw",t)}r(void 0)})}()},getiServerMapInfo:function(t){var a=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new Promise(function(e){new d.a.supermap.MapService(t,{withCredentials:a}).getMapInfo(function(t){e((t||{}).result)})})},createTilesInfo:function(t,e){for(var a=[],n=[],r=[],i=0;i<t.s;i++)n.push(t.url.replace("{tk}",e).replace("{s}",i)),t.withLabel&&r.push(t.labelUrl.replace("{tk}",e).replace("{s}",i));return a.push({url:n,id:t.id}),t.withLabel&&a.push({url:r,id:t.id+"_label"}),t.mapInfo=a,t},createInternetMapInfo:function(t){var e={},a=[];return t.mapInfo.forEach(function(t){e[t.id]={type:"raster",tiles:t.url,tileSize:256},a.push({id:t.id,type:"raster",source:t.id})}),{crs:t.epsgCode,minzoom:t.minzoom||0,maxzoom:t.maxzoom||22,style:{version:8,sources:e,layers:a},renderWorldCopies:!1}},closeDialog:function(){this.$emit("dialogvisible",!1)},registerEvents:function(){var e=this;this.viewModel.on("getresourceinfosucceeded",function(t){e.resourceInfo=t.result,e.pagination=t.pagination,e.isInternetMap&&e.resourceInfo.forEach(function(t){"TIANDITU"===t.sourceType&&t.labelUrl&&(t.withLabel=!0)}),e.hasDatas(e.resourceInfo)})},hasDatas:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=this.cacheParam[this.activeName],t=t.find(function(t){return e&&t.id===e.id});e&&!t&&(this.cacheParam[this.activeName]=null)},resourceInfoClicked:function(t,e,a){e&&e.notAllowed||a||this.$set(this.cacheParam,this.activeName,e)},clearData:function(){if(this.lastModifyActiveName)for(var t in this.cacheParam)t!==this.lastModifyActiveName&&this.cacheParam[t]&&(this.cacheParam[t]=null)},changeLabelLayer:function(t,e){var a=this.resourceInfo[t];a.withLabel=!e,this.$set(this.resourceInfo,t,a)},correctTdtKeyFn:function(t,e){this.correctKey=t},setCrossAgent:function(t){this.crossAgent=t.target.checked},dashboardAuthorize:function(t){var e,a=this.$store.getters.userName;t=t||[];for(var n=0;n<t.length;n++){var r=t[n];if(r.aliasName===a){e=r.permissionType;break}"GUEST"===r.aliasName&&(e=r.permissionType)}return e}}},c=(a("QDzv"),a("MYbg"),Object(i.a)(n,function(){var n=this,t=n.$createElement,r=n._self._c||t;return r("sm-modal",{attrs:{dialogStyle:{"max-width":"1152px"},width:"auto",closable:!0,"lock-scroll":!1,maskClosable:!1,title:n.useType.includes("Map")?n.$t("setting.common.selectMap")+"：":n.$t("setting.common.selectDashboard")+"：",wrapClassName:"sm-resource-selector sm-setting-selector",dialogClass:"sm-resource-selector-modal sm-setting-selector-modal"},on:{cancel:n.closeDialog},model:{value:n.visible,callback:function(t){n.visible=t},expression:"visible"}},[r("sm-tabs",{model:{value:n.activeName,callback:function(t){n.activeName=t},expression:"activeName"}},n._l(n.currentSelectType,function(t){return r("sm-tab-pane",{key:t.key,attrs:{tab:t.name,name:t.key}},[r("div",{class:["sm-resource-selector__resource-info",!n.useType.includes("Map")&&"sm-resource-selector__info"]},[["publicMap","myMap","publicDashboard","myDashboard","online"].includes(t.key)?r("div",{staticClass:"sm-resource-selector_update"},[r("sm-button",{staticClass:"sm-mapdashboard-icon",attrs:{size:"small"},on:{click:function(t){return n.refresh()}}},[n._v("")]),n._v(" "),["publicMap","myMap"].includes(t.key)?r("span",{staticClass:"cross-agent-holder"},[r("sm-checkbox",{attrs:{checked:n.crossAgent},on:{change:n.setCrossAgent}},[n._v("\n              "+n._s(n.$t("setting.common.proxy"))+"\n              "),r("a-popover",{attrs:{placement:"right","arrow-point-at-center":"",getPopupContainer:function(t){return t.parentNode}}},[r("template",{slot:"content"},[r("span",[n._v(n._s(n.$t("setting.common.crossAgent")))])]),n._v(" "),r("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-2px","font-size":"12px"}})],2)],1)],1):n._e(),n._v(" "),r("div",{staticClass:"search-holder"},[r("i",{staticClass:"sm-mapdashboard-icon-search"}),n._v(" "),r("sm-input-search",{staticStyle:{width:"204px"},attrs:{placeholder:n.$t("setting.common.searchByKeyWords")},on:{search:function(t){return n.getDatas(1)}},model:{value:n.searchKey,callback:function(t){n.searchKey=t},expression:"searchKey"}})],1)],1):"internetMap"===t.key?r("div",{staticClass:"tdt-token"},[r("sm-setting-tdt-token",{attrs:{wrap:!1,resourceStyle:!0},on:{correctTdtKeyFn:n.correctTdtKeyFn}})],1):n._e(),n._v(" "),n.resourceInfo?r("a-row",{attrs:{type:"flex",justify:"start"}},n._l(n.filterResourceInfo,function(e,a){return r("a-col",{key:a,attrs:{span:6,title:e.notAllowedTip}},[r("sm-card",{class:{clicked:n.cacheParam[n.activeName]&&e.id===n.cacheParam[n.activeName].id},style:{cursor:e.notAllowed?"not-allowed":""},nativeOn:{click:function(t){n.resourceInfoClicked(t,e,n.lockPublicDashboard(e.authorizeSetting))}}},[n.isEmptyTemplate(e)?n._e():r("img",{attrs:{slot:"cover",alt:e.title,src:e.thumbnail},slot:"cover"}),n._v(" "),n.lockPublicDashboard(e.authorizeSetting)||n.isEmptyTemplate(e)?r("div",{staticClass:"sm-template-mongolia",staticStyle:{cursor:"pointer"},attrs:{slot:"cover",title:e.title},slot:"cover"},[r("i",{class:n.isEmptyTemplate(e)?"sm-mapdashboard-icon-plus":"sm-mapdashboard-icon-lock",style:{fontSize:n.isEmptyTemplate(e)?"40px":"30px"},attrs:{type:n.isEmptyTemplate(e)?"plus":"lock"}})]):n._e(),n._v(" "),r("sm-card-meta",[r("span",{attrs:{slot:"title",title:e.title},slot:"title"},[n._v(n._s(e.title))]),n._v(" "),r("div",{staticStyle:{"{float":"right}"},attrs:{slot:"avatar"},slot:"avatar"},[e.labelUrl?r("span",[r("i",{staticClass:"sm-mapdashboard-icons",style:{color:e.withLabel?"#13a2fc":"#c0c4cc"},attrs:{title:n.$t("setting.common.label")},on:{click:function(t){return n.changeLabelLayer(a,e.withLabel)}}},[n._v("\n                      \n                    ")])]):n._e()])])],1)],1)}),1):"service"===n.activeName?r("div",{staticClass:"sm-resource-selector__my-service"},[n._v("\n          URL：\n          "),r("sm-input",{attrs:{placeholder:n.$t("setting.common.matchIServerUrl")},model:{value:n.cacheParam[n.activeName],callback:function(t){n.$set(n.cacheParam,n.activeName,t)},expression:"cacheParam[activeName]"}}),n._v(" "),r("div",{staticClass:"cross-agent-holder"},[r("sm-checkbox",{attrs:{checked:n.crossAgent},on:{change:n.setCrossAgent}},[n._v("\n              "+n._s(n.$t("setting.common.proxy"))+"\n              "),r("a-popover",{attrs:{placement:"right","arrow-point-at-center":"",getPopupContainer:function(t){return t.parentNode}}},[r("template",{slot:"content"},[r("span",{staticStyle:{padding:"2px 6px"}},[n._v(n._s(n.$t("setting.common.crossAgent")))])]),n._v(" "),r("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-2px","font-size":"12px"}})],2)],1)],1),n._v(" "),r("div",{staticClass:"example-holder"},[r("span",[n._v(n._s(n.$t("setting.common.example"))+"：")]),n._v(" "),r("div",[r("h3",[n._v(n._s(n.$t("setting.common.iServerRestMapUrl"))+"：")]),n._v(" "),r("p",[n._v("http://{server}:{port}/iserver/services/{component}/rest/maps/{mapName}")])])])],1):r("div",{staticClass:"empty-tip"},[r("sm-empty")],1)],1)])}),1),n._v(" "),r("div",{staticClass:"toolbar-holder"},[n.pagination?r("sm-pagination",{staticClass:"pagination",attrs:{pageSize:n.pagination.pageSize,total:n.pagination.total},on:{change:n.getDatas},model:{value:n.pagination.current,callback:function(t){n.$set(n.pagination,"current",t)},expression:"pagination.current"}}):n._e()],1),n._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("sm-button",{attrs:{type:"primary",disabled:n.disableComfirmBtn},on:{click:n.onOk}},[n._v(n._s(n.$t("setting.common.ok")))])],1)],1)},[],!1,null,"4a171d86",null).exports),J=a("QNBb"),Q=a("Lb6U"),X=a("KqOx"),Z=a("7L49"),n=a("XaGS"),tt=a.n(n);function et(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function at(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?et(Object(r),!0).forEach(function(t){var e,a;e=n,t=r[a=t],a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):et(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}n={props:{mapInfoList:{type:Object},mapStatus:{type:Array},dataCacheName:{type:String},propDatas:Object,activeKey:[String,Number]},data:function(){return{targetData:this.propDatas.target,readyNext:!0}},computed:{allLoaded:function(){return!(!this.mapStatus||!this.mapStatus.length)&&this.mapStatus.every(function(t){return t.status})}},watch:{mapInfoList:function(t,e){var a=this;!tt()(t,e)&&this.map&&(t=Object.keys(this.viewModelList),Object.keys(this.mapInfoList).length>t.length&&(!e||JSON.stringify("{}"===e))?Object.keys(this.mapInfoList).forEach(function(t){a.viewModelList[t]||a.addMap(t,a.mapInfoList[t])}):(t.forEach(function(t){a.viewModelList[t].vm.cleanLayers(),a.viewModelList[t]=null}),this.viewModelList={},this.addMaps()))},activeKey:function(t,e){tt()(t,e)||this.setActiveMap(t,e)}},created:function(){this.viewModelList={},this.mapQueue=[],this.map=null},beforeDestroy:function(){this.map&&this.map.off("zoomend",this.resetMapLoadStatus)},methods:{addMap:function(t,e){var i=this;Object.keys(this.viewModelList).length||this.hideExistedLayers();var o,a=e.id,n=e.url,r=e.withCredentials,s=this.propDatas,c=s.target,l=s.tiandituKey,s=s.mapOptions.rasterTileSize;this.viewModelList[t]||(this.readyNext?(o=new Z.a(a,{serverUrl:n,withCredentials:r,target:c,tiandituKey:l,checkSameLayer:!0},{rasterTileSize:s},this.map),this.readyNext=!1,o.on({addlayerssucceeded:function(t){var e,a,n,r;i.readyNext=!0,o.setLayersVisible(!1),i.mapQueue.length?(e=(r=i.mapQueue.shift()).id,a=r.url,n=r.withCredentials,r=r.key,i.addMap(r,{id:e,url:a,withCredentials:n})):i.setActiveMap(i.activeKey,null)}}),this.viewModelList[t]={id:a,vm:o}):this.mapQueue.push(at(at({},e),{},{key:t})))},addMaps:function(){var e=this;Object.keys(this.mapInfoList).length&&Object.keys(this.mapInfoList).forEach(function(t){e.addMap(t,e.mapInfoList[t])})},setActiveMap:function(t,e){var a;this.viewModelList[t]&&t&&t!==e&&!this.timer&&(this.viewModelList[t]&&this.viewModelList[t].vm.setLayersVisible(!0),a=this.viewModelList[t].vm._cacheLayerId,this.allLoaded||this.isAllSourceLoaded(t,a),e&&this.viewModelList[e]&&this.viewModelList[e].vm.setLayersVisible(!1,a))},isAllSourceLoaded:function(e,a){var n=this;this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(function(){var t;n.$emit("loadingChange",!0),a.every(function(t){return!n.map||!n.map.style||(!n.map.getSource(t)||n.map.isSourceLoaded(t))})&&n.mapStatus&&(clearInterval(n.timer),n.timer=null,(t=n.mapStatus.concat()).forEach(function(t){t.key===e&&(t.status=!0)}),n.$store.dispatch("UPDATE_DATA_INFO",{uuid:n.dataCacheName,dataInfo:{mapStatus:t}}),n.$emit("loadingChange",!1))},100)},setMap:function(t){this.map=t,this.addMaps(),this.resetMapLoadStatus(),this.map.on("zoomend",this.resetMapLoadStatus)},hideExistedLayers:function(){var e=this;this.map&&this.map.getStyle().layers.forEach(function(t){e.map.setLayoutProperty(t.id,"visibility","none")})},resetMapLoadStatus:function(){var e,t;this.mapStatus&&this.mapStatus.length?e=this.mapStatus.map(function(t){return t.status=!1,t}):(t=Object.keys(this.mapInfoList)).length&&(e=[],t.forEach(function(t){e.push({key:t,status:!1})})),e&&e.length&&(this.$store.dispatch("UPDATE_DATA_INFO",{uuid:this.dataCacheName,dataInfo:{mapStatus:e}}),this.setActiveMap(this.activeKey,null))}},render:function(){return null}},n=Object(i.a)(n,void 0,void 0,!1,null,null,null).exports;function nt(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function rt(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(r),!0).forEach(function(t){var e,a;e=n,t=r[a=t],a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function it(t){return function(t){if(Array.isArray(t))return ot(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return ot(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(a="Object"===a&&t.constructor?t.constructor.name:a)||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ot(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var st={beforehorizontal:{top:"25%",left:"50%"},beforevertical:{top:"50%",left:"25%"},afterhorizontal:{top:"75%",left:"50%"},aftervertical:{top:"50%",left:"75%"}},s={components:{"sm-resource-selector":c,"sm-table-popup":r.a,"map-manager":n},mixins:[o,s.a],props:{component:{type:Object,required:!0},defaultParams:{type:Object}},data:function(){return{componentId:null,dialogVisible:!1,isCreateDialog:!1,childrenList:[],mapInfoList:{},mapCacheInfo:{},dataCacheName:"",activeKey:"",loading:!1,eventList:[],tablePopupProps:{columns:[{title:this.$t("query.attribute"),dataIndex:"attribute",width:80},{title:this.$t("query.attributeValue"),dataIndex:"attributeValue",width:150}],data:[]},filterActionData:{},uuid:""}},computed:{validMap:function(){if(!this.mergeDefaultParams)return!1;if(this.mergeDefaultParams.mapId&&this.mergeDefaultParams.serverUrl)return!0;var t=this.mergeDefaultParams.mapOptions.style,e=t.layers,t=t.sources;if(e&&t&&0<e.length&&0<Object.keys(t).length)return!0;if(Object.keys(this.mapInfoList).length)return!0;t=this.mergeDefaultParams.data;return!!(this.isDrillMap&&t[0]&&t[0].mapId&&t[0].serverUrl)},compareMapBtnStyle:function(){var t=this.defaultParams.props,e=t.orientation,t=t.target;return e?-1===t.indexOf("before")&&-1!==t.indexOf("after")?st["after".concat(e)]:st["before".concat(e)]:null},isDrillMap:function(){return"SmDrillMap"===this.componentId},isEditor:function(){return"editor"===this.$store.getters.getAction},mergeDefaultParams:function(){return Object.assign({},this.defaultParams.props,{loading:this.loading})},background:function(){return this.defaultParams.props.queryControl.background},textColor:function(){return this.defaultParams.props.queryControl.textColor},triggers:function(){return this.$store.getters.getActionsByComponentId(this.component.componentId)},listeners:function(){var t=this.component.componentId;return this.$store.getters.getListensByComponentId(t)},enableSelectedLayers:function(){var e=this,t=this.triggers&&this.triggers.featureSelection||[],a=[];return t.forEach(function(t){t=t.config.sourceData.dataId,t=Object(X.l)(e.map,t,!0);a=a.concat(t)}),a},resetActionIds:function(){return(this.listeners||[]).filter(function(t){return J.b[t.type].reset}).map(function(t){return t.actionId})},mode:function(){return this.$store.getters.mode},mapStatus:function(){return this.uuid&&this.$store.getters.getDataCache(this.uuid).mapStatus||[]},selfLayersActionInfo:function(){var t,e={};for(t in this.filterActionData)-1===t.indexOf("track-layer")&&-1===t.indexOf("layers_layer")&&(e[t]=this.filterActionData[t]);return e},subComponentList:function(){var t=this.$store.getters.components;return Object.values(t.mapSubComponent).map(function(t){return t.type})}},watch:{component:{handler:function(){this.componentId=Object(u.d)(this.component.uri),this.resetMapControlShow(),this.createWebMapNode()},deep:!0,immediate:!0},defaultParams:function(){this.resetMapControlShow()},currentProps:function(){this.createWebMapNode()},"filterActionData.mapInfo":{handler:function(t,e){var a;t&&Object.keys(t).length&&!tt()(t,e)&&(a=t.mapDatas,e=t.data,t=t.uuid,this.uuid=t,this.mapInfoList=a,this.activeKey=e,this.dataCacheName=t)},immediate:!0},selfLayersActionInfo:{handler:function(t){this.updateMapSelfLayers(t)},immediate:!0},background:function(){Object(X.g)(this.background)},triggers:{handler:function(t,e){this.handleTriggers(t)},deep:!0},listeners:{handler:function(t,e){this.filterActionData={},t&&!tt()(t,e)&&this.getActionsData(e)}}},methods:{setLayerFeatures:function(t,e,a,n){this.$set(e.propDatas,"features",t.features);t=f()(t.fieldCaptions);t.unshift(this.$t("setting.webMap.notShowField")),this.$set(e.propDatas,"textField",e.propDatas.textField||t&&t[0]),e.fieldCaptions=t,n.layers[a]=e},changeLabelStatus:function(t){var e=f()(this.component.propDatas);e.tdtComponents.tdtMapSwitcher.data.label=t,this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,propDatas:e})},changeSelectTdtMapType:function(t){var e=f()(this.component.propDatas);e.tdtComponents.tdtMapSwitcher.data.select=t,this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,propDatas:e})},mapLoaded:function(t){var e=this;!!this.$store.getters.openAllDrag&&this.component.propDatas.keepBounds&&this.component.componentId&&this.$store.dispatch("SET_MAP_KEEP_BOUNDS",{keepBounds:!1,componentId:this.component.componentId}),this.updateMapSelfLayers(),this.$emit("load",t),this.map=t.map,this.isDrillMap||(this.initResetFunction(),this.handleTriggers(this.triggers),setTimeout(function(){e.map.fire("moveend")},1e3),this.$refs.mapManager&&this.$refs.mapManager.setMap(this.map))},generateLayerNodes:function(t,e){var a=[],n=[];return e.layers&&n.push.apply(n,it(e.layers)),e.trackLayers&&n.push.apply(n,it(e.trackLayers)),n&&0<n.length&&n.forEach(function(t,e){"OBJ2"===t.propDatas.loaderType?t.propDatas.url=t.propDatas.obj2Url:"GLTF"===t.propDatas.loaderType?t.propDatas.url=t.propDatas.gltfUrl:"IMAGE"===t.propDatas.loaderType&&(t.propDatas.url=t.propDatas.imgUrl),a.push({subComponentId:Object(u.d)(t.uri),subComponentInfo:{props:t.propDatas,key:t.ref,ref:"TrackLayer"===t.componentType?t.ref:void 0}})}),a},generateTdtNodes:function(t){var e,a,n=[];for(e in t)t[e].show&&(a=Object(u.d)(t[e].uri),-1!==this.subComponentList.indexOf(a.replace("Sm",""))&&(t[e].splitLine=!0),n.push({subComponentId:a,subComponentInfo:{key:a,props:t[e],on:{"change-select-map-type":this.changeSelectTdtMapType,"change-label-status":this.changeLabelStatus}}}));return n},transformedSuspensionCmpsToContol:function(t,e){if(t.hasOwnProperty("controlComponents"))for(var a in t.controlComponents){var n,r=t.controlComponents[a];r&&(n=Object(u.d)(r.uri),-1!==this.subComponentList.indexOf(n.replace("Sm",""))&&(r.splitLine=!0),"SmLayerList"===n&&function(){var t=r.attributes.container&&r.attributes.container.toLowerCase();r.attributes.getContainer=function(){return document.querySelector(".".concat(t))||document.getElementById(t)}}(),e.push({subComponentId:n,subComponentInfo:{key:a,props:r}}))}},generateControlNodes:function(e){var a,t=[];for(a in this.transformedSuspensionCmpsToContol(e,t),e){var n=this.isMapSubComponent(a);n&&this.component.propDatas[a].show&&(e[a].mapTarget=e.target,"SmIdentify"===(n=Object(u.d)(n.uri))&&this.identifyToComponent(e[a]),-1!==this.subComponentList.indexOf(n.replace("Sm",""))&&(e[a].splitLine=!0),"SmLayerList"===n&&function(){var t=e[a].attributes.container&&e[a].attributes.container.toLowerCase();e[a].attributes.getContainer=function(){return document.querySelector(".".concat(t))||document.getElementById(t)}}(),t.push({subComponentId:n,subComponentInfo:{key:n,props:e[a]}}))}return t},identifyToComponent:function(t){var e,a=t.layers,n=t.fields,r=[];for(e in a)!function(e){(a[e]||[]).forEach(function(t){r.push(n[e]||[])})}(e);t.fields=r,t.layers=[].concat.apply([],Object.values(a||{}))},isMapSubComponent:function(e){if(-1!==e.indexOf("identify"))return{uri:"mapboxgl/web-map/control/identify/Identify"};var t=this.$store.getters.components;return Object.values(t.mapSubComponent).find(function(t){return-1<e.toLowerCase().indexOf(t.type.toLowerCase())})},createWebMapNode:function(){var t=this.component,e=this.currentProps,a=f()(this.component.propDatas),n=a.tdtComponents||{},t=this.generateLayerNodes(t,e),n=this.generateTdtNodes(n),a=this.generateControlNodes(a);e.mapOptions||(e.mapOptions={}),e.mapOptions.preserveDrawingBuffer=!0,"unFixed"!==e.fixedMap&&(e.mapOptions.bounds=this.$store.getters.getMapByTarget(e.target)&&d.a.LngLatBounds.convert(this.$store.getters.getMapByTarget(e.target).bounds)),Object(h.l)()&&(e.isSuperMapOnline=!0),this.$store.getters.openAllDrag||this.handleMapFixed(e),this.childrenList=[].concat(t,n,a)},handleMapFixed:function(t,e){var a,n=t.fixedMap,r=t.mapOptions,r=void 0===r?{}:r;switch(n){case"fixed":a=!1;break;case"unFixed":a=!0;break;case"fixedInMobile":a=!("mobile"===this.mode)}a!==r.interactive&&(t.mapOptions.interactive=a)},resetMapControlShow:function(){var t,e=this.currentProps;for(t in e)-1!==t.indexOf("Control")&&e[t].show&&(e[t].show=!1)},changeDialogVisible:function(t){var e=this;this.isCreateDialog=t,this.$nextTick(function(){e.dialogVisible=t})},resourceInfoClicked:function(t){this.mapParam=t.resourceParam;var e=this.mapParam,a=e.title,n=e.id,r=e.url,i=e.mapOptions,o=e.proxy,s=f()(this.defaultParams.props),e=rt(rt({},s.mapOptions),{},{style:{version:8,sources:{},layers:[]},center:[0,0],zoom:1,bearing:0,pitch:0,tileSize:256});this.isDrillMap?(s.data[0]={layerId:"",serverUrl:r||"",withCredentials:t.resourceParam.withCredentials,proxy:o,mapId:n,relatedField:"",title:a},i||(s.mapOptions=e)):(s.serverUrl=r||"",s.withCredentials=this.mapParam.withCredentials,s.proxy=o,i?(o=s.mapOptions,s.mapOptions=Object.assign(o,i),s.mapId=""):(s.mapId=n,s.mapOptions=e)),this.updateMapName(a),this.defaultParams.props&&this.defaultParams.props.target&&(-1!==this.defaultParams.props.target.indexOf("before")||-1!==this.defaultParams.props.target.indexOf("after"))?this.$emit("change-compare-props",{target:this.defaultParams.props.target,propDatas:s}):this.$store.dispatch("INIT_COMPONENT_CONFIG_SILENT",{componentId:this.component.componentId,propDatas:s})},updateMapName:function(t){t&&this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,componentName:t})},handleDataviz:function(){window.open(Object(h.f)())},selectMap:function(){this.changeDialogVisible(!0)},handleTriggers:function(e){var l=this;if(this.eventList.length&&this.map&&this.eventList.forEach(function(t){var e=t.eventName,a=t.listenerName,t=t.layers;t&&t instanceof Array?t.forEach(function(t){l.map.off(e,t,a)}):l[a]&&(l.map.off(e,l[a]),l[a]=null)}),this.eventList=[],e&&this.map)for(var t in e)!function(c){var t=J.d[c].events||[],a=e[c];l.monitorEventLinkage(J.d,c,a),t.forEach(function(t){var e="handleTrigger".concat(t.replace(t[0],t[0].toUpperCase()));l[e]=function(r){var i,o=[],s=!0;a.forEach(function(t){var e=J.d[c].callback({e:r},t,l),a=w.a.$options.updateFeature(e.feature,"".concat(l.component.componentId,"-").concat(c)),n=l.getUpdateCondition(c,t,e.passingActionInfo);s=e.status,i=e.passingActionInfo,delete e.feature,delete e.passingActionInfo,n&&o.push(rt(rt({actionId:t.actionId},e),{},{featureId:a}))}),s&&l.$store.dispatch("UPDATE_ACTION",{componentId:l.component.componentId,type:c,datas:o,passingActionInfo:i,status:"active"})},l.map.on(t,l[e]),"click"===t&&a.forEach(function(t){var e=t.actionId,t=t.config.sourceData.dataId,t=Object(X.l)(l.map,t),e=Object(X.f)(l.map,t,e);l.eventList=l.eventList.concat(e)}),l.eventList.push({eventName:t,listenerName:e})})}(t)},getActionsData:function(){var c=this,l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],p=[];return this.map&&this.listeners.forEach(function(t){var e=t.type,a=t.targetData,n=t.featureId,r=t.actionId,i=t.timestamp,o=t.blockEventLinkage,s=a&&a.dataId,a=l.find(function(t){return t.actionId===r});a&&a.timestamp===i||o||(o=c.$store.getters.getPassingActionInfoByActionId(r,Q.a[e]||"boundsChange"),t=rt(rt({},t),{},{passingActionInfo:o}),o=(o=Object(X.k)(c.map,s))&&o.features||[],n&&(t.feature=w.a.$options.getData(n)),o=J.b[e].callback(t,o,c),p.push(o),"switchMap"!==e&&"switchDataSource"!==e||(c.filterActionData=Object.assign({},c.filterActionData,o)),c.emitEventLinkage(e,r,s,o))}),p},initResetFunction:function(){var t=this;this.map.off("click",this.callback),this.callback=function(){Object(J.c)(t.map),t.$store.dispatch("UPDATE_ACTIONS_STATUS",{actionIds:t.resetActionIds,status:"reset",fromComponentId:t.component.componentId})},this.map.on("click",this.callback)},loadingChange:function(t){this.loading=t}}},s=(a("SknJ"),Object(i.a)(s,function(){var a=this,t=a.$createElement,n=a._self._c||t;return n(a.componentId,a._b({tag:"component",style:a.defaultParams.style,on:{load:a.mapLoaded}},"component",a.mergeDefaultParams,!1),[a.isEditor&&!a.validMap?n("div",{staticClass:"map-mask",attrs:{slot:a.isDrillMap?"blank":"default"},slot:a.isDrillMap?"blank":"default"}):a._e(),a._v(" "),a._l(a.childrenList,function(t){var e=t.subComponentId,t=t.subComponentInfo;return[n(e,a._g(a._b({key:a.mode+"-"+t.key,ref:t.ref,refInFor:!0,tag:"component"},"component",t.props,!1),t.on))]}),a._v(" "),a.isEditor&&!a.validMap?n("div",{staticClass:"btn-wrap",style:a.compareMapBtnStyle,attrs:{slot:a.isDrillMap?"blank":"default"},slot:a.isDrillMap?"blank":"default"},[n("sm-button",{staticClass:"customRenderButton",attrs:{type:"primary"},on:{click:a.selectMap}},[a._v(a._s(a.$t("setting.webMap.selectMap")))]),a._v(" "),n("div",{staticClass:"line"}),a._v(" "),n("sm-button",{staticClass:"customRenderButton",attrs:{type:"primary"},on:{click:a.handleDataviz}},[a._v(a._s(a.$t("setting.webMap.makeMapOnline")))])],1):a._e(),a._v(" "),a.isCreateDialog?n("sm-resource-selector",{attrs:{slot:a.isDrillMap?"blank":"default",dialogVisible:a.dialogVisible,useType:a.isDrillMap?"DrillMap":"Map"},on:{resourceinfoclicked:a.resourceInfoClicked,dialogvisible:a.changeDialogVisible},slot:a.isDrillMap?"blank":"default"}):a._e(),a._v(" "),n("map-manager",{ref:"mapManager",attrs:{slot:a.isDrillMap?"blank":"default",mapInfoList:a.mapInfoList,mapStatus:a.mapStatus,dataCacheName:a.dataCacheName,propDatas:a.defaultParams.props,activeKey:a.activeKey},on:{loadingChange:a.loadingChange},slot:a.isDrillMap?"blank":"default"}),a._v(" "),n("sm-table-popup",a._b({directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"tablePopup",attrs:{slot:a.isDrillMap?"blank":"default",background:a.background,textColor:a.textColor},slot:a.isDrillMap?"blank":"default"},"sm-table-popup",a.tablePopupProps,!1))],2)},[],!1,null,null,null));e.default=s.exports},dDBl:function(t,e,a){"use strict";var n=a("TuIa"),r=a("FhCG"),i=a("oTir"),o=a("tmJK"),r=Object.assign({},r.TableProps),r={name:"SmTable",defaultComponent:n.default,mixins:[i.a,o.a],inheritAttrs:!1,props:r},a=a("KHd+"),r=Object(a.a)(r,void 0,void 0,!1,null,null,null);e.a=r.exports},ka33:function(t,e,a){},l6bU:function(t,e,a){"use strict";var r=a("Lb6U"),h=a("4zwu"),n=a("zT9C"),f=a.n(n);function i(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function g(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){var e,a;e=n,t=r[a=t],a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}n={data:function(){return{}},methods:{monitorEventLinkage:function(a,n,r,i,o){var s=this,t="linkage-".concat(n);this.$off("actionEventLinkage".concat(n),this[t]),this[t]=function(t){var e;n===t.triggerType&&(t=(e=s._getEventLinkageData(t,r,a,n,i,o)).datas,e=e.passingActionInfo,s.$store.dispatch("UPDATE_ACTION",{componentId:s.component.componentId,type:n,status:"active",datas:t,passingActionInfo:e}))},this.$on("actionEventLinkage".concat(n),this[t])},emitEventLinkage:function(t,e,a,n){t=r.a[t];!t||4<arguments.length&&void 0!==arguments[4]&&!arguments[4]||(e=this.$store.getters.getPassingActionInfoByActionId(e,t),this.$emit("actionEventLinkage".concat(t),{triggerType:t,dataId:a,data:n,from:e}))},getUpdateCondition:function(t,e,a){var n=this.$store.getters.getTargetIdBySourceId(this.component.componentId,e.actionId,t,e.targetAction);return!(a&&n&&a.find(function(t){return t.componentId===n}))},_getEventLinkageData:function(i,o,s,c,l,p){for(var u,m=this,t=this.$store.getters.getTriggerEventByComponentIdAndType(this.component.componentId,c)||{},d=(d=f()(t.datas)||[]).map(function(t){return t.blockEventLinkage=!0,t}),e=0;e<o.length;e++)(function(t){var e=o[t];if(e.config.sourceData.dataId!==i.dataId)return;var a=s[c].callback({features:l,actionEventParams:i},e,m),n=h.a.$options.updateFeature(a.feature,"".concat(m.component.componentId,"-").concat(c)),r=m.getUpdateCondition(c,e,a.passingActionInfo);u=a.passingActionInfo,delete a.feature,delete a.passingActionInfo,delete a.highlightOptions,r&&(r=-1<(t=d.findIndex(function(t){return t.actionId===e.actionId}))?1:0,t=-1<t?t:0,n=g(g({actionId:e.actionId},a),{},{featureId:(!p||-1!==p.indexOf(e.targetAction))&&n}),d.splice(t,r,n))})(e);return{datas:d,passingActionInfo:u}}}},a=a("KHd+"),n=Object(a.a)(n,void 0,void 0,!1,null,null,null),e.a=n.exports},nSvo:function(t,e,a){"use strict";a("FzCa")},oUIn:function(t,e,a){"use strict";var n=a("oTir"),r=a("dDBl"),i=a("qAG6"),n={name:"SmTablePopup",components:{SmTable:r.a},mixins:[n.a],props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},splitLine:{type:Boolean,default:!0}},watch:{"collapseCardHeaderBgStyle.background":function(t){this.setTheadStyle("background",t)},"tablePopupBgStyle.background":function(t){Object(i.s)(t)},"headingTextColorStyle.color":function(t){this.setTheadStyle("color",t)}},mounted:function(){this.setTheadStyle("color",this.headingTextColorStyle.color),this.setTheadStyle("background",this.collapseCardHeaderBgStyle.background)},methods:{setTheadStyle:function(e,a){var t;!this.$el||(t=this.$el.querySelectorAll("tr > th"))&&t.forEach(function(t){t.style[e]=a})}}},a=a("KHd+"),n=Object(a.a)(n,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{class:{"sm-component-table-popup":!0,"with-split-line":t.splitLine},style:[t.tablePopupBgStyle,t.getTextColorStyle]},[e("sm-table",{staticClass:"sm-component-table-popup__table",attrs:{"data-source":t.data,columns:t.columns,rowKey:function(t,e){return e},pagination:!1}})],1)},[],!1,null,null,null);e.a=n.exports},"pc/F":function(t,e,a){"use strict";a("ka33")},z9S9:function(t,e,a){"use strict";a.r(e);var n=a("3Dh3"),r=a("aXEy"),i=a("zT9C"),o=a.n(i),r={components:{MapRender:r.default},props:{component:{type:Object,required:!0},defaultParams:{type:Object}},data:function(){return{componentId:null}},computed:{getMapProps:function(){return function(t){var e=this.defaultParams.props,a=t?e.afterMapOptions:e.beforeMapOptions;return a.orientation=e.orientation,{component:{componentId:null,componentType:"WebMap",dataIds:this.component.dataIds&&this.component.dataIds[t],propDatas:o()(a),uri:"mapboxgl/web-map/WebMap"},defaultParams:{props:a}}}}},created:function(){this.setComponentId()},methods:{setComponentId:function(){this.componentId=Object(n.d)(this.component.uri)},changeComponentProps:function(t){-1!==t.target.indexOf("before")?this.defaultParams.props.beforeMapOptions=t.propDatas:this.defaultParams.props.afterMapOptions=t.propDatas,this.$store.dispatch("INIT_COMPONENT_CONFIG_SILENT",{componentId:this.$store.getters.activeComponentId,propDatas:o()(this.defaultParams.props)})}}},a=a("KHd+"),r=Object(a.a)(r,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",[t.defaultParams.props.beforeMapOptions&&t.defaultParams.props.afterMapOptions?e(t.componentId,t._b({tag:"component",style:t.defaultParams.style,attrs:{"before-map-options":null,"after-map-options":null}},"component",t.defaultParams.props,!1),[e("MapRender",t._b({key:t.defaultParams.props.beforeMapOptions.target,attrs:{slot:"beforeMap"},on:{"change-compare-props":t.changeComponentProps},slot:"beforeMap"},"MapRender",t.getMapProps(0),!1)),t._v(" "),e("MapRender",t._b({key:t.defaultParams.props.afterMapOptions.target,attrs:{slot:"afterMap"},on:{"change-compare-props":t.changeComponentProps},slot:"afterMap"},"MapRender",t.getMapProps(1),!1))],1):t._e()],1)},[],!1,null,null,null);e.default=r.exports}}]);