(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"3dUo":function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=function(e){return e.forEach(function(e){if("Polygon"===e.geometry.type){var t=e.geometry.coordinates;if(1<t.length){for(var i=[[t[0]]],r=1;r<t.length;r++){var a=function(e){for(var t,i,r=0,a=0,n=e.length,o=n-1;a<n;o=a++)t=e[a],i=e[o],r+=(i[0]-t[0])*(t[1]+i[1]);return r}(t[r]);0!==a&&(0<a?i[i.length-1].push(t[r]):i.push([t[r]]))}e.geometry.coordinates=i,e.geometry.type="MultiPolygon"}}}),e}},"7L49":function(e,t,i){"use strict";i.d(t,"a",function(){return z});var t=i("hdLw"),p=i.n(t),h=i("Ur4K"),u=i("3dUo"),t=(i("xKWM"),i("hhWd"),i("CYVn"),i("MT78")),r=i.n(t),t=i("y7ZN"),a=i.n(t),t=i("zT9C"),c=i.n(t),n=i("kzZv"),o=i("GjdS"),d=i("o2tc"),f=i("9WTN"),t=i("Z94/"),E=i.n(t),t=i("ATId"),s=i.n(t),$=i("qAG6"),b=i("xRo1");function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=g(i);return function(e,t){{if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,r?(e=g(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(e,o,s,l){return new(s=s||Promise)(function(i,t){function r(e){try{n(l.next(e))}catch(e){t(e)}}function a(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}n((l=l.apply(e,o||[])).next())})},w=["GoogleCRS84Quad","GoogleMapsCompatible","urn:ogc:def:wkss:OGC:1.0:GoogleMapsCompatible","urn:ogc:def:wkss:OGC:1.0:GoogleCRS84Quad"],S=["559082264.0287178","279541132.0143589","139770566.0071794","69885283.00358972","34942641.50179486","17471320.75089743","8735660.375448715","4367830.1877224357","2183915.093862179","1091957.546931089","545978.7734655447","272989.3867327723","136494.6933663862","68247.34668319309","34123.67334159654","17061.83667079827","8530.918335399136","4265.459167699568","2132.729583849784"],P=["5.590822640287176E8","2.795411320143588E8","1.397705660071794E8","6.98852830035897E7","3.494264150179485E7","1.7471320750897426E7","8735660.375448713","4367830.187724357","2183915.0938621783","1091957.5469310891","545978.7734655446","272989.3867327723","136494.69336638614","68247.34668319307","34123.673341596535","17061.836670798268","8530.918335399134"],_=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,o["a"]);var e,t,i,r=v(a);function a(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=r.call(this)).proxyOptions={data:"apps/viewer/getUrlResource.json?url=",image:"apps/viewer/getUrlResource.png?url="},"string"==typeof e||"number"==typeof e?t.mapId=e:null!==e&&"object"===l(e)&&(t.mapInfo=e),t.serverUrl=i.serverUrl||"https://www.supermapol.com",t.accessToken=i.accessToken,t.accessKey=i.accessKey,t.tiandituKey=i.tiandituKey||"",t.withCredentials=i.withCredentials||!1,t.excludePortalProxyUrl=i.excludePortalProxyUrl,t.iportalServiceProxyUrl=i.iportalServiceProxyUrlPrefix,t.proxy=i.proxy,t}return e=a,(t=[{key:"setMapId",value:function(e){"string"==typeof e||"number"==typeof e?(this.mapId=e,this.mapInfo=null):null!==e&&"object"===l(e)&&(this.mapInfo=e,this.mapId="")}},{key:"setServerUrl",value:function(e){this.serverUrl=e}},{key:"setWithCredentials",value:function(e){this.withCredentials=e}},{key:"setProxy",value:function(e){this.proxy=e}},{key:"handleServerUrl",value:function(e){var t=e.split("");return"/"!==t[t.length-1]&&(e+="/"),this.serverUrl=e}},{key:"getMapInfo",value:function(){var t=this;if(!this.mapId&&this.mapInfo)return new Promise(function(e){e(t.mapInfo)});var a=this._handleMapUrl();return new Promise(function(i,r){return x(t,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getiPortalServiceProxy();case 3:SuperMap.FetchRequest.get(a,null,{withCredentials:this.withCredentials}).then(function(e){return e.json()}).then(function(e){var t;e&&!1===e.succeed?(t={message:e&&e.error&&e.error.errorMsg},r(t)):(e.mapParams={title:e.title,description:e.description},i(e))}).catch(function(e){r(e)}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),r(e.t0);case 9:case"end":return e.stop()}},e,this,[[0,6]])}))})}},{key:"getiPortalServiceProxy",value:function(){var r=this;return new Promise(function(t,i){SuperMap.FetchRequest.get("".concat(r.serverUrl,"web/config/portal.json"),{scope:["serviceProxy"]}).then(function(e){return e.json()}).then(function(e){e&&e.serviceProxy?((e=e.serviceProxy).enable&&(e.proxyServerRootUrl?r.iportalServiceProxyUrl=e.proxyServerRootUrl:e.port&&e.rootUrlPostfix&&(r.iportalServiceProxyUrl="".concat(e.port,"/").concat(e.rootUrlPostfix)),-1<r.serverUrl.indexOf(r.iportalServiceProxyUrl)&&(r.iportalServiceProxyUrl="")),t(e)):i("serviceProxyFailed")}).catch(function(e){i(e)})})}},{key:"getLayerFeatures",value:function(e,t,i){var r;switch(e){case"hosted":r=this._getFeaturesFromHosted(t,i);break;case"rest_data":r=this._getFeaturesFromRestData(t,i);break;case"rest_map":r=this._getFeaturesFromRestMap(t);break;case"dataflow":r=this._getFeaturesFromDataflow(t);break;case"user_data":r=this._getFeaturesFromUserData(t)}return r}},{key:"getWmsInfo",value:function(r){var a=this;return new Promise(function(i){var e=a.handleProxy(),t="".concat(r.url.split("?")[0],"?REQUEST=GetCapabilities&SERVICE=WMS");SuperMap.FetchRequest.get(t,null,{withCredentials:a.handleWithCredentials(e,r.url,!1),withoutFormatSuffix:!0,proxy:e}).then(function(e){return e.text()}).then(function(e){var t=b||window.convert,e=JSON.parse(t.xml2json(e,{compact:!0,spaces:4})),e=e.WMT_MS_Capabilities||e.WMS_Capabilities;i({version:e._attributes.version})})})}},{key:"getWmtsInfo",value:function(v,g){var r=this;return new Promise(function(u,t){var c,d=!1,f=22,p="",m="",y="",e=r.handleProxy(),i="".concat(v.url.split("?")[0],"?REQUEST=GetCapabilities&SERVICE=WMTS&VERSION=1.0.0"),i=r.handleParentRes(i);SuperMap.FetchRequest.get(i,null,{withCredentials:r.handleWithCredentials(e,v.url,!1),withoutFormatSuffix:!0,proxy:e}).then(function(e){return e.text()}).then(function(e){var t=b||window.convert,t=JSON.parse(t.xml2json(e,{compact:!0,spaces:4})).Capabilities,e=t.Contents,t=t["ows:OperationsMetadata"];t&&(t=t["ows:Operation"],(t=(t=!Array.isArray(t)?[t]:t).find(function(e){return"GetTile"===e._attributes.name}))&&(h=t["ows:DCP"]["ows:HTTP"]["ows:Get"],(l=(h=!Array.isArray(h)?[h]:h).find(function(e){return"KVP"===e["ows:Constraint"]["ows:AllowedValues"]["ows:Value"]._text}))&&(y=l._attributes["xlink:href"])));for(var i=e.TileMatrixSet,r=0;r<i.length;r++)if(i[r]["ows:Identifier"]&&i[r]["ows:Identifier"]._text===v.tileMatrixSet){if(i[r].WellKnownScaleSet&&-1!==w.indexOf(i[r].WellKnownScaleSet._text))d=!0;else{for(var a=[],n="EPSG:3857"===g?S:P,o=0,s=n.length;o<s&&i[r].TileMatrix[o]&&parseFloat(n[o])===parseFloat(i[r].TileMatrix[o].ScaleDenominator._text);o++)a.push(n[o]);if(f=a.length-1,0===a.length)throw Error("TileMatrixSetNotSuppport");d=!0}break}var l,h=e.Layer.find(function(e){return e["ows:Identifier"]._text===v.layer});h&&(l=h.Style,p=Array.isArray(h.Style)?l[0]["ows:Identifier"]?l[0]["ows:Identifier"]._text:"":l["ows:Identifier"]?l["ows:Identifier"]._text:"",h["ows:WGS84BoundingBox"]&&(e=h["ows:WGS84BoundingBox"]["ows:LowerCorner"]._text.split(" "),l=h["ows:WGS84BoundingBox"]["ows:UpperCorner"]._text.split(" "),c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(l[0]),parseFloat(l[1])]),h=h.ResourceURL,(h=(h=!Array.isArray(h)?[h]:h).find(function(e){return"tile"===e._attributes.resourceType}))&&(m=h._attributes.template)),u({isMatched:d,matchMaxZoom:f,style:p,bounds:c,restResourceURL:m,kvpResourceUrl:y})}).catch(function(e){t(e)})})}},{key:"_getFeaturesFromHosted",value:function(e,t){var i=e.dataSource,r=e.layerType,a=(i||e).serverId;return a?"MARKER"===r||i&&(!i.accessType||"DIRECT"===i.accessType)?this._getDataFromIportal(a,e):this._getDataFromHosted({layer:e,serverId:a,baseProjection:t}):new Promise(function(e){e({type:"noServerId"})})}},{key:"_getFeaturesFromRestData",value:function(e,r){var a,n=this,o=e.dataSource;return new Promise(function(t,i){n._getFeatureBySQL(o.url,[o.dataSourceName||e.name],function(e){a=n.parseGeoJsonData2Feature({allDatas:{features:e.result.features.features}}),t({type:"feature",features:a})},function(e){i(e)},r)})}},{key:"_getFeaturesFromRestMap",value:function(s){var l=this;return new Promise(function(n,o){l._queryFeatureBySQL(s.dataSource.url,s.dataSource.layerName,function(e){var e=e&&e.result.recordsets,e=e&&e[0],t=e.fields;if(e&&t){var i,r=[];for(i in t){var a=t[i];0===a.indexOf("Sm")&&"SmID"!==a||r.push(a)}l._getFeatures(r,s,function(e){n({type:"feature",features:e})},function(e){o(e)})}},function(e){o(e)},"smid=1")})}},{key:"_getFeaturesFromUserData",value:function(e){var a=this,n=e.dataSource;return new Promise(function(t,i){var e=a.handleProxy(),r=a.handleParentRes(n.url);SuperMap.FetchRequest.get(r,null,{withCredentials:a.handleWithCredentials(e,r,a.withCredentials),proxy:e}).then(function(e){return e.json()}).then(function(e){e=e&&e instanceof Object&&"FeatureCollection"===e.type?e.features:e;e=a.parseGeoJsonData2Feature({allDatas:{features:e}}),t({type:"feature",features:e})}).catch(function(e){i(e)})})}},{key:"_queryFeatureBySQL",value:function(e,t,i,r,a,n,o,s,l,h){s=this._getQueryFeaturesParam(t,a,n,o,s,l,h),l=this.handleProxy(),h=this.handleParentRes(e);new SuperMap.QueryBySQLService(h,{proxy:l,withCredentials:this.handleWithCredentials(l,e,!1),eventListeners:{processCompleted:function(e){i&&i(e)},processFailed:function(e){r&&r(e)}}}).processAsync(s)}},{key:"_getFeatures",value:function(e,t,i,r){var a=this,t=t.dataSource;this._queryFeatureBySQL(t.url,t.layerName,function(e){e=e.result.recordsets[0].features.features,e=a.parseGeoJsonData2Feature({allDatas:{features:e}});i(e)},function(e){r(e)},null,e)}},{key:"_getQueryFeaturesParam",value:function(e,t,i,r,a,n,o){t=new SuperMap.FilterParameter({name:e,attributeFilter:t});i&&(t.fields=i);t={queryParams:[t]};return o&&(t.queryOption=SuperMap.QueryOption.ATTRIBUTE),a&&(t.startRecord=a),n&&(t.expectCount=n),r&&(t.prjCoordSys={epsgCode:r}),new SuperMap.QueryBySQLParameters(t)}},{key:"_getFeaturesFromDataflow",value:function(i){var r=this;return new Promise(function(e,t){r._getDataflowInfo(i,function(){e({type:"dataflow"})},function(e){t(e)})})}},{key:"_getDataflowInfo",value:function(i,t,r){var e=i.url,e="".concat(e,".json");i.credential&&i.credential.token&&(a=i.credential.token,e+="?token=".concat(a));var a=this.handleProxy(),e=this.handleParentRes(e);SuperMap.FetchRequest.get(e,null,{proxy:a,withCredentials:this.handleWithCredentials(a,e,!1)}).then(function(e){return e.json()}).then(function(e){e?(e.featureMetaData&&(i.featureType=e.featureMetaData.featureType.toUpperCase(),i.dataSource={dataTypes:{}},e.featureMetaData.fieldInfos&&0<e.featureMetaData.fieldInfos.length&&e.featureMetaData.fieldInfos.forEach(function(e){var t=e.name.trim();"TEXT"===e.type?i.dataSource.dataTypes[t]="STRING":-1!==["DOUBLE","INT","FLOAT","LONG","SHORT"].indexOf(e.type)?i.dataSource.dataTypes[t]="NUMBER":i.dataSource.dataTypes[t]="UNKNOWN"})),i.wsUrl=e.urls[0].url,i.name=e.urls[0].url.split("iserver/services/")[1].split("/dataflow")[0],t()):r()}).catch(function(){r()})}},{key:"getDatasourceType",value:function(e){var t,i=e.dataSource,e=e.layerType;return i&&"SAMPLE_DATA"===i.type?i.type:(i&&i.serverId||"MARKER"===e||"HOSTED_TILE"===e?t="hosted":"SUPERMAP_REST"===e||"TILE"===e||"WMS"===e||"WMTS"===e||"MAPBOXSTYLE"===e?t="tile":i&&"REST_DATA"===i.type?t="rest_data":i&&"REST_MAP"===i.type&&i.url?t="rest_map":"DATAFLOW_POINT_TRACK"===e||"DATAFLOW_HEAT"===e?t="dataflow":i&&"USER_DATA"===i.type&&(t="user_data"),t)}},{key:"getFeatureProperties",value:function(e){var t=[];return e&&e.length&&e.forEach(function(e){e=e.properties;e&&t.push(e)}),t}},{key:"parseGeoJsonData2Feature",value:function(e){for(var t=e.allDatas.features,i=[],r=0,a=t.length;r<a;r++){var n=t[r],o=n.geometry.coordinates;"Point"===t[r].geometry.type&&t[r].properties&&(t[r].properties.lon=o[0],t[r].properties.lat=o[1]),n.properties.index=r+"",i.push(n)}return i}},{key:"_getDataFromIportal",value:function(e,o){var s,t=this,i="".concat(this.serverUrl,"web/datas/").concat(e,"/content.json?pageSize=9999999&currentPage=1");return this.accessToken&&(i="".concat(i,"&").concat(this.accessKey,"=").concat(this.accessToken)),new Promise(function(a,n){i=t.handleParentRes(i);var e=t.handleProxy();SuperMap.FetchRequest.get(i,null,{withCredentials:t.handleWithCredentials(e,i,t.withCredentials),proxy:e}).then(function(e){return e.json()}).then(function(r){return x(t,void 0,void 0,regeneratorRuntime.mark(function e(){var t,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!1===r.succeed&&n(r.error),!r||!r.type){e.next=22;break}if("JSON"!==r.type&&"GEOJSON"!==r.type){e.next=7;break}r.content=JSON.parse(r.content.trim()),s=this._formatGeoJSON(r.content),e.next=21;break;case 7:if("EXCEL"!==r.type&&"CSV"!==r.type){e.next=20;break}if(o.dataSource&&o.dataSource.administrativeInfo)return r.content.rows.unshift(r.content.colTitles),i=o.dataSource.administrativeInfo,t=i.divisionType,i=i.divisionField,e.next=13,this._excelData2FeatureByDivision(r.content,t,i);e.next=17;break;case 13:i=e.sent,s=this._formatGeoJSON(i),e.next=18;break;case 17:s=this._excelData2Feature(r.content,o&&o.xyField||{});case 18:e.next=21;break;case 20:"SHP"===r.type&&(r.content=JSON.parse(r.content.trim()),s=this._formatGeoJSON(r.content.layers[0]));case 21:a({type:"feature",features:s});case 22:case"end":return e.stop()}},e,this)}))}).catch(function(e){n(e)})})}},{key:"_getDataFromHosted",value:function(e){var o=this,s=e.layer,t=e.serverId,l=e.baseProjection,h="HOSTED_TILE"===s.layerType;return new Promise(function(a,n){o._checkUploadToRelationship(t).then(function(e){var i,r;e&&0<e.length?(i=e[0].name,r=e[0].type.toUpperCase(),o._getDataService(t,i).then(function(e){e=e.dataItemServices;0===e.length&&n("noDataServices");var t={layer:s,dataItemServices:e,datasetName:i,featureType:r,resolve:a,reject:n,baseProjection:l};h?(e=e.filter(function(e){return e&&"RESTDATA"===e.serviceType})[0],o._isMvt(e.address,i,l).then(function(e){o._getServiceInfoFromLayer(t,e)}).catch(function(){o._getServiceInfoFromLayer(t)})):o._getServiceInfoFromLayer(t)})):n("resultIsEmpty")}).catch(function(e){n(e)})})}},{key:"_isMvt",value:function(e,t,i){return this._getDatasetsInfo(e,t).then(function(t){return t.epsgCode==i.split("EPSG:")[1]?SuperMap.FetchRequest.get("".concat(t.url,"/tilefeature.mvt")).then(function(e){return e.json()}).then(function(e){return t.isMvt=e.error&&400===e.error.code,t}).catch(function(){return t}):t})}},{key:"_getServiceInfoFromLayer",value:function(e,i){var r=this,a=e.layer,t=e.dataItemServices,n=e.datasetName,o=e.featureType,s=e.resolve,l=e.reject,h=e.baseProjection,u=i?!i.isMvt:"HOSTED_TILE"===a.layerType,c=!1;t.forEach(function(t){c||(t&&u&&"RESTMAP"===t.serviceType?(c=!0,r._getTileLayerInfo(t.address,h).then(function(e){s({type:"restMap",restMaps:e})})):t&&!u&&"RESTDATA"===t.serviceType&&(i&&i.isMvt?s({type:"mvt",info:i,featureType:o}):(c=!0,r._getDatasources(t.address).then(function(e){a.dataSource.dataSourceName=e+":"+n,a.dataSource.url="".concat(t.address,"/data"),r._getFeatureBySQL(a.dataSource.url,[a.dataSource.dataSourceName||a.name],function(e){e=r.parseGeoJsonData2Feature({allDatas:{features:e.result.features.features}});s({type:"feature",features:e})},function(e){l(e)})},function(e){l(e)}))))},this),c||l("noService")}},{key:"_getDatasetsInfo",value:function(r,a){var n=this;return this._getDatasources(r).then(function(t){var i="".concat(r,"/data/datasources/").concat(t,"/datasets/").concat(a),e=n.handleProxy(),i=n.handleParentRes(i);return SuperMap.FetchRequest.get(i,null,{withCredentials:n.handleWithCredentials(e,i,!1),proxy:e}).then(function(e){return e.json()}).then(function(e){return{epsgCode:e.datasetInfo.prjCoordSys.epsgCode,bounds:e.datasetInfo.bounds,datasourceName:t,datasetName:a,url:i}})})}},{key:"_getDatasources",value:function(e){var t=this.handleProxy(),e="".concat(e,"/data/datasources.json"),e=this.handleParentRes(e);return SuperMap.FetchRequest.get(e,null,{withCredentials:this.handleWithCredentials(t,e,!1),proxy:t}).then(function(e){return e.json()}).then(function(e){if(401===e.code)throw Error(e.errorMsg);return e.datasourceNames[0]})}},{key:"_getDataService",value:function(t,i){var e=this.handleProxy(),r="".concat(this.serverUrl,"web/datas/").concat(t,".json"),r=this.handleParentRes(r);return SuperMap.FetchRequest.get(r,null,{withCredentials:this.handleWithCredentials(e,r,this.withCredentials),proxy:e}).then(function(e){return e.json()}).then(function(e){return e.fileId=t,e.datasetName=i,e})}},{key:"_checkUploadToRelationship",value:function(e){var t=this.handleProxy(),e="".concat(this.serverUrl,"web/datas/").concat(e,"/datasets.json"),e=this.handleParentRes(e);return SuperMap.FetchRequest.get(e,null,{withCredentials:this.handleWithCredentials(t,e,this.withCredentials),proxy:t}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"_handleMapUrl",value:function(){var e=this.serverUrl+"web/maps/"+this.mapId+"/map";(this.accessToken||this.accessKey)&&(e+="token="+this.accessToken);var t,i="getUrlResource.json?url=";return this.excludePortalProxyUrl&&-1<this.serverUrl.indexOf(i)&&(1<(t=this.serverUrl.split(i)).length&&(e=t[0]+i+this.serverUrl+"web/maps/"+this.mapId+"/map.json")),e=-1===e.indexOf(".json")?"".concat(e,".json"):e}},{key:"handleProxy",value:function(e){if(!this.proxy)return null;e=this.proxyOptions[e||"data"],e=this.serverUrl+e;return e="string"==typeof this.proxy?this.proxy:e}},{key:"handleWithCredentials",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.withCredentials;return!(!e||!e.startsWith(this.serverUrl)||t&&!t.startsWith(e))||(!!(t&&this.iportalServiceProxyUrl&&0<=t.indexOf(this.iportalServiceProxyUrl))||i)}},{key:"isIportalResourceUrl",value:function(e){return e.startsWith(this.serverUrl)||this.iportalServiceProxyUrl&&0<=e.indexOf(this.iportalServiceProxyUrl)}},{key:"handleParentRes",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.mapId,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"MAP";return this.isIportalResourceUrl(e)?Object($.t)(e,"parentResType=".concat(i,"&parentResId=").concat(t)):e}},{key:"_formatGeoJSON",value:function(e){e=e.features;return e.forEach(function(e,t){e.properties.index=t}),e}},{key:"_excelData2Feature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=e.colTitles,r=i.indexOf(t.xField),a=i.indexOf(t.yField);if(a<0||r<0)for(var n=0,o=i.length;n<o;n++)Object($.n)(i[n])&&(r=n),Object($.o)(i[n])&&(a=n);for(var s=[],l=0,h=e.rows.length;l<h;l++){for(var u=e.rows[l],c=Number(u[r]),u=Number(u[a]),d={},f=0;f<e.colTitles.length;f++)d[e.colTitles[f].trim()]=e.rows[l][f];d.index=l+"",s.push({type:"Feature",geometry:{type:"Point",coordinates:[c,u]},properties:d})}return s}},{key:"_excelData2FeatureByDivision",value:function(t,e,i){var r=this,a=-1!==["城市","City"].indexOf(e)?"MunicipalData":"ProvinceData";if(window[a]&&window[a].features)return new Promise(function(e){e(r._combineFeature(t,window[a],i))});var n=-1!==["城市","City"].indexOf(e)?"MunicipalData.js":"ProvincialData.js",e=this.handleProxy(),n="".concat(this.serverUrl,"apps/dataviz/libs/administrative_data/").concat(n);return SuperMap.FetchRequest.get(n,null,{withCredentials:!1,proxy:e,withoutFormatSuffix:!0}).then(function(e){return e.text()}).then(function(e){return new Function(e)(),r._combineFeature(t,window[a],i)})}},{key:"_combineFeature",value:function(e,a,t){var n=this,o={type:"FeatureCollection",features:[]};if(e.length<2)return o;var s=e.colTitles,e=e.rows,l=s.findIndex(function(e){return e===t});return e.forEach(function(t){var e,i,r=a.features.find(function(e){return n._isMatchAdministrativeName(e.properties.Name,t[l])});r&&(e=r.properties.Province,i={properties:{},geometry:r.geometry,type:"Feature"},t.forEach(function(e,t){i.properties[s[t]]=e}),e&&(i.properties.Province=e),o.features.push(i))}),o}},{key:"_isMatchAdministrativeName",value:function(e,t){if(e&&"string"==typeof t&&t.constructor===String){var i=e.trim().substr(0,2);return"阿拉"===(i="张家"===i?e.trim().substr(0,3):i)&&(i=e.trim().substr(0,3)),!!t.startsWith(i)}return!1}},{key:"_getTileLayerInfo",value:function(e,t){var r=this,a=this.handleProxy(),n=t.split("EPSG:")[1],e="".concat(e,"/maps.json"),e=this.handleParentRes(e);return SuperMap.FetchRequest.get(e,null,{withCredentials:this.handleWithCredentials(a,e,this.withCredentials),proxy:a}).then(function(e){return e.json()}).then(function(e){var i=[];return e&&e.forEach(function(t){var e=SuperMap.FetchRequest.get("".concat(t.path,".json?prjCoordSys=").concat(JSON.stringify({epsgCode:n})),null,{withCredentials:r.withCredentials,proxy:a}).then(function(e){return e.json()}).then(function(e){return e.url=t.path,e});i.push(e)}),Promise.all(i).then(function(e){return e})})}},{key:"_getFeatureBySQL",value:function(e,t,i,r,a){var n=new SuperMap.FilterParameter({name:t.join().replace(":","@"),attributeFilter:null}),t=new SuperMap.GetFeaturesBySQLParameters({queryParameter:n,datasetNames:t,fromIndex:0,toIndex:-1,maxFeatures:-1,returnContent:!0});a&&(t.targetEpsgCode="EPSG:3857"===a||"EPSG:-1000"===a?4326:+a.split(":")[1]);a=this.handleProxy(),a={proxy:a,withCredentials:this.handleWithCredentials(a,e,!1),eventListeners:{processCompleted:function(e){i&&i(e)},processFailed:function(e){r&&r(e)}}},e=this.handleParentRes(e);new SuperMap.GetFeaturesBySQLService(e,a).processAsync(t)}},{key:"getEpsgCodeInfo",value:function(i,r){return x(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="/"===r.slice(-1)?r:"".concat(r,"/"),t="".concat(t,"epsgcodes/").concat(i,".json"),e.next=4,SuperMap.FetchRequest.get(t,null).then(function(e){return e.json()}).then(function(e){return e.wkt}).catch(function(e){console.error(e)});case 4:return t=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}))}}])&&m(e.prototype,t),i&&m(e,i),a}(),C=i("fr48"),M=i("Nwvx");function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=I(i);return function(e,t){{if(t&&("object"===T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,r?(e=I(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(e,o,s,l){return new(s=s||Promise)(function(i,t){function r(e){try{n(l.next(e))}catch(e){t(e)}}function a(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}n((l=l.apply(e,o||[])).next())})},D=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(n,o["a"]);var e,t,i,a=O(n);function n(e,t,i){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=a.call(this)).echartslayer=[],r._layers=[],r.serverUrl=t.serverUrl||"https://www.supermapol.com",r.accessToken=t.accessToken,r.accessKey=t.accessKey,r.tiandituKey=t.tiandituKey||"",r.withCredentials=t.withCredentials||!1,r.proxy=t.proxy,r.target=t.target||"map",r.excludePortalProxyUrl=t.excludePortalProxyUrl,r.isSuperMapOnline=t.isSuperMapOnline,r.ignoreBaseProjection=t.ignoreBaseProjection,r.echartslayer=[],r.webMapService=new _(e,t),r.mapOptions=i,r.eventTypes=["getmapinfofailed","crsnotsupport","getlayerdatasourcefailed","addlayerssucceeded","notsupportmvt","notsupportbaidumap","projectionIsNotMatch","beforeremovemap"],r.mapId=e,r}return e=n,(t=[{key:"echartsLayerResize",value:function(){this.echartslayer.forEach(function(e){e.chart.resize()})}},{key:"setMapId",value:function(e){var t=this;"string"==typeof e||"number"==typeof e?(this.mapId=e,this.webMapInfo=null):null!==e&&"object"===T(e)&&(this.webMapInfo=e),this.webMapService.setMapId(e),setTimeout(function(){t._initWebMap()},0)}},{key:"setServerUrl",value:function(e){this.serverUrl=e,this.webMapService.setServerUrl(e)}},{key:"setWithCredentials",value:function(e){this.withCredentials=e,this.webMapService.setWithCredentials(e)}},{key:"setProxy",value:function(e){this.proxy=e,this.webMapService.setProxy(e)}},{key:"setZoom",value:function(e){this.map&&(this.mapOptions.zoom=e)!==+this.map.getZoom().toFixed(2)&&(!e&&0!==e||this.map.setZoom(e,{from:"setZoom"}))}},{key:"setMaxBounds",value:function(e){this.map&&(this.mapOptions.maxBounds=e)&&this.map.setMaxBounds(e)}},{key:"setMinZoom",value:function(e){this.map&&(!(this.mapOptions.minZoom=e)&&0!==e||this.map.setMinZoom(e))}},{key:"setMaxZoom",value:function(e){this.map&&(!(this.mapOptions.maxZoom=e)&&0!==e||this.map.setMinZoom(e))}},{key:"initWebMap",value:function(){if(this.cleanWebMap(),this.serverUrl=this.serverUrl&&this.webMapService.handleServerUrl(this.serverUrl),this.webMapInfo){var e=this.webMapInfo;return e.mapParams={title:this.webMapInfo.title,description:this.webMapInfo.description},this.mapParams=e.mapParams,void this._getMapInfo(e)}this.mapId&&this.serverUrl?(this._taskID=new Date,this.getMapInfo(this._taskID)):this._createMap()}},{key:"getMapInfo",value:function(t){var i=this;this.serverUrl=this.serverUrl&&this.webMapService.handleServerUrl(this.serverUrl),this.webMapService.getMapInfo().then(function(e){i._taskID===t&&(i.mapParams=e.mapParams,i._getMapInfo(e,t))},function(e){throw e}).catch(function(e){i.triggerEvent("getmapinfofailed",{error:e}),console.log(e)})}},{key:"getBaseLayerType",value:function(e){var t=e.layerType;switch(t=-1<t.indexOf("TIANDITU_VEC")||-1<t.indexOf("TIANDITU_IMG")||-1<t.indexOf("TIANDITU_TER")?"TIANDITU":t){case"TILE":case"SUPERMAP_REST":return"TILE";case"CLOUD":case"CLOUD_BLACK":return"CLOUD";case"OSM":case"JAPAN_ORT":case"JAPAN_RELIEF":case"JAPAN_PALE":case"JAPAN_STD":case"GOOGLE_CN":case"GOOGLE":return"XYZ";default:return t}}},{key:"getMapurls",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{CLOUD:e.CLOUD||"http://t2.dituhui.com/FileService/image?map=quanguo&type=web&x={x}&y={y}&z={z}",CLOUD_BLACK:e.CLOUD_BLACK||"http://t3.dituhui.com/MapService/getGdp?x={x}&y={y}&z={z}",OSM:e.OSM||"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",GOOGLE:"https://www.google.cn/maps/vt/pb=!1m4!1m3!1i{z}!2i{x}!3i{y}!2m3!1e0!2sm!3i380072576!3m8!2szh-CN!3scn!5e1105!12m4!1e68!2m2!1sset!2sRoadmap!4e0!5m1!1e0",GOOGLE_CN:"https://mt{0-3}.google.cn/vt/lyrs=m&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",JAPAN_STD:"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",JAPAN_PALE:"https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png",JAPAN_RELIEF:"https://cyberjapandata.gsi.go.jp/xyz/relief/{z}/{x}/{y}.png",JAPAN_ORT:"https://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg"}}},{key:"getLayerFeatures",value:function(r,a,e){var t=this,e=this.webMapService.getLayerFeatures(e,r,this.baseProjection);e&&e.then(function(i){return F(t,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mapId&&this._taskID!==a)return e.abrupt("return");e.next=2;break;case 2:if(!i||!r.projection){e.next=8;break}if(Object(C.a)(r.projection)){e.next=8;break}return e.next=6,this.webMapService.getEpsgCodeInfo(r.projection.split(":")[1],this.serverUrl);case 6:(t=e.sent)&&Object(C.b)(r.projection,t);case 8:this._getLayerFeaturesSucceeded(i,r);case 9:case"end":return e.stop()}},e,this)}))},function(e){throw new Error(e)}).catch(function(e){t._addLayerSucceeded(),t.triggerEvent("getlayerdatasourcefailed",{error:e,layer:r,map:t.map}),console.log(e)})}},{key:"setFeatureInfo",value:function(e){var t=e.dv_v5_markerInfo;if(!t||!t.dataViz_title)return t;var i,r=t,a=e.properties;for(i in r)a[i]&&(r[i]=a[i],delete a[i]);return r}},{key:"getRankStyleGroup",value:function(t,e,i){var r=[],a=[],n=i.style,o=i.themeSetting,s=o.segmentMethod,l=o.segmentCount,h=o.customSettings,u=i.themeSetting.minRadius,i=i.themeSetting.maxRadius,c=o.colors,d=n.fillColor;e.forEach(function(e){e=e.properties[t];null!=e&&""!==e&&E()(+e)&&r.push(Number(e))});try{a=SuperMap.ArrayStatistic.getArraySegments(r,s,l)}catch(e){console.log(e)}for(var f,p,m=0;m<l;m++)m in h&&(f=h[m].segment.start,p=h[m].segment.end,null!=f&&(a[m]=f),null!=p&&(a[m+1]=p));var y=[];if(a&&a.length){for(var v,g,b=a.length,x=(i-u)/(b-1),w=Number(((i+u)/2).toFixed(2)),S="",P=c?SuperMap.ColorsPickerUtil.getGradientColors(c,b,"RANGE"):[],_=0;_<b-1;_++)w=(v=Number(a[_].toFixed(2)))===(g=Number(a[_+1].toFixed(2)))?w:u+Math.round(x*_),g=_===b-2?g+.01:g,w=h[_]&&h[_].radius?h[_].radius:w,n.radius=w,c&&0<c.length&&(S=h[_]&&h[_].color?h[_].color:P[_]||d,n.fillColor=S),y.push({radius:w,color:S,start:v,end:g,style:n});return y}return!1}},{key:"createRankStyleSource",value:function(e,t){var i=e.themeSetting.themeField,t=this.getRankStyleGroup(i,t,e);return!!t&&{parameters:e,styleGroups:t}}},{key:"isMatchAdministrativeName",value:function(e,t){if("string"!=typeof t||t.constructor!==String)return!1;var i=e.substr(0,2);return"张家"===i&&(i=e.substr(0,3)),!!t.match(new RegExp(i))}},{key:"getRestMapLayerInfo",value:function(e,t){var i=e.bounds,r=e.coordUnit,a=e.visibleScales,e=e.url;return t.layerType="TILE",t.orginEpsgCode=this.baseProjection,t.units=r&&r.toLowerCase(),t.extent=[i.left,i.bottom,i.right,i.top],t.visibleScales=a,t.url=e,t.sourceType="TILE",t}},{key:"handleLayerFeatures",value:function(e,t){var i=t.layerType,r=t.style,a=t.themeSetting,t=t.filterCondition;return e=(r||a)&&t&&"RANGE"!==i&&"UNIQUE"!==i&&"RANK_SYMBOL"!==i?this.getFilterFeatures(t,e):e}},{key:"mergeFeatures",value:function(e,t,i){if(t=t.map(function(e,t){return Object.prototype.hasOwnProperty.call(e.properties,"index")||(e.properties.index=t),e}),!i&&t&&t[0]&&t[0].geometry)return t;e=this.map.getSource(e);if((!e||!e._data.features)&&t&&t[0]&&t[0].geometry)return t;var r=e&&e._data&&e._data.features,a=[];return!i&&r?r:(t.forEach(function(t){var e=r.find(function(e){return isNaN(+e.properties[i])&&isNaN(+t.properties[i])?JSON.stringify(e.properties[i]||"")===JSON.stringify(t.properties[i]||""):+e.properties[i]==+t.properties[i]});e?a.push(Object.assign(Object.assign({},e),t)):t.geometry&&a.push(t)}),a)}},{key:"getFilterFeatures",value:function(e,t){if(!e)return t;for(var i="select * from json where ("+this.replaceFilterCharacter(e)+")",r=[],a=0;a<t.length;a++){var n=t[a],o=void 0;try{o=window.jsonsql.query(i,{properties:n.properties})}catch(e){continue}o&&0<o.length&&r.push(n)}return r}},{key:"replaceFilterCharacter",value:function(e){return e=e.replace(/=/g,"==").replace(/AND|and/g,"&&").replace(/or|OR/g,"||").replace(/<==/g,"<=").replace(/>==/g,">=")}},{key:"getEchartsLayerOptions",value:function(e,t,i){var r=this.webMapService.getFeatureProperties(t),t=this._createLinesData(e,r),r=this._createPointsData(t,e,r);return this._createOptions(e,t,r,i)}},{key:"getDashStyle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"array";if(!e)return"array"===i?[]:"";var r,a=t;switch(e){case"solid":r=[];break;case"dot":r=[1,4*a];break;case"dash":r=[4*a,4*a];break;case"dashrailway":r=[8*a,12*a];break;case"dashdot":r=[4*a,4*a,+a,4*a];break;case"longdash":r=[8*a,4*a];break;case"longdashdot":r=[8*a,4*a,1,4*a];break;default:SuperMap.Util.isArray(e)&&(r=e),r=(e=SuperMap.String.trim(e).replace(/\s+/g,",")).replace(/\[|\]/gi,"").split(",")}return r="array"===i?r:r.join(",")}},{key:"getCanvasFromSVG",value:function(e,t,i){var r=document.createElement("canvas");r.id="dataviz-canvas-".concat((new Date).getTime()),r.style.display="none",t.appendChild(r),(window.canvg||s.a)(r.id,e,{ignoreMouse:!0,ignoreAnimation:!0,renderCallback:function(){300<r.width||300<r.height||i(r)},forceRedraw:function(){return!1}})}},{key:"getRangeStyleGroup",value:function(e,t){var i,r=e.featureType,a=e.style,n=e.themeSetting,o=n.customSettings,s=n.themeField,l=n.segmentCount,e=n.segmentMethod,n=n.colors,h=[];t.forEach(function(e){!(i=e.properties)||((e=i[s])||0===e)&&E()(+e)&&h.push(parseFloat(e))},this);var u=h&&h.length&&SuperMap.ArrayStatistic.getArraySegments(h,e,l);if(u){var c=l;i&&u[0]===u[i.length-1]&&(c=1,u.length=2);for(var d=0;d<u.length;d++){var f=u[d],f=0===d?Math.floor(100*f)/100:Math.ceil(100*f)/100+.1;u[d]=Number(f.toFixed(2))}for(var p=SuperMap.ColorsPickerUtil.getGradientColors(n,c,"RANGE"),m=0;m<c;m++)m in o&&(o[m].segment.start&&(u[m]=o[m].segment.start),o[m].segment.end&&(u[m+1]=o[m].segment.end));for(var y=[],v=0;v<c;v++){var g=p[v];v in o&&o[v].color&&(g=o[v].color),"LINE"===r?a.strokeColor=g:a.fillColor=g;var b=u[v],x=u[v+1],w=JSON.parse(JSON.stringify(a));y.push({style:w,color:g,start:b,end:x})}return y}}},{key:"getUniqueStyleGroup",value:function(e,t){var a=e.featureType,n=e.style,i=e.themeSetting,e=i.colors,o=i.customSettings,s=i.themeField,i=t&&t[0]&&t[0].properties||{};Object.keys(i).forEach(function(e){e.toLocaleUpperCase()===s.toLocaleUpperCase()&&(s=e)});var r,l=[];for(r in t){var h,u=t[r].properties[s],c=!1;for(h in l)if(l[h]===u){c=!0;break}c||l.push(u||"0")}var d=SuperMap.ColorsPickerUtil.getGradientColors(e,l.length),f=[];return l.forEach(function(e,t){var i=d[t],r=Object.assign({},n);e in o&&("object"===T(t=o[e])?r=Object.assign(r,t):("string"==typeof t&&(i=o[e]),"LINE"===a?r.strokeColor=i:r.fillColor=i)),f.push({color:i,style:r,value:e,themeField:s})},this),f}},{key:"transformFeatures",value:function(r){var a=this;return r&&r.forEach(function(e,t){var i=e.geometry&&e.geometry.coordinates;i&&0!==i.length&&(Object(M.a)(e,function(e){var t=a._unproject(e);e[0]=t[0],e[1]=t[1]}),r[t]=e)}),r}},{key:"handleSvgColor",value:function(e,t){var i=e.fillColor,r=e.fillOpacity,a=e.strokeColor,n=e.strokeOpacity,e=e.strokeWidth,t=t.getContext("2d");i&&(t.fillStyle=Object($.c)(i,r),t.fill()),(a||e)&&(t.strokeStyle=Object($.c)(a,n),t.lineWidth=e,t.stroke())}},{key:"_createLinesData",value:function(e,t){var n,o,s,l,r,a=this,h=[];return t&&t.length&&(n=e.from,o=e.to,"XY_FIELD"===n.type&&n.xField&&n.yField&&o.xField&&o.yField?t.forEach(function(e){var t=e[n.xField],i=e[n.yField],r=e[o.xField],a=e[o.yField];t&&i&&r&&a&&(s=[e[n.xField],e[n.yField]],l=[e[o.xField],e[o.yField]],h.push({coords:[s,l]}))}):"PLACE_FIELD"===n.type&&n.field&&o.field&&(r=f.concat(d),t.forEach(function(e){var t=e[n.field],i=e[o.field];s=r.find(function(e){return a.isMatchAdministrativeName(e.name,t)}),l=r.find(function(e){return a.isMatchAdministrativeName(e.name,i)}),s&&l&&h.push({coords:[s.coord,l.coord]})}))),h}},{key:"_createPointsData",value:function(e,t,a){var i=[],n=t.labelSetting;if(!n.show||!e.length)return i;var o=[],s=[];return e.forEach(function(e,t){var e=e.coords,i=e[0],r=e[1],e=a[t][n.from],t=a[t][n.to];o.find(function(e){return e.value[0]===i[0]&&e.value[1]===i[1]})||o.push({name:e,value:i}),s.find(function(e){return e.value[0]===r[0]&&e.value[1]===r[1]})||s.push({name:t,value:r})}),i=o.concat(s)}},{key:"_createOptions",value:function(e,t,i,r){t=this._createLineSeries(e,t,r);return{series:i&&i.length?(r=this._createPointSeries(e,i,r),t.concat(r)):t.slice()}}},{key:"_createPointSeries",value:function(e,t,i){var r=e.lineSetting,a=e.animationSetting,e=e.labelSetting,t=[{name:"point-series",coordinateSystem:i,zlevel:2,label:{normal:{show:e.show,position:"right",formatter:"{b}",color:e.color,fontFamily:e.fontFamily}},itemStyle:{normal:{color:r.color||e.color}},data:t}];return a.show?(t[0].type="effectScatter",t[0].rippleEffect={brushType:"stroke"}):t[0].type="scatter",t}},{key:"_createLineSeries",value:function(e,t,i){var r=e.lineSetting,e=e.animationSetting,r=[{name:"line-series",coordinateSystem:i,type:"lines",zlevel:1,effect:{show:e.show,constantSpeed:e.constantSpeed,trailLength:0,symbol:e.symbol,symbolSize:e.symbolSize},lineStyle:{normal:{color:r.color,type:r.type,width:r.width,opacity:r.opacity,curveness:r.curveness}},data:t}];return 1e3<=t.length&&(r[0].large=!0,r[0].largeThreshold=100,r[0].blendMode="lighter"),r}},{key:"_getLayerFeaturesSucceeded",value:function(e,t){switch(e.type){case"feature":this._initOverlayLayer(t,e.features);break;case"restMap":t.layerType="restMap",this._initOverlayLayer(t,e.restMaps);break;case"mvt":t.layerType="mvt",this._initOverlayLayer(t,e);break;case"dataflow":case"noServerId":this._initOverlayLayer(t)}}}])&&k(e.prototype,t),i&&k(e,i),n}(),B=i("p5/s");function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=V(i);return function(e,t){{if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,r?(e=V(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var z=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(s,D);var e,t,i,o=j(s);function s(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{style:{version:8,sources:{},layers:[]}},a=3<arguments.length?arguments[3]:void 0,n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:function(){return!0};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e,i,r))._cacheLayerId=[],t._layerTimerList=[],"string"==typeof e||"number"==typeof e?t.mapId=e:null!==e&&"object"===R(e)&&(t.webMapInfo=e),t.mapId||r.center||r.zoom||(r.center=[0,0],r.zoom=0),t.centerValid(r.center)&&(t.center=r.center),t.zoom=r.zoom,t.bounds=r.bounds,t.bearing=r.bearing,t.pitch=r.pitch,t.rasterTileSize=r.rasterTileSize||256,t.layerFilter=n,t.checkSameLayer=i.checkSameLayer,t._legendList={},a?(t.map=a,t._taskID=new Date,t.getMapInfo(t._taskID)):t._initWebMap(),t}return e=s,(t=[{key:"resize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.map&&this.map.resize(),this.echartsLayerResize();var t=window.getComputedStyle(document.getElementById(this.target));e&&this.map&&this.bounds&&t&&((t=this._getResizedZoom(this.bounds,t))!==this.map.getZoom()&&this.map&&this.map.setZoom(t))}},{key:"setCrs",value:function(e){this.map&&(this.mapOptions.crs=e,this.mapOptions.crs&&(e.epsgCode?(this.mapOptions.crs=new p.a.CRS(this.mapOptions.crs.epsgCode,this.mapOptions.crs.extent,this.mapOptions.crs.unit),this.map.setCRS(this.mapOptions.crs)):this.map.setCRS(p.a.CRS.get(e))))}},{key:"setCenter",value:function(e){var t,i;this.map&&this.centerValid(e)&&(this.mapOptions.center=e,t=(i=this.map.getCenter()).lng,i=i.lat,e[0]===+t.toFixed(4)&&e[1]===+i.toFixed(4)||this.map.setCenter(e,{from:"setCenter"}))}},{key:"setRenderWorldCopies",value:function(e){this.map&&(this.mapOptions.renderWorldCopies=e)&&this.map.setRenderWorldCopies(e)}},{key:"setBearing",value:function(e){this.map&&(this.mapOptions.bearing=e)!==+this.map.getBearing().toFixed(2)&&(!e&&0!==e||this.map.setBearing(e))}},{key:"setPitch",value:function(e){this.map&&(this.mapOptions.pitch=e)!==+this.map.getPitch().toFixed(2)&&(!e&&0!==e||this.map.setPitch(e))}},{key:"setStyle",value:function(e){this.map&&(this.mapOptions.style=e)&&this.map.setStyle(e)}},{key:"setRasterTileSize",value:function(t){var i,r=this;this.map&&(t<=0||(i=this.map.getStyle().sources,Object.keys(i).forEach(function(e){"raster"===i[e].type&&"iserver"===i[e].rasterSource&&r._updateRasterSource(e,{tileSize:t})})))}},{key:"cleanLayers",value:function(){var t=this;this._taskID=null,this._cacheLayerId.forEach(function(e){t.map&&t.map.getLayer(e)&&t.map.removeLayer(e)}),this._cacheLayerId.forEach(function(e){t.map&&t.map.getSource(e)&&t.map.removeSource(e)}),this._cacheLayerId=[]}},{key:"getSourceListModel",get:function(){return this._sourceListModel}},{key:"_initWebMap",value:function(){this.initWebMap()}},{key:"_loadLayers",value:function(e,t){var i=this;this.map?this.map.getCRS().epsgCode===this.baseProjection||this.ignoreBaseProjection?this._handleLayerInfo(e,t):this.triggerEvent("projectionIsNotMatch",{}):(this._createMap(e),this.map.on("load",function(){i._handleLayerInfo(e,t)}))}},{key:"_getMapInfo",value:function(t,i){var r=this,a=t.projection;if(this.baseProjection=Object(C.c)(a),p.a.CRS.get(this.baseProjection))this._defineProj4(a),this._loadLayers(t,i);else{if(!t.baseLayer||"TILE"!==t.baseLayer.layerType)throw Error(Object(n.b)().t("webmap.crsNotSupport"));this.getEpsgCodeWKT("".concat(t.baseLayer.url,"/prjCoordSys.wkt"),{withoutFormatSuffix:!0}).then(function(e){r._defineProj4(e,a);e=t.extent,e=new p.a.CRS(r.baseProjection,[e.leftBottom.x,e.leftBottom.y,e.rightTop.x,e.rightTop.y],180<e.rightTop.x?"meter":"degree");p.a.CRS.set(e),r._loadLayers(t,i)})}}},{key:"_handleLayerInfo",value:function(e,t){e=this._setLayerID(e),this._layers=[];var i=e,r=i.layers,a=i.baseLayer,i=i.grid;"function"==typeof this.layerFilter&&this.layerFilter(a)&&this._initBaseLayer(e),r&&0!==r.length?this._initOverlayLayers(r,t):this._sendMapToUser(0,0),i&&i.graticule&&this._initGraticuleLayer(i.graticule)}},{key:"_createMap",value:function(e){var r=this;if(!e)return this.mapOptions.container=this.target,this.mapOptions.crs&&this.mapOptions.crs.epsgCode&&(this.mapOptions.crs=new p.a.CRS(this.mapOptions.crs.epsgCode,this.mapOptions.crs.extent,this.mapOptions.crs.unit)),this.mapOptions.transformRequest||(this.mapOptions.transformRequest=function(e,t){var i="";return{url:(i="string"==typeof r.proxy?r.webMapService.handleProxy("Tile"===t?"image":"data"):i)?+"".concat(i).concat(encodeURIComponent(e)):e,credentials:r.webMapService.handleWithCredentials(i,e,r.withCredentials||!1)?"include":"omit"}}),void setTimeout(function(){var e=0;Object.prototype.hasOwnProperty.call(r.mapOptions,"fadeDuration")&&(e=r.mapOptions.fadeDuration),r.map=new p.a.Map(Object.assign(Object.assign({},r.mapOptions),{fadeDuration:e,renderWorldCopies:!1})),r.map.on("load",function(){r.triggerEvent("addlayerssucceeded",{map:r.map,mapparams:{},layers:[]})})},0);var t=this._getLabelFontFamily(e),i=this._getMapCenter(e),a=e.level||0,n=this.mapOptions,o=n.bounds,s=n.minZoom,l=n.maxZoom,h=this.mapOptions.interactive;isNaN(s)&&(s=e.minScale?this._transformScaleToZoom(e.minScale,p.a.CRS.get(this.baseProjection)):0),isNaN(l)&&(l=e.maxScale?this._transformScaleToZoom(e.maxScale,p.a.CRS.get(this.baseProjection)):22),e.visibleExtent&&4===e.visibleExtent.length&&!o&&(o=[this._unproject([e.visibleExtent[0],e.visibleExtent[1]]),this._unproject([e.visibleExtent[2],e.visibleExtent[3]])]),l<s&&(s=(n=[l,s])[0],l=n[1]),o||(a+=e.minScale&&e.maxScale?Math.min(this._transformScaleToZoom(e.minScale,p.a.CRS.get(this.baseProjection)),this._transformScaleToZoom(e.maxScale,p.a.CRS.get(this.baseProjection))):+Math.log2(this._getResolution(p.a.CRS.get(this.baseProjection).getExtent())/this._getResolution(e.extent)).toFixed(2)),this.map=new p.a.Map(Object.assign(Object.assign({},this.mapOptions),{container:this.target,center:this.center||i,zoom:this.zoom||a,minZoom:s,maxZoom:l,bearing:this.bearing||0,pitch:this.pitch||0,bounds:o,interactive:void 0===h||h,style:{version:8,sources:{},layers:[]},crs:this.baseProjection,localIdeographFontFamily:t||"",renderWorldCopies:!1,transformRequest:function(e,t){if("Tile"!==t)return{url:e};r.isSuperMapOnline&&0===e.indexOf("http://")&&(e="https://www.supermapol.com/apps/viewer/getUrlResource.png?url=".concat(encodeURIComponent(e))),r.webMapService.isIportalResourceUrl(e)&&(e=r.webMapService.handleParentRes(e));t=r.webMapService.handleProxy("image");return{url:e,credentials:r.webMapService.handleWithCredentials(t,e,!1)?"include":"omit"}},fadeDuration:0})),this.triggerEvent("mapinitialized",{map:this.map})}},{key:"_createMVTBaseLayer",value:function(e){e=e.dataSource.url;-1<e.indexOf("/restjsr/")&&!/\/style\.json$/.test(e)&&(e+="/style.json"),this.map.addStyle(e)}},{key:"_initBaseLayer",value:function(e){var t,i=e.baseLayer||e,r=this.getBaseLayerType(i),a=this.getMapurls();switch(this.baseLayerProxy=this.webMapService.handleProxy("image"),r){case"TIANDITU":this.baseLayerProxy=null,this._createTiandituLayer(e);break;case"BING":this.baseLayerProxy=null,this._createBingLayer(i.layerID||i.name,i);break;case"WMS":this._createWMSLayer(i);break;case"WMTS":this._createWMTSLayer(i);break;case"TILE":this._createDynamicTiledLayer(i);break;case"CLOUD":case"XYZ":t=a[i.layerType],this._createXYZLayer(i,t);break;case"BAIDU":this.triggerEvent("notsupportbaidumap",{});break;case"MAPBOXSTYLE":this._createMVTBaseLayer(i)}}},{key:"_initOverlayLayers",value:function(e,a){var n=this;"function"==typeof this.layerFilter&&(e=e.filter(this.layerFilter)),this._layers=e,this.layerAdded=0,this.expectLayerLen=e.length,0<this.expectLayerLen&&e.forEach(function(e){var t,i,r=n.webMapService.getDatasourceType(e);if("SAMPLE_DATA"===r)return n._addLayerSucceeded(),void n.triggerEvent("getlayerdatasourcefailed",{error:"SAMPLE DATA is not supported",layer:e,map:n.map});e.visibleScale&&(t=(i=e.visibleScale).minScale,i=i.maxScale,e.minzoom=Math.max(n._transformScaleToZoom(t),0),e.maxzoom=Math.min(24,n._transformScaleToZoom(i)+1e-7)),"tile"===r?(n._initBaseLayer(e),n._addLayerSucceeded(),e.autoUpdateTime&&n._layerTimerList.push(setInterval(function(){n._initBaseLayer(e)},e.autoUpdateTime))):(n.getLayerFeatures(e,a,r),e.autoUpdateTime&&n._layerTimerList.push(setInterval(function(){n.getLayerFeatures(e,a,r)},e.autoUpdateTime)))},this)}},{key:"_initOverlayLayer",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=2<arguments.length?arguments[2]:void 0,r=e.layerID,a=e.layerType,n=e.visible,o=e.style,s=e.featureType,l=e.labelStyle,h=e.projection;e.visible=n?"visible":"none",t=this.mergeFeatures(r,t,i),"restMap"!==a?"mvt"!==a?((t=t&&t[0]&&t[0].geometry&&"Polygon"===t[0].geometry.type?Object(u.a)(t):t)&&h&&(h!==this.baseProjection||"EPSG:3857"===h||"EPSG:-1000"===h)&&e.dataSource&&"REST_DATA"!==e.dataSource.type&&(this._unprojectProjection=this._defineProj4(h),t=this.transformFeatures(t)),t=this.handleLayerFeatures(t,e),"VECTOR"===a?"POINT"===s?"SYMBOL_POINT"===o.type?this._createSymbolLayer(e,t):this._createGraphicLayer(e,t):(this._createVectorLayer(e,t),this._addLayerSucceeded()):"UNIQUE"===a?this._createUniqueLayer(e,t):"RANGE"===a?this._createRangeLayer(e,t):"HEAT"===a?this._createHeatLayer(e,t):"MARKER"===a?this._createMarkerLayer(e,t):"MIGRATION"===a?this._createMigrationLayer(e,t):"RANK_SYMBOL"===a?this._createRankSymbolLayer(e,t):"DATAFLOW_POINT_TRACK"!==a&&"DATAFLOW_HEAT"!==a||this._createDataflowLayer(e),l&&l.labelField&&"DATAFLOW_POINT_TRACK"!==a&&this._addLabelLayer(e,t,!1)):this._createMvtLayer(t.info,e,t.featureType):this._createRestMapLayer(t,e)}},{key:"_initGraticuleLayer",value:function(e){var t=this._createGraticuleOptions(e),t=new p.a.supermap.GraticuleLayer(t);this.map.addLayer(t),this._setGraticuleDash(e.lineDash,t)}},{key:"_createGraticuleOptions",value:function(e){if(!e)return null;var t=e.extent,i=e.lonLabelStyle,r=e.latLabelStyle,a=e.strokeColor,n=e.lineDash,o=e.strokeWidth,e=e.interval,o={lineColor:a,lindDasharray:n,lineWidth:o},i={textFont:i.fontFamily.split(","),textSize:i.fontSize,textAnchor:r.textBaseline,textColor:i.fill,textHaloColor:i.outlineColor,textHaloWidth:i.outlineWidth},r={textFont:r.fontFamily.split(","),textSize:r.fontSize,textAnchor:r.textBaseline,textColor:r.fill,textHaloColor:r.outlineColor,textHaloWidth:r.outlineWidth},t=t||this.map.getCRS().extent;return{minZoom:1,strokeStyle:o,extent:[this._unproject([t[0],t[1]]),this._unproject([t[2],t[3]])],interval:e&&e[0],lngLabelStyle:i,latLabelStyle:r}}},{key:"_setGraticuleDash",value:function(e,t){var i=this;this.map.on("zoomend",function(){i.map.getZoom()<3?t.setStrokeStyle({lindDasharray:[.1,3]}):t.setStrokeStyle({lindDasharray:e})})}},{key:"_createTiandituLayer",value:function(e){var t=this._getTiandituUrl(e),i=e.baseLayer,r=i.labelLayerVisible,a=i.name,e=i.visible,i=Boolean(r),r=t.labelUrl,t=t.tiandituUrl;this._addBaselayer(t,a,e),i&&this._addBaselayer(r,"".concat(a,"-label"),e)}},{key:"_createWMTSLayer",value:function(r){var a=this;this.webMapService.getWmtsInfo(r,this.map.getCRS().epsgCode).then(function(e){var t,i=r.layerID||r.name;e.isMatched&&(t=a._getWMTSUrl(Object.assign({},r,e)),a._addBaselayer([t],i,r.visible,0,e.matchMaxZoom,!1,e.bounds))},function(e){throw new Error(e)}).catch(function(e){a.triggerEvent("getmapinfofailed",{error:e})})}},{key:"_createBingLayer",value:function(e,t){this._addBaselayer(["https://dynamic.t0.tiles.ditu.live.com/comp/ch/{quadkey}?it=G,TW,L,LA&mkt=zh-cn&og=109&cstl=w4c&ur=CN&n=z"],e,t.visible)}},{key:"_createXYZLayer",value:function(e,t){var i=[];if("OSM"===e.layerType){for(var r=t.match(/\w\-\w/g)[0],a=r[0],n=r[2],o="",s=97;s<123;s++)o+=String.fromCharCode(s);for(var r=o.split(""),a=r.indexOf(a),n=r.indexOf(n),l=r.slice(a,n+1),h=0;h<l.length;h++){var u=t.replace(/{\w\-\w}/g,l[h]);i.push(u)}}else if("GOOGLE_CN"===e.layerType)for(var n=t.match(/\d\-\d/g)[0],c=parseInt(n[0]),d=parseInt(n[2]),f=c;f<=d;f++){var p=t.replace(/{\d\-\d}/g,f.toString());i.push(p)}else i=[t];c=e.layerID||e.name;this._addBaselayer(i,c,e.visible)}},{key:"_createDynamicTiledLayer",value:function(e){var t=e.url,i=e.layerID||e.name,r=e.minzoom,a=e.maxzoom;this._addBaselayer([t],i,e.visible,r,a,!0)}},{key:"_createWMSLayer",value:function(i){var r=this;this.webMapService.getWmsInfo(i).then(function(e){var t=i.layerID||i.name;e&&(e=r._getWMSUrl(i,e.version),r._addBaselayer([e],t,i.visible))},function(e){throw new Error(e)}).catch(function(e){r.triggerEvent("getmapinfofailed",{error:e})})}},{key:"_createVectorLayer",value:function(e,t){var i=this,r=e.featureType,a=e.layerID,n=e.minzoom,o=e.maxzoom,s=e.style,l=e.visible,e=this.map.getSource(a),t={type:"FeatureCollection",features:t};e?e.setData(t):this.map.addSource(a,{type:"geojson",data:t});t=Array.isArray(s)?s:[s];2===t.length&&("solid"===t[0].lineDash&&"solid"===t[1].lineDash&&(t[0].strokeWidth=t[1].strokeWidth,t[1].strokeWidth=t[1].strokeWidth-2),"solid"===t[0].lineDash&&"dash"===t[1].lineDash&&(t[0].strokeWidth=t[1].strokeWidth,t[1].strokeWidth=.5*t[1].strokeWidth,t[1].lineDash="dashrailway")),t.forEach(function(e,t){e={style:i._transformStyleToMapBoxGl(e,r),layout:{visibility:l}},t=0===t?a:"".concat(a,"-additional-").concat(t);i._addOverlayToMap(r,a,t,e,n,o)}),"POLYGON"===r&&s.strokeColor&&this._addStrokeLineForPoly(s,a,a+"-strokeLine",l,n,o)}},{key:"_getWMSUrl",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"1.1.1",i=(i=e.url).split("?")[0],e={service:"WMS",request:"GetMap",layers:null!==e.layers&&"object"===R(e.layers)?e.layers.join(","):e.layers||"0",styles:"",format:"image/png",transparent:"true",version:t,width:256,height:256};return"1.3.0"===t?e.crs=this.baseProjection:e.srs=this.baseProjection,i+="".concat(this._getParamString(e,i),"&bbox={bbox-epsg-3857}")}},{key:"_setLayerID",value:function(e){var a=this,n={},o=e.baseLayer,t=e.layers,i=void 0===t?[]:t;this.checkSameLayer||(t=this._generateUniqueLayerId(o.name,0),o.name=t.newId);var s=i.map(function(e){return e.name}),i=i.map(function(e,t){e.name in n||(n[e.name]=o.name===e.name?1:0);var i=s.indexOf(e.name),r=s.lastIndexOf(e.name);i<t&&t<=r&&(n[e.name]=n[e.name]+1);i=n[e.name]?"".concat(e.name,"-").concat(n[e.name]):e.name;return a.checkSameLayer&&"raster"===e.layerType||(r=(t=a._generateUniqueLayerId(i,n[e.name])).newId,t=t.newIndex,n[e.name]=t,i=r),Object.assign(e,{layerID:i})});return e.layers=i,e.baseLayer=o,e}},{key:"_generateUniqueLayerId",value:function(e,t){return this.map.getLayer(e)?(t++,e=e.match(/-\d+&/gi)?e.replace(/\d+$/gi,t):"".concat(e,"-").concat(t),this._generateUniqueLayerId(e,t)):{newId:e,newIndex:t}}},{key:"_getResizedZoom",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:512,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:360,a=t.width,n=t.height,t=Math.abs(e.getEast()-e.getWest()),e=Math.abs(this._getBoundsRadian(e.getSouth())-this._getBoundsRadian(e.getNorth())),a=+Math.log2(r/(t/parseInt(a)*i)).toFixed(2),i=+Math.log2(r/(e/parseInt(n)*i)).toFixed(2);return a<=i?a:i}},{key:"_getBoundsRadian",value:function(e){return 180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360))}},{key:"_createRestMapLayer",value:function(e,t){var i=this;e.forEach(function(e){t=i.getRestMapLayerInfo(e,t),i._initBaseLayer(t)}),this._addLayerSucceeded()}},{key:"_addLayerSucceeded",value:function(){this.layerAdded++,this._sendMapToUser(this.layerAdded,this.expectLayerLen)}},{key:"_createDataflowLayer",value:function(e){var t=new p.a.supermap.DataFlowService(e.wsUrl).initSubscribe();this._handleDataflowFeaturesCallback=this._handleDataflowFeatures.bind(this,e),this._initDataflowLayerCallback=this._initDataflowLayer.bind(this,e),t.on("subscribesucceeded",this._initDataflowLayerCallback),t.on("messageSucceeded",this._handleDataflowFeaturesCallback),this._dataflowService=t}},{key:"_initDataflowLayer",value:function(){this._addLayerSucceeded()}},{key:"_handleDataflowFeatures",value:function(e,t){var i=[JSON.parse(t.data)];this.triggerEvent("dataflowfeatureupdated",{features:i,identifyField:e.identifyField,layerID:e.layerID}),"EPSG:3857"===e.projection&&(i=this.transformFeatures(i)),e.filterCondition?(t=this.replaceFilterCharacter(e.filterCondition),(t=window.jsonsql.query("select * from json where ("+t+")",{attributes:i[0].properties}))&&0<t.length&&this._addDataflowLayer(e,i[0])):this._addDataflowLayer(e,i[0])}},{key:"_getDataFlowRotateStyle",value:function(e,i,r){var a=["match",["get",r]];return e.forEach(function(e){var t=void 0!==i&&"未设置"!==i&&"None"!==i?e.properties[i]:0;if(360<t||t<0)return null;a.push(e.properties[r],parseInt(t))}),a.push(0),a}},{key:"_addDataflowLayer",value:function(e,t){var i,r,a=e.layerID;"DATAFLOW_HEAT"===e.layerType?this.map.getSource(a)?this._updateDataFlowFeature(a,t,e):this._createHeatLayer(e,[t],!1):(i=e.pointStyle,e.style=i,this.map.getSource(a)?this._updateDataFlowFeature(a,t,e,"point"):(r=this._getDataFlowRotateStyle([t],e.directionField,e.identifyField),-1!==["BASIC_POINT","SVG_POINT","IMAGE_POINT"].indexOf(i.type)?this._createGraphicLayer(e,[t],null,r,!1):this._createSymbolLayer(e,[t],null,r,!1)),e.labelStyle&&e.visible&&(this.map.getSource(a+"-label")?this._updateDataFlowFeature(a+"-label",t,e):this._addLabelLayer(e,[t],!0)),e.lineStyle&&e.visible&&(this.map.getSource(a+"-line")?this._updateDataFlowFeature(a+"-line",t,e,"line"):(r=t.geometry.coordinates,r={type:"Feature",properties:t.properties,geometry:{type:"LineString",coordinates:[r]}},this._createVectorLayer({style:e.lineStyle,featureType:"LINE",visible:"visible",layerID:a+"-line"},[r]))))}},{key:"_updateDataFlowFeature",value:function(e,i,t,r){var a=t.identifyField,n=t.maxPointCount,o=t.directionField,s=c()(this.map.getSource(e)._data.features),l=!1;s.map(function(e,t){e.properties[a]===i.properties[a]&&(l=!0,"line"===r?((e=e.geometry.coordinates).push(i.geometry.coordinates),n&&e.length>n&&e.splice(0,e.length-n),s[t].geometry.coordinates=e):s[t]=i)}),l||("line"===r?s.push({type:"Feature",properties:i.properties,geometry:{type:"LineString",coordinates:[i.geometry.coordinates]}}):s.push(i)),this.map.getSource(e).setData({type:"FeatureCollection",features:s}),"point"===r&&(t=t.pointStyle.type,o=this._getDataFlowRotateStyle(s,o,a),-1!==["SVG_POINT","IMAGE_POINT"].indexOf(t)?this.map.setLayoutProperty(e,"icon-rotate",o):"SYMBOL_POINT"===t&&this.map.setLayoutProperty(e,"text-rotate",o))}},{key:"_createMigrationLayer",value:function(e,t){window.echarts=r.a;e=this.getEchartsLayerOptions(e,t,"GLMap");e.GLMap={roam:!0};t=new a.a(this.map);t.chart.setOption(e),this.echartslayer.push(t),this._addLayerSucceeded()}},{key:"_createRankSymbolLayer",value:function(e,t){var i=e.minzoom,r=e.maxzoom,a=e.themeSetting.themeField,n=e.themeSetting.colors,o=e.style,s=e.featureType,l=this.createRankStyleSource(e,t).styleGroups;t=this.getFilterFeatures(e.filterCondition,t);for(var h,u=["match",["get","index"]],c=["match",["get","index"]],d=0;d<t.length;d++){var f=t[d],p=parseFloat(f.properties[a]);if(l)for(var m=0;m<l.length;m++)if(l[m].start<=p&&p<l[m].end){var y="SYMBOL_POINT"===o.type||"IMAGE_POINT"===o.type?"SYMBOL_POINT"===o.type?2*l[m].radius:2*Number.parseFloat((l[m].radius/o.imageInfo.size.h).toFixed(2)):l[m].radius;u.push(f.properties.index,y),c.push(f.properties.index,l[m].color);break}}u.push(1),c.push("rgba(0, 0, 0, 0)"),this._initLegendConfigInfo(e,l),n&&0<n.length&&(o.fillColor=c),"SYMBOL_POINT"===o.type?this._createSymbolLayer(e,t,u):"IMAGE_POINT"===o.type?this._createGraphicLayer(e,t,u):(h={type:"geojson",data:{type:"FeatureCollection",features:t}},(n={layout:{visibility:e.visible}}).style=this._transformStyleToMapBoxGl(e.style,s,u,"circle-radius"),e=e.layerID,this._addOverlayToMap(s,h,e,n,i,r),this._addLayerSucceeded())}},{key:"_addLabelLayer",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=e.labelStyle,a=r.backgroundFill,n=r.fontFamily,o=e.minzoom,s=e.maxzoom,l=parseFloat(r.fontSize||14),a="rgba(".concat(a.join(","),")"),h="rgba(255,255,255,0)";r.outlineColor&&0<r.outlineWidth?h=r.outlineColor:"line"!==r.placement&&(h=a||"rgba(255,255,255,1)");var u=(r.outlineWidth||0)/2;0===u&&"line"!==r.placement&&a&&(u=4);var c=r.textAlign||"center";r.textBaseline&&"middle"!==r.textBaseline&&(c="".concat(r.textBaseline).concat("center"===c?"":"-".concat(c)));a="POINT"===e.featureType?[r.offsetX/l||0,r.offsetY/l||0]:[0,0];this._addLayer({id:"".concat(e.layerID,"-label"),type:"symbol",source:this.map.getSource(e.layerID)&&!i?e.layerID:{type:"geojson",data:{type:"FeatureCollection",features:t}},paint:{"text-color":r.fill,"text-halo-color":h,"text-halo-width":u},layout:{"text-field":"{".concat(r.labelField,"}"),"text-size":l,"text-offset":a,"text-font":n?[n]:["DIN Offc Pro Italic","Arial Unicode MS Regular"],"symbol-placement":"line"===r.placement?"POLYGON"===e.featureType?"line":"line-center":"point","text-max-angle":"POLYGON"===e.featureType?40:30,"symbol-spacing":"POLYGON"===e.featureType?200:50,"text-anchor":c,"text-line-height":1.2,visibility:e.visible},minzoom:o||0,maxzoom:s||22})}},{key:"_createSymbolLayer",value:function(e,t,i,r){var a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],n=5<arguments.length?arguments[5]:void 0;document.getElementById("".concat(this.target)).classList.add("supermapol-icons-map");var o=e.layerID,s=e.minzoom,l=e.maxzoom,h=e.style,u=h.unicode,c=String.fromCharCode(parseInt(u.replace(/^&#x/,""),16)),u=i||(Array.isArray(h.fontSize)?h.fontSize:h.fontSize&&parseFloat(h.fontSize)||12),i=Array.isArray(h.rotation)?h.rotation:180*(h.rotation||0)/Math.PI;this.map.getSource(o)||this.map.addSource(o,{type:"geojson",data:{type:"FeatureCollection",features:[]}});l={id:o,type:"symbol",source:o,paint:{"text-color":Array.isArray(h.fillColor)?h.fillColor:Object($.c)(h.fillColor,h.fillOpacity),"text-halo-color":Array.isArray(h.strokeColor)?h.strokeColor:Object($.c)(h.strokeColor||"rgba(0,0,0,0)",h.strokeOpacity),"text-halo-width":h.strokeWidth||0},layout:{"text-field":c,"text-size":u,"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-rotate":r||i||0,"text-offset":Array.isArray(h.offsetX)?h.offsetX:[h.offsetX/2||0,h.offsetY/2||0],"text-allow-overlap":!0,visibility:e.visible},minzoom:s||0,maxzoom:l||22};n&&(l.filter=n),this._addLayer(l),this.map.getSource(o).setData({type:"FeatureCollection",features:t}),a&&this._addLayerSucceeded()}},{key:"_createGraphicLayer",value:function(r,e,a,n){var o=this,s=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],l=5<arguments.length?arguments[5]:void 0,h=r.layerID,u=r.minzoom,c=r.maxzoom,d=r.style,e={type:"geojson",data:{type:"FeatureCollection",features:e}};this.map.getSource(h)||this.map.addSource(h,e);var f,t,i="imageIcon-".concat(h);"IMAGE_POINT"===d.type?(t=d.imageInfo,this.map.loadImage(t.url,function(e,t){e?console.error(e):(e=2*Number.parseFloat((d.radius/t.width).toFixed(2)),o.map.hasImage(i)||o.map.addImage(i,t),t={id:h,type:"symbol",source:h,layout:{"icon-image":i,"icon-anchor":"bottom-right","icon-size":a||e,"icon-allow-overlap":!0,visibility:r.visible,"icon-offset":[d.offsetX*t.width||0,d.offsetY*t.height||0],"icon-rotate":n||180*(r.style.rotation||0)/Math.PI},minzoom:u||0,maxzoom:c||22},l&&(t.filter=l),o._addLayer(t),s&&o._addLayerSucceeded())})):"SVG_POINT"===d.type?(f=d.url,this._svgDiv||(this._svgDiv=document.createElement("div"),document.body.appendChild(this._svgDiv)),this.getCanvasFromSVG(f,this._svgDiv,function(i){var e=i.toDataURL("img/png");e&&o.map.loadImage(e,function(e,t){e&&console.log(e);e=2*Number.parseFloat((d.radius/i.width).toFixed(2));o.map.hasImage(f)||o.map.addImage(f,t,{sdf:!0});e={id:h,type:"symbol",source:h,layout:{"icon-image":f,"icon-size":a||e,"icon-anchor":"bottom-right",visibility:r.visible,"icon-offset":[d.offsetX*i.width||0,d.offsetY*i.height||0],"icon-allow-overlap":!0,"icon-rotate":n||180*(r.style.rotation||0)/Math.PI},paint:{"icon-color":d.fillColor},minzoom:u||0,maxzoom:c||22};l&&(e.filter=l),o._addLayer(e),s&&o._addLayerSucceeded()})})):(t={style:this._transformStyleToMapBoxGl(d,r.featureType),layout:{visibility:r.visible}},this._addOverlayToMap("POINT",h,h,t,u,c),s&&this._addLayerSucceeded())}},{key:"_createUniqueLayer",value:function(f,e){var p=this,n={unicode:function(e){e=e.unicode;return String.fromCharCode(parseInt(e.replace(/^&#x/,""),16))},fontSize:function(e){e=e.fontSize;return e?parseFloat(e):12},rotation:function(e){return 180*(e.rotation||0)/Math.PI},fillColor:function(e){var t=e.fillColor,e=e.fillOpacity;return Object($.c)(t,e)},strokeColor:function(e){var t=e.strokeColor,e=e.strokeOpacity;return Object($.c)(t||"rgba(0,0,0,0)",e)},strokeWidth:function(e){return e.strokeWidth||0},offsetX:function(e){return[e.offsetX/2||0,e.offsetY/2||0]}},t={unicode:"",fontSize:12,rotation:0,strokeColor:"rgba(0,0,0,0)",fillColor:"rgba(0,0,0,0)",strokeWidth:0,offsetX:[0,0]},i=this.getUniqueStyleGroup(f,e);e=this.getFilterFeatures(f.filterCondition,e);var r,a,o,s,l,m=f.layerID,y=f.minzoom,v=f.maxzoom,h=f.style,u=i[0].themeField,c=f.featureType,d=f.style,g={},b={};for(r in i.forEach(function(e){b[e.value]=e}),e.forEach(function(e){var t=e.properties,e=b[t[u]];if(e){var i,r,a=e.style;for(i in a)!Object.prototype.hasOwnProperty.call(a,i)||(r=a[i])!==d[i]&&(g[i]||(g[i]=["match",["get","index"]]),g[i].push(t.index,n[i]?n[i](a):r))}}),g)Object.prototype.hasOwnProperty.call(g,r)&&(s=g[r],a=d[r]||t[r],o=n[r],s.push(void 0===a?null:o&&o((l=a,(s=r)in(o={})?Object.defineProperty(o,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[s]=l,o))||a));this._initLegendConfigInfo(f,i);var x=m;this.map.addSource(x,{type:"geojson",data:{type:"FeatureCollection",features:e}});function w(e,t,i,r,a,n,o){r={style:p._transformStyleToMapBoxGl(Object.assign({},r),e),layout:{visibility:S}},p._addOverlayToMap(e,t,i,r,a,n,o)}var S=f.visible;if(-1!==["POLYGON","LINE"].indexOf(c)){var P=g.lineDash,_=["all"],E=!1,C="";if(P&&1<P.length){delete g.lineDash;for(var M=P[1],T="POLYGON"===c?m+"-strokeLine":m,k=2;k<P.length-1;k+=2){var L=["==",M,P[k]];_.push(["!=",M,P[k]]);var O="".concat(T,"-additional-linedasharray-").concat(k/2),C=C||O;w("LINE",x,O,Object.assign(Object.assign(Object.assign({},h),g),{lineDash:P[k+1]}),y,v,L)}1<_.length&&w("LINE",x,T,Object.assign(Object.assign(Object.assign({},h),g),{lineDash:P[P.length]}),y,v,_),E=!0}"LINE"!==c||E||w("LINE",x,m,Object.assign(Object.assign({},h),g),y,v,_),"POLYGON"===c&&(w("POLYGON",x,m,Object.assign(Object.assign({},h),g),y,v),C&&this.map.moveLayer(m,C),E||(w("LINE",x,m+"-strokeLine",Object.assign(Object.assign({},h),g),y,v,_),C&&this.map.moveLayer(m+"-strokeLine",C)))}else{var I=["all"],i=g.unicode;if(i){var F=g.className||[];delete g.unicode,delete g.classname;for(var c="".concat(m,"-additional-symbol"),D=["any"],B=2;B<F.length-1;B+=2)I.push(["!=",F[1],F[B]]),D.push(["==",F[1],F[B]]);document.getElementById("".concat(this.target)).classList.add("supermapol-icons-map");E=Object.assign(Object.assign({},h),g),E={id:c,type:"symbol",source:x,paint:{"text-color":E.fillColor,"text-halo-color":E.strokeColor,"text-halo-width":E.strokeWidth},layout:{"text-field":i,"text-size":"string"==typeof E.fontSize?parseInt(E.fontSize):E.fontSize||12,"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-rotate":E.rotation||0,"text-offset":Array.isArray(E.offsetX)?E.offsetX:[E.offsetX/2||0,E.offsetY/2||0],"text-allow-overlap":!0,visibility:S},minzoom:y||0,maxzoom:v||22};1<D.length&&(E.filter=D),this._addLayer(E)}var R,A=g.imageInfo||[],N=g.url||[];if(0<A.length||0<N.length){delete g.imageInfo,delete g.url;for(var j=[],V=0<A.length?[A[0],A[1]]:[],z=0<N.length?[N[0],N[1]]:[],U=["any"],G=["any"],W=2;W<A.length-1;W+=2){var q=A[W+1];j.push(q.url),V.push(A[W]),V.push(q.url),I.push(["!=",A[1],A[W]]),U.push(["==",A[1],A[W]])}for(var X=2;X<N.length-1;X+=2){var H=N[X+1];j.push(H),z.push(N[X]),z.push(H),I.push(["!=",N[1],N[X]]),G.push(["==",N[1],N[X]])}V.push(""),z.push("");var Y=[];j.forEach(function(e){var r;Y.push((r=e,new Promise(function(i){r.indexOf("svg")<0?p.map.loadImage(r,function(e,t){return e?(console.log(e),void i(e)):(p.map.hasImage(r)||p.map.addImage(r,t),void i({src:r,image:t}))}):(p._svgDiv||(p._svgDiv=document.createElement("div"),document.body.appendChild(p._svgDiv)),p.getCanvasFromSVG(r,p._svgDiv,function(e){p.handleSvgColor(d,e),p.map.loadImage(e.toDataURL("img/png"),function(e,t){return e?(console.log(e),void i(e)):(p.map.hasImage(r)||p.map.addImage(r,t,{sdf:!0}),void i({src:r,image:t}))})}))})))});var Z=Object.assign(Object.assign({},h),g);Promise.all(Y).then(function(e){for(var t={},i={},r=g.radius||[],a=2;a<r.length-1;a+=2)i[r[a]]=r[a+1];if(e.forEach(function(e){e&&e.src&&(t[e.src]=e.image.width)}),1<V.length){for(var n=["match",["get","index"]],o=2;o<V.length-1;o+=2){var s=V[o],l=V[o+1],l=2*Number.parseFloat(((i[s]||8)/t[l]).toFixed(2));n.push(s),n.push(l)}n.push(1),p._addLayer({id:"".concat(m,"-additional-image"),type:"symbol",source:x,layout:{"icon-image":V,"icon-anchor":"bottom-right","icon-size":n,"icon-allow-overlap":!0,visibility:f.visible,"icon-offset":Z.offsetX||[0,0],"icon-rotate":Z.rotation||0},minzoom:y||0,maxzoom:v||22,filter:U})}if(1<z.length){for(var h=["match",["get","index"]],u=2;u<z.length-1;u+=2){var c=z[u],d=z[u+1],d=2*Number.parseFloat(((i[c]||8)/t[d]).toFixed(2));h.push(c),h.push(d)}h.push(1),p._addLayer({id:"".concat(m,"-additional-svg"),type:"symbol",source:x,layout:{"icon-image":z,"icon-anchor":"bottom-right","icon-size":1,"icon-allow-overlap":!0,visibility:f.visible,"icon-offset":Z.offsetX||[0,0],"icon-rotate":Z.rotation||0},paint:{"icon-color":Z.fillColor},minzoom:y||0,maxzoom:v||22,filter:G})}})}"SYMBOL_POINT"===h.type?((R=Object.assign({},f)).style=Object.assign(Object.assign(Object.assign({},h),g),{type:h.type}),this._createSymbolLayer(R,e,"","",!0,1<I.length?I:void 0)):"IMAGE_POINT"===h.type||"SVG_POINT"===h.type?((R=Object.assign({},f)).style=Object.assign(Object.assign(Object.assign({},h),g),{type:h.type}),this._createGraphicLayer(R,e,"","",!0,1<I.length?I:void 0)):w("POINT",x,m,Object.assign(Object.assign({},h),g),y,v,1<I.length?I:void 0)}this._addLayerSucceeded()}},{key:"_getWMTSUrl",value:function(e){if("REST"===e.requestEncoding&&e.restResourceURL)return e.restResourceURL.replace("{Style}",e.style||"").replace("{TileMatrixSet}",e.tileMatrixSet).replace("{TileRow}","{y}").replace("{TileCol}","{x}").replace("{TileMatrix}","{z}");var t={service:"WMTS",request:"GetTile",version:"1.0.0",style:e.style||"",layer:e.layer,tilematrixSet:e.tileMatrixSet,format:"image/png",tilematrix:"{z}",tilerow:"{y}",tilecol:"{x}"};return"".concat(e.kvpResourceUrl).concat(this._getParamString(t,e.kvpResourceUrl))}},{key:"_createMarkerLayer",value:function(l,h){var u=this,c=l.minzoom,d=l.maxzoom,i={};(h=h||[]).forEach(function(e){var t=e.dv_v5_markerStyle,e=e.geometry.type.toUpperCase();"POINT"===(e="POINT"===e&&t.text?"TEXT":e)&&t.src&&-1===t.src.indexOf("http://")&&-1===t.src.indexOf("https://")&&(t.src=u.serverUrl+t.src),i[t.src]||(i[t.src]=t)});var e,t=[];for(e in i)t.push(function(r,t){return new Promise(function(i){r.indexOf("svg")<0?u.map.loadImage(r,function(e,t){return e?(console.log(e),void i(e)):(u.map.hasImage(r)||u.map.addImage(r,t),void i(r))}):(u._svgDiv||(u._svgDiv=document.createElement("div"),document.body.appendChild(u._svgDiv)),u.getCanvasFromSVG(r,u._svgDiv,function(e){u.handleSvgColor(t,e),u.map.loadImage(e.toDataURL("img/png"),function(e,t){return e?(console.log(e),void i(e)):(u.map.hasImage(r)||u.map.addImage(r,t),void i(r))})}))})}(e,i[e]));Promise.all(t).then(function(e){for(var t=0;t<h.length;t++){var i=h[t],r=i.dv_v5_markerStyle,a=i.geometry.type.toUpperCase();"POINT"===a&&r.text&&(a="TEXT");var n=u.setFeatureInfo(i);i.properties.useStyle=r,i.properties.featureInfo=n;var o={type:"geojson",data:i},s=a+"-"+i.properties.index;if("POINT"===a&&r.src){if(-1===e.indexOf(r.src))continue;u._addLayer({id:s,type:"symbol",source:o,layout:{"icon-image":r.src,"icon-size":r.scale,visibility:l.visible},minzoom:c||0,maxzoom:d||22})}r.src||(n={layout:{}},"LINESTRING"===a&&r.lineCap&&(a="LINE",n.layout={"line-cap":r.lineCap}),i=l.visible,n.layout.visibility=i,n.style=u._transformStyleToMapBoxGl(r,a),u._addOverlayToMap(a,o,s,n,c,d),"POLYGON"===a&&r.strokeColor&&u._addStrokeLineForPoly(r,s,s+"-strokeLine",i,c,d))}u._addLayerSucceeded()})}},{key:"_createHeatLayer",value:function(e,t){var i,r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],a=e.minzoom,n=e.maxzoom,o=e.themeSetting,s={gradient:o.colors.slice(),radius:parseInt(o.radius)},l=o.customSettings;for(i in l)s.gradient[i]=l[i];o.weight&&this._changeWeight(t,o.weight);var h=["interpolate",["linear"],["heatmap-density"]],u=[.1,.3,.5,.7,1];s.gradient.forEach(function(e,t){h.push(u[t]),0===t&&(e=p.a.supermap.Util.hexToRgba(e,0)),1===t&&(e=p.a.supermap.Util.hexToRgba(e,.5)),h.push(e)}),this._initLegendConfigInfo(e,s.gradient);var c,d,f={"heatmap-color":h,"heatmap-radius":3*o.radius,"heatmap-intensity":1.3};t[0].weight&&4<=t.length&&(c=[],t.forEach(function(e){c.push(e.weight)}),d=SuperMap.ArrayStatistic.getMax(c),o=SuperMap.ArrayStatistic.getMin(c),f["heatmap-weight"]=["interpolate",["linear"],["get","weight"],o,0,d,1]),this._addLayer({id:e.layerID,type:"heatmap",source:{type:"geojson",data:{type:"FeatureCollection",features:t}},paint:f,layout:{visibility:e.visible},minzoom:a||0,maxzoom:n||22}),r&&this._addLayerSucceeded()}},{key:"_changeWeight",value:function(e,i){this._fieldMaxValue={},this._getMaxValue(e,i);var r=this._fieldMaxValue[i];e.forEach(function(e){var t=e.properties[i];e.weight=t/r})}},{key:"_getMaxValue",value:function(e,t){var i,r=[],a=t;this._fieldMaxValue[a]||(e.forEach(function(e){(i=e.properties)&&parseFloat(i[a])&&r.push(parseFloat(i[a]))}),this._fieldMaxValue[a]=SuperMap.ArrayStatistic.getArrayStatistic(r,"Maximum"))}},{key:"_createRangeLayer",value:function(e,t){var r=e.themeSetting.themeField,i=e.featureType,a=e.minzoom,n=e.maxzoom,o=e.style,s=this.getRangeStyleGroup(e,t);t=this.getFilterFeatures(e.filterCondition,t);var l=["match",["get","index"]],h=t.filter(function(e){var t=parseFloat(e.properties[r]);if(!t&&0!==t)return!1;if(s)for(var i=0;i<s.length;i++)if(s[i].start<=t&&t<s[i].end){l.push(e.properties.index,s[i].color);break}return!0},this);l.push("rgba(0, 0, 0, 0)");var u={type:"geojson",data:{type:"FeatureCollection",features:h}};this._initLegendConfigInfo(e,s);t={layout:{}};"LINE"===i&&o.lineCap&&(t.layout={"line-cap":o.lineCap});h=e.visible;t.layout.visibility=h,t.style=this._transformStyleToMapBoxGl(o,i,l);e=e.layerID;this._addOverlayToMap(i,u,e,t,a,n),"POLYGON"===i&&o.strokeColor&&this._addStrokeLineForPoly(o,e,e+"-strokeLine",h,a,n),this._addLayerSucceeded()}},{key:"_sendMapToUser",value:function(e,t){var i=this;if(e===t){for(var r in this._sourceListModel=new h.a({map:this.map}),this._legendList)this._sourceListModel.addSourceStyle(r,this._legendList[r]);for(var a=this._layers.filter(function(e){return!!i.map.getLayer(e.layerID)}),n=a.length-1;-1<n;n--){var o=a[n].layerID,s=a[n+1]?a[n+1].layerID:void 0;this.map.moveLayer(o,s),this.map.getLayer("".concat(o,"-strokeLine"))&&this.map.moveLayer("".concat(o,"-strokeLine"),s);for(var l=1;l<this.expectLayerLen+1&&this.map.getLayer("".concat(o,"-additional-").concat(l));l++)this.map.moveLayer("".concat(o,"-additional-").concat(l),s);this.map.getLayer("".concat(o,"-label"))&&this.map.moveLayer("".concat(o,"-label"))}this.triggerEvent("addlayerssucceeded",{map:this.map,mapparams:this.mapParams,layers:this._layers})}}},{key:"_getParamString",value:function(e,t){var i,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=[];for(i in e)a.push((r?i.toUpperCase():i)+"="+e[i]);return(t&&-1!==t.indexOf("?")?"&":"?")+a.join("&")}},{key:"_transformStyleToMapBoxGl",value:function(e,t,i,r){var a={};"POINT"!==e.type&&"BASIC_POINT"!==e.type&&"POINT"!==t||"LINE"===t?-1!==["LINE","LINESTRING","MULTILINESTRING"].indexOf(t)?a={strokeWidth:"line-width",strokeColor:"line-color",strokeOpacity:"line-opacity"}:-1!==["REGION","POLYGON","MULTIPOLYGON"].indexOf(t)&&(a={fillColor:"fill-color",fillOpacity:"fill-opacity"}):a={fillColor:"circle-color",strokeWidth:"circle-stroke-width",fillOpacity:"circle-opacity",radius:"circle-radius",strokeColor:"circle-stroke-color",strokeOpacity:"circle-stroke-opacity"};var n,o={};for(n in e)a[n]&&(o[a[n]]=e[n]);return i&&(r?o[r]=i:o["circle-color"]?o["circle-color"]=i:o["line-color"]?o["line-color"]=i:o["fill-color"]=i),e.lineDash&&!o["line-dasharray"]&&(Array.isArray(e.lineDash)?o["line-dasharray"]=e.lineDash:"solid"!==e.lineDash&&"LINE"===t&&(o["line-dasharray"]=this.getDashStyle(e.lineDash))),e.lineDash&&!o["circle-translate"]&&(Array.isArray(e.circleTranslate)?o["circle-translate"]=e.circleTranslate:"POINT"!==e.type&&"BASIC_POINT"!==e.type&&"POINT"!==t||(i=e.offsetX||0,t=e.offsetY||0,o["circle-translate"]=[i*e.radius,t*e.radius])),o}},{key:"_addOverlayToMap",value:function(e,t,i,r,a,n,o){e={POINT:"circle",LINE:"line",POLYGON:"fill"}[e];"circle"!==e&&"line"!==e&&"fill"!==e||(n={id:i,type:e,source:t,paint:r.style,layout:r.layout||{},minzoom:a||0,maxzoom:n||22},o&&(n.filter=o),this._addLayer(n))}},{key:"_addBaselayer",value:function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:22,n=5<arguments.length&&void 0!==arguments[5]&&arguments[5],o=6<arguments.length?arguments[6]:void 0,e={type:"raster",tiles:e,tileSize:n?this.rasterTileSize:256,rasterSource:n?"iserver":"",prjCoordSys:n&&!this.isOnlineBaseLayer(e[0],this.baseProjection)&&0<+this.baseProjection.split(":")[1]?{epsgCode:this.baseProjection.split(":")[1]}:"",proxy:this.baseLayerProxy};o&&(e.bounds=o),this._addLayer({id:t,type:"raster",source:e,minzoom:r||0,maxzoom:a||22,layout:{visibility:i?"visible":"none"}}),this.baseLayerProxy=null}},{key:"_addStrokeLineForPoly",value:function(e,t,i,r,a,n){r={style:this._transformStyleToMapBoxGl(e,"LINE"),layout:{visibility:r}};this._addOverlayToMap("LINE",t,i,r,a,n)}},{key:"_initLegendConfigInfo",value:function(e,t){this._legendList[e.layerID]||(this._legendList[e.layerID]={layerType:e.layerType,featureType:e.featureType,layerId:e.layerID,themeField:"HEAT"===e.layerType?e.themeSetting.weight:e.themeSetting.themeField,styleGroup:t})}},{key:"_createMvtLayer",value:function(e,t,i){var r=this._getDataVectorTileStyle(i),a=this._transformStyleToMapBoxGl(r,i),n=e.url+"/tileFeature.mvt",o=p.a.CRS.get(this.baseProjection).getOrigin(),s=t.minzoom,i=t.maxzoom;n+="?&returnAttributes=true&width=512&height=512&x={x}&y={y}&scale={scale}&origin={x:".concat(o[0],",y:").concat(o[1],"}"),this._addLayer({id:t.layerID,type:r.mbglType,source:{type:"vector",tiles:[n],proxy:this.webMapService.handleProxy("image")},"source-layer":"".concat(e.datasetName,"@").concat(e.datasourceName),paint:a,layout:{visibility:t.visible?"visible":"none"},minzoom:s||0,maxzoom:i||22}),this._addLayerSucceeded()}},{key:"_getDataVectorTileStyle",value:function(e){var t={radius:8,fillColor:"#EE4D5A",fillOpacity:.9,strokeColor:"#ffffff",strokeWidth:1,strokeOpacity:1,lineDash:"solid",type:"BASIC_POINT",mbglType:"circle"};return-1!==["LINE","LINESTRING","MULTILINESTRING"].indexOf(e)?(t.strokeColor="#4CC8A3",t.strokeWidth=2,t.mbglType="line"):-1!==["REGION","POLYGON","MULTIPOLYGON"].indexOf(e)&&(t.fillColor="#826DBA",t.mbglType="fill"),t}},{key:"_unproject",value:function(e){var t=this._unprojectProjection||this.baseProjection;if("EPSG:4326"===t)return e;e=Object(B.a)(t,"EPSG:4326",e),t=B.a.defs(t);return t.axis&&0===t.axis.indexOf("ne")&&e.reverse(),e}},{key:"_getMapCenter",value:function(e){e=e.center&&[e.center.x,e.center.y];return e=this._unproject(e=e||[0,0]),e=new p.a.LngLat(e[0],e[1])}},{key:"_getLabelFontFamily",value:function(e){var t=[],e=e.layers;return e&&0<e.length&&e.forEach(function(e){e.labelStyle&&t.push(e.labelStyle.fontFamily)},this),t.push("'supermapol-icons'"),t.join(",")}},{key:"_getTiandituUrl",value:function(e){for(var t=/t0/gi,i={tiandituUrl:[],labelUrl:[]},r=e.baseLayer.layerType.split("_")[1].toLowerCase(),a=Boolean(e.baseLayer.labelLayerVisible),n=this.tiandituKey||e.baseLayer.tk,o="https://t0.tianditu.gov.cn/{layer}_{proj}/wmts?tk=".concat(n),s=o,e="EPSG:4326"===this.baseProjection?"c":"w",n={service:"WMTS",request:"GetTile",style:"default",version:"1.0.0",layer:r,tilematrixSet:e,format:"tiles",width:256,height:256},l=(o+=this._getParamString(n,o)+"&tilematrix={z}&tilerow={y}&tilecol={x}").replace("{layer}",r).replace("{proj}",e),h=[],u=0;u<8;u++)h.push(l.replace(t,"t".concat(u)));if(i.tiandituUrl=h,a){r={vec:"cva",ter:"cta",img:"cia"}[r];n.layer=r;for(var s=(s+=this._getParamString(n,s)+"&tilematrix={z}&tilerow={y}&tilecol={x}").replace("{layer}",r).replace("{proj}",e),c=[],d=0;d<8;d++)c.push(s.replace(t,"t".concat(d)));i.labelUrl=c}return i}},{key:"_defineProj4",value:function(e,t){var i=e;e.split(":")[1]||(i=t||Object(C.c)(e),r=e);var e=Object(C.a)(i),r=r||e;return r?(B.a.defs(i)||B.a.defs(i,r),e||Object(C.b)(i,r)):console.error("".concat(i," not define")),i}},{key:"getEpsgCodeWKT",value:function(e,t){if(e)return SuperMap.FetchRequest.get(e,null,t).then(function(e){return e.text()}).then(function(e){return e}).catch(function(e){console.log(e)})}},{key:"_addLayer",value:function(e){var t=e.id;if(this._cacheLayerId.push(t),e=Object.assign(e,{id:t}),this.map.getLayer(t))return this.checkSameLayer&&this._isSameRasterLayer(t,e)?void 0:void this._updateLayer(e);this.map.addLayer(e)}},{key:"_isSameRasterLayer",value:function(e,t){var i=t.source,t=i.type,i=i.tiles;if("raster"===t){e=this.map.getSource(e);if(t===e.type&&i&&e.tiles&&i[0]===e.tiles[0])return!0}return!1}},{key:"setLayersVisible",value:function(e,t){var i=this,r=e?"visible":"none";this._cacheLayerId.length&&this._cacheLayerId.forEach(function(e){(t&&-1===t.indexOf(e)||!t)&&i.map.setLayoutProperty(e,"visibility",r)})}},{key:"cleanWebMap",value:function(){this.map&&(this.triggerEvent("beforeremovemap",{}),this.map.remove(),this.map=null,this._legendList={},this._sourceListModel=null,this.center=null,this.zoom=null,this._layers=[],this._dataflowService&&this._dataflowService.off("messageSucceeded",this._handleDataflowFeaturesCallback)&&this._dataflowService.off("subscribesucceeded",this._initDataflowLayerCallback),this._unprojectProjection=null),this._layerTimerList.length&&(this._layerTimerList.forEach(function(e){clearInterval(e)}),this._layerTimerList=[])}},{key:"centerValid",value:function(e){return!(!e||!(0<e.length||R(e)===p.a.LngLat||e.lng))}},{key:"_getResolution",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:512;return e.leftBottom&&e.rightTop?Math.max(e.rightTop.x-e.leftBottom.x,e.rightTop.y-e.leftBottom.y)/t:Math.max(e[2]-e[0],e[3]-e[1])/t}},{key:"_transformScaleToZoom",value:function(e,t){var i=(t||this.map.getCRS()).getExtent(),t=(t||this.map.getCRS()).unit,t=1/SuperMap.Util.getScaleFromResolutionDpi((i[2]-i[0])/512,96,t),e=e.split(":")[1];return Math.min(24,+Math.log2(t/+e).toFixed(2))}},{key:"_updateLayer",value:function(e){var t=this,i=e.id,r=e.paint,a=e.source,n=a.type,o=a.tiles,s=a.data,e=a.proxy,a=this.map.getSource(i);a&&("geojson"===n?(Object.keys(r).forEach(function(e){t.map.setPaintProperty(i,e,r[e])}),a.setData(s)):"raster"===n&&this._updateRasterSource(i,{proxy:e,tiles:o}))}},{key:"_updateRasterSource",value:function(e,t){var i;e&&(i=this.map.getSource(e),Object.assign(i,t),this.map.style.sourceCaches[e].clearTiles(),this.map.style.sourceCaches[e].update(this.map.transform),this.map.triggerRepaint())}},{key:"updateOverlayLayer",value:function(e,t,i){t?this._initOverlayLayer(e,t,i):(i=this.webMapService.getDatasourceType(e),this.getLayerFeatures(e,this._taskID,i))}},{key:"isOnlineBaseLayer",value:function(e,t){return e.startsWith("https://maptiles.supermapol.com/iserver/services/map_China/rest/maps/China_Dark")&&"EPSG:3857"===t}}])&&A(e.prototype,t),i&&A(e,i),s}()},"9WTN":function(e){e.exports=JSON.parse('[{"name":"黑龙江省","coord":[127.64559817675396,48.48668098449708]},{"name":"内蒙古自治区","coord":[118.34519572208615,45.370218276977525]},{"name":"新疆维吾尔自治区","coord":[87.13479065593184,41.75497055053711]},{"name":"吉林省","coord":[126.12985278813787,43.57983207702637]},{"name":"辽宁省","coord":[124.02494773936439,41.105743408203125]},{"name":"甘肃省","coord":[102.87785725633012,37.69582366943361]},{"name":"河北省","coord":[115.66327227481898,39.33383178710938]},{"name":"北京市","coord":[116.62199343603638,40.25053787231445]},{"name":"山西省","coord":[112.45180235808988,37.666561126708984]},{"name":"天津市","coord":[117.35711842642581,39.406789779663086]},{"name":"陕西省","coord":[109.56294003056632,35.64754199981689]},{"name":"宁夏回族自治区","coord":[105.96110877640074,37.3081169128418]},{"name":"青海省","coord":[96.07301048277901,35.44417190551758]},{"name":"山东省","coord":[118.03833752951093,36.29800605773925]},{"name":"西藏自治区","coord":[87.47361520439412,31.6703872680664]},{"name":"河南省","coord":[113.07832397097275,33.87751102447509]},{"name":"江苏省","coord":[119.93926538201052,32.945452690124505]},{"name":"安徽省","coord":[117.15146765881019,32.024482727050774]},{"name":"四川省","coord":[102.28998890142759,30.182161331176758]},{"name":"湖北省","coord":[112.87798261431585,31.157071113586426]},{"name":"重庆市","coord":[107.870126637831,30.188085556030266]},{"name":"上海市","coord":[121.42561166015514,31.276043891906745]},{"name":"浙江省","coord":[119.75337092707514,29.175934791564945]},{"name":"湖南省","coord":[111.52770282777405,27.38110256195069]},{"name":"江西省","coord":[115.51091280655628,27.283511161804206]},{"name":"云南省","coord":[101.27053825991308,25.19783210754396]},{"name":"贵州省","coord":[106.49672346773299,26.92267990112305]},{"name":"福建省","coord":[117.9976766946587,25.939599990844727]},{"name":"广西壮族自治区","coord":[108.98706831086302,23.891559600830078]},{"name":"台湾省","coord":[120.82468432537434,23.602651596069336]},{"name":"香港特别行政区","coord":[114.21036850371561,22.374858856201172]},{"name":"海南省","coord":[109.62792940960824,19.163116455078125]},{"name":"广东省","coord":[113.32127888266032,22.873867034912106]},{"name":"澳门特别行政区","coord":[113.56819996291901,22.160347992976]}]')},ATId:function(e,t,i){e.exports=function(f,m){"use strict";var e;return f=f&&f.hasOwnProperty("default")?f.default:f,m=m&&m.hasOwnProperty("default")?m.default:m,function(e){var u;e.exports;(u=window).DOMParser=window.DOMParser;function p(){return document.createElement("canvas")}var d,c=function(e,t,i){if(null!=e||null!=t||null!=i){var r=function(a){var I={opts:a,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,rootEmSize:12,emSize:12,log:function(e){}};1==I.opts.log&&"undefined"!=typeof console&&(I.log=function(e){console.log(e)});I.init=function(e){var t=0;I.UniqueId=function(){return"canvg"+ ++t},I.Definitions={},I.Styles={},I.StylesSpecificity={},I.Animations=[],I.Images=[],I.ctx=e,I.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},I.init(),I.ImagesLoaded=function(){for(var e=0;e<I.Images.length;e++)if(!I.Images[e].loaded)return!1;return!0},I.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},I.compressSpaces=function(e){return e.replace(/(?!\u3000)\s+/gm," ")},I.ajax=function(e){var t;return(t=u.XMLHttpRequest?new u.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(t.open("GET",e,!1),t.send(null),t.responseText):null},I.parseXml=function(e){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var t=new Windows.Data.Xml.Dom.XmlDocument,i=new Windows.Data.Xml.Dom.XmlLoadSettings;return i.prohibitDtd=!1,t.loadXml(e,i),t}if(!u.DOMParser){e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{var r=a.xmldom?new u.DOMParser(a.xmldom):new u.DOMParser;return r.parseFromString(e,"image/svg+xml")}catch(t){return(r=a.xmldom?new u.DOMParser(a.xmldom):new u.DOMParser).parseFromString(e,"text/xml")}},I.Property=function(e,t){this.name=e,this.value=t},I.Property.prototype.getValue=function(){return this.value},I.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},I.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},I.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},I.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},I.Property.prototype.addOpacity=function(e){var t=this.value;if(null!=e.value&&""!=e.value&&"string"==typeof this.value){var i=new f(this.value);i.ok&&(t="rgba("+i.r+", "+i.g+", "+i.b+", "+e.numValue()+")")}return new I.Property(this.name,t)},I.Property.prototype.getDefinition=function(){var e=this.value.match(/#([^\)'"]+)/);return e&&(e=e[1]),e||(e=this.value),I.Definitions[e]},I.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},I.Property.prototype.getFillStyleDefinition=function(e,t){var i=this.getDefinition();if(null!=i&&i.createGradient)return i.createGradient(I.ctx,e,t);if(null!=i&&i.createPattern){if(i.getHrefAttribute().hasValue()){var r=i.attribute("patternTransform");i=i.getHrefAttribute().getDefinition(),r.hasValue()&&(i.attribute("patternTransform",!0).value=r.value)}return i.createPattern(I.ctx,e)}return null},I.Property.prototype.getDPI=function(e){return 96},I.Property.prototype.getREM=function(e){return I.rootEmSize},I.Property.prototype.getEM=function(e){return I.emSize},I.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},I.Property.prototype.isPixels=function(){if(!this.hasValue())return!1;var e=this.value+"";return!!e.match(/px$/)||!!e.match(/^[0-9]+$/)},I.Property.prototype.toPixels=function(e,t){if(!this.hasValue())return 0;var i=this.value+"";if(i.match(/rem$/))return this.numValue()*this.getREM(e);if(i.match(/em$/))return this.numValue()*this.getEM(e);if(i.match(/ex$/))return this.numValue()*this.getEM(e)/2;if(i.match(/px$/))return this.numValue();if(i.match(/pt$/))return this.numValue()*this.getDPI(e)*(1/72);if(i.match(/pc$/))return 15*this.numValue();if(i.match(/cm$/))return this.numValue()*this.getDPI(e)/2.54;if(i.match(/mm$/))return this.numValue()*this.getDPI(e)/25.4;if(i.match(/in$/))return this.numValue()*this.getDPI(e);if(i.match(/%$/))return this.numValue()*I.ViewPort.ComputeSize(e);var r=this.numValue();return t&&r<1?r*I.ViewPort.ComputeSize(e):r},I.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():(e.match(/ms$/),this.numValue())},I.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var e={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return I.Property.prototype.toTextBaseline=function(){return this.hasValue()?e[this.value]:null},I.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(e,t,i,r,a,n){var o=null!=n?this.Parse(n):this.CreateFont("","","","","",I.ctx.font);return{fontFamily:a=a||o.fontFamily,fontSize:r||o.fontSize,fontStyle:e||o.fontStyle,fontWeight:i||o.fontWeight,fontVariant:t||o.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var o=this;this.Parse=function(e){for(var t={},i=I.trim(I.compressSpaces(e||"")).split(" "),r={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",n=0;n<i.length;n++)r.fontStyle||-1==o.Styles.indexOf(i[n])?r.fontVariant||-1==o.Variants.indexOf(i[n])?r.fontWeight||-1==o.Weights.indexOf(i[n])?r.fontSize?"inherit"!=i[n]&&(a+=i[n]):("inherit"!=i[n]&&(t.fontSize=i[n].split("/")[0]),r.fontStyle=r.fontVariant=r.fontWeight=r.fontSize=!0):("inherit"!=i[n]&&(t.fontWeight=i[n]),r.fontStyle=r.fontVariant=r.fontWeight=!0):("inherit"!=i[n]&&(t.fontVariant=i[n]),r.fontStyle=r.fontVariant=!0):("inherit"!=i[n]&&(t.fontStyle=i[n]),r.fontStyle=!0);return""!=a&&(t.fontFamily=a),t}},I.ToNumberArray=function(e){for(var t=I.trim(I.compressSpaces((e||"").replace(/,/g," "))).split(" "),i=0;i<t.length;i++)t[i]=parseFloat(t[i]);return t},I.Point=function(e,t){this.x=e,this.y=t},I.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},I.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],i=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=i},I.CreatePoint=function(e){var t=I.ToNumberArray(e);return new I.Point(t[0],t[1])},I.CreatePath=function(e){for(var t=I.ToNumberArray(e),i=[],r=0;r<t.length;r+=2)i.push(new I.Point(t[r],t[r+1]));return i},I.BoundingBox=function(e,t,i,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,i,r,a,n){var o=e+2/3*(i-e),s=t+2/3*(r-t),l=o+1/3*(a-e),h=s+1/3*(n-t);this.addBezierCurve(e,t,o,l,s,h,a,n)},this.addBezierCurve=function(e,t,i,r,a,n,o,s){var l=[e,t],h=[i,r],u=[a,n],c=[o,s];this.addPoint(l[0],l[1]),this.addPoint(c[0],c[1]);for(var d=0;d<=1;d++){var f=function(e){return Math.pow(1-e,3)*l[d]+3*Math.pow(1-e,2)*e*h[d]+3*(1-e)*Math.pow(e,2)*u[d]+Math.pow(e,3)*c[d]},p=6*l[d]-12*h[d]+6*u[d],m=-3*l[d]+9*h[d]-9*u[d]+3*c[d],y=3*h[d]-3*l[d];if(0!=m){var v=Math.pow(p,2)-4*y*m;if(!(v<0)){var g=(-p+Math.sqrt(v))/(2*m);0<g&&g<1&&(0==d&&this.addX(f(g)),1==d&&this.addY(f(g)));var b=(-p-Math.sqrt(v))/(2*m);0<b&&b<1&&(0==d&&this.addX(f(b)),1==d&&this.addY(f(b)))}}else{if(0==p)continue;var x=-y/p;0<x&&x<1&&(0==d&&this.addX(f(x)),1==d&&this.addY(f(x)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(i,r)},I.Transform=function(e){var t=this;this.Type={},this.Type.translate=function(e){this.p=I.CreatePoint(e),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(e){var t=I.ToNumberArray(e);this.angle=new I.Property("angle",t[0]),this.cx=t[1]||0,this.cy=t[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(e){this.p=I.CreatePoint(e),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=I.ToNumberArray(e),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(e){var t=this.m[0],i=this.m[2],r=this.m[4],a=this.m[1],n=this.m[3],o=this.m[5],s=1/(t*(1*n-0*o)-i*(1*a-0*o)+r*(0*a-0*n));e.transform(s*(1*n-0*o),s*(0*o-1*a),s*(0*r-1*i),s*(1*t-0*r),s*(i*o-r*n),s*(r*a-t*o))},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=t.Type.matrix,this.base(e),this.angle=new I.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;0<=t;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var i=I.trim(I.compressSpaces(e)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),r=0;r<i.length;r++)if("none"!==i[r]){var a=I.trim(i[r].split("(")[0]),n=i[r].split("(")[1].replace(")",""),o=this.Type[a];if(void 0!==o){var s=new o(n);s.type=a,this.transforms.push(s)}}},I.AspectRatio=function(e,t,i,r,a,n,o,s,l,h){var u=(t=(t=I.compressSpaces(t)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",c=t.split(" ")[1]||"meet",d=i/r,f=a/n,p=Math.min(d,f),m=Math.max(d,f);"meet"==c&&(r*=p,n*=p),"slice"==c&&(r*=m,n*=m),l=new I.Property("refX",l),h=new I.Property("refY",h),l.hasValue()&&h.hasValue()?e.translate(-p*l.toPixels("x"),-p*h.toPixels("y")):(u.match(/^xMid/)&&("meet"==c&&p==f||"slice"==c&&m==f)&&e.translate(i/2-r/2,0),u.match(/YMid$/)&&("meet"==c&&p==d||"slice"==c&&m==d)&&e.translate(0,a/2-n/2),u.match(/^xMax/)&&("meet"==c&&p==f||"slice"==c&&m==f)&&e.translate(i-r,0),u.match(/YMax$/)&&("meet"==c&&p==d||"slice"==c&&m==d)&&e.translate(0,a-n)),"none"==u?e.scale(d,f):"meet"==c?e.scale(p,p):"slice"==c&&e.scale(m,m),e.translate(null==o?0:-o,null==s?0:-s)},I.Element={},I.EmptyProperty=new I.Property("EMPTY",""),I.Element.ElementBase=function(n){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(e,t){var i=this.attributes[e];return null!=i?i:(1==t&&(i=new I.Property(e,""),this.attributes[e]=i),i||I.EmptyProperty)},this.getHrefAttribute=function(){for(var e in this.attributes)if("href"==e||e.match(/:href$/))return this.attributes[e];return I.EmptyProperty},this.style=function(e,t,i){var r=this.styles[e];if(null!=r)return r;var a=this.attribute(e);if(null!=a&&a.hasValue())return this.styles[e]=a;if(1!=i){var n=this.parent;if(null!=n){var o=n.style(e);if(null!=o&&o.hasValue())return o}}return 1==t&&(r=new I.Property(e,""),this.styles[e]=r),r||I.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(e.save(),this.style("mask").hasValue()){var t=this.style("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var i=this.style("filter").getDefinition();null!=i&&i.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(e){},this.clearContext=function(e){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(e,t){var i=e;t&&(i=I.CreateElement(e)),i.parent=this,"title"!=i.type&&this.children.push(i)},this.addStylesFromStyleDefinition=function(){for(var e in I.Styles)if("@"!=e[0]&&d(n,e)){var t=I.Styles[e],i=I.StylesSpecificity[e];if(null!=t)for(var r in t){var a=this.stylesSpecificity[r];void 0===a&&(a="000"),a<i&&(this.styles[r]=t[r],this.stylesSpecificity[r]=i)}}};var e,t=new RegExp("^[A-Z-]+$");if(null!=n&&1==n.nodeType){for(var i=0;i<n.attributes.length;i++){var r=n.attributes[i],a=(e=r.nodeName,t.test(e)?e.toLowerCase():e);this.attributes[a]=new I.Property(a,r.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var o=this.attribute("style").value.split(";");for(i=0;i<o.length;i++)if(""!=I.trim(o[i])){var s=o[i].split(":"),l=I.trim(s[0]),h=I.trim(s[1]);this.styles[l]=new I.Property(l,h)}}for(this.attribute("id").hasValue()&&null==I.Definitions[this.attribute("id").value]&&(I.Definitions[this.attribute("id").value]=this),i=0;i<n.childNodes.length;i++){var u=n.childNodes[i];if(1==u.nodeType&&this.addChild(u,!0),this.captureTextNodes&&(3==u.nodeType||4==u.nodeType)){var c=u.value||u.text||u.textContent||"";""!=I.compressSpaces(c)&&this.addChild(new I.Element.tspan(u),!1)}}}},I.Element.RenderedElementBase=function(e){this.base=I.Element.ElementBase,this.base(e),this.calculateOpacity=function(){for(var e=1,t=this;null!=t;){var i=t.style("opacity",!1,!0);i.hasValue()&&(e*=i.numValue()),t=t.parent}return e},this.setContext=function(e,t){if(!t){var i;if(this.style("fill").isUrlDefinition())null!=(i=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(e.fillStyle=i);else if(this.style("fill").hasValue()){var r;"currentColor"==(r=this.style("fill")).value&&(r.value=this.style("color").value),"inherit"!=r.value&&(e.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value)}if(this.style("fill-opacity").hasValue()&&(r=(r=new I.Property("fill",e.fillStyle)).addOpacity(this.style("fill-opacity")),e.fillStyle=r.value),this.style("stroke").isUrlDefinition())null!=(i=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(e.strokeStyle=i);else if(this.style("stroke").hasValue()){var a;"currentColor"==(a=this.style("stroke")).value&&(a.value=this.style("color").value),"inherit"!=a.value&&(e.strokeStyle="none"==a.value?"rgba(0,0,0,0)":a.value)}if(this.style("stroke-opacity").hasValue()&&(a=(a=new I.Property("stroke",e.strokeStyle)).addOpacity(this.style("stroke-opacity")),e.strokeStyle=a.value),this.style("stroke-width").hasValue()){var n=this.style("stroke-width").toPixels();e.lineWidth=0==n?.001:n}if(this.style("stroke-linecap").hasValue()&&(e.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(e.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(e.miterLimit=this.style("stroke-miterlimit").value),this.style("paint-order").hasValue()&&(e.paintOrder=this.style("paint-order").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var o=I.ToNumberArray(this.style("stroke-dasharray").value);void 0!==e.setLineDash?e.setLineDash(o):void 0!==e.webkitLineDash?e.webkitLineDash=o:void 0===e.mozDash||1==o.length&&0==o[0]||(e.mozDash=o);var s=this.style("stroke-dashoffset").toPixels();void 0!==e.lineDashOffset?e.lineDashOffset=s:void 0!==e.webkitLineDashOffset?e.webkitLineDashOffset=s:void 0!==e.mozDashOffset&&(e.mozDashOffset=s)}}if(void 0!==e.font){e.font=I.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();var l=this.style("font-size",!1,!1);l.isPixels()&&(I.emSize=l.toPixels())}if(this.style("transform",!1,!0).hasValue()&&new I.Transform(this.style("transform",!1,!0).value).apply(e),this.style("clip-path",!1,!0).hasValue()){var h=this.style("clip-path",!1,!0).getDefinition();null!=h&&h.apply(e)}e.globalAlpha=this.calculateOpacity()}},I.Element.RenderedElementBase.prototype=new I.Element.ElementBase,I.Element.PathElementBase=function(e){this.base=I.Element.RenderedElementBase,this.base(e),this.path=function(e){return null!=e&&e.beginPath(),new I.BoundingBox},this.renderChildren=function(e){this.path(e),I.Mouse.checkPath(this,e),""!=e.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?e.fill(this.style("fill-rule").value):e.fill()),""!=e.strokeStyle&&e.stroke();var t=this.getMarkers();if(null!=t){if(this.style("marker-start").isUrlDefinition()&&(i=this.style("marker-start").getDefinition()).render(e,t[0][0],t[0][1]),this.style("marker-mid").isUrlDefinition())for(var i=this.style("marker-mid").getDefinition(),r=1;r<t.length-1;r++)i.render(e,t[r][0],t[r][1]);this.style("marker-end").isUrlDefinition()&&(i=this.style("marker-end").getDefinition()).render(e,t[t.length-1][0],t[t.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},I.Element.PathElementBase.prototype=new I.Element.RenderedElementBase,I.Element.svg=function(e){this.base=I.Element.RenderedElementBase,this.base(e),this.baseClearContext=this.clearContext,this.clearContext=function(e){this.baseClearContext(e),I.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(e){if(e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4,e.canvas.style&&void 0!==e.font&&void 0!==u.getComputedStyle){e.font=u.getComputedStyle(e.canvas).getPropertyValue("font");var t=new I.Property("fontSize",I.Font.Parse(e.font).fontSize);t.hasValue()&&(I.rootEmSize=I.emSize=t.toPixels("y"))}this.baseSetContext(e),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),e.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var i=I.ViewPort.width(),r=I.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");var a=0,n=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(a=-this.attribute("refX").toPixels("x"),n=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(e.beginPath(),e.moveTo(a,n),e.lineTo(i,n),e.lineTo(i,r),e.lineTo(a,r),e.closePath(),e.clip())}if(I.ViewPort.SetCurrent(i,r),this.attribute("viewBox").hasValue()){var o=I.ToNumberArray(this.attribute("viewBox").value),s=o[0],l=o[1];i=o[2],r=o[3],I.AspectRatio(e,this.attribute("preserveAspectRatio").value,I.ViewPort.width(),i,I.ViewPort.height(),r,s,l,this.attribute("refX").value,this.attribute("refY").value),I.ViewPort.RemoveCurrent(),I.ViewPort.SetCurrent(o[2],o[3])}}},I.Element.svg.prototype=new I.Element.RenderedElementBase,I.Element.rect=function(e){this.base=I.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y"),n=this.attribute("rx").toPixels("x"),o=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(o=n),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(n=o),n=Math.min(n,r/2),o=Math.min(o,a/2),null!=e){var s=(Math.sqrt(2)-1)/3*4;e.beginPath(),e.moveTo(t+n,i),e.lineTo(t+r-n,i),e.bezierCurveTo(t+r-n+s*n,i,t+r,i+o-s*o,t+r,i+o),e.lineTo(t+r,i+a-o),e.bezierCurveTo(t+r,i+a-o+s*o,t+r-n+s*n,i+a,t+r-n,i+a),e.lineTo(t+n,i+a),e.bezierCurveTo(t+n-s*n,i+a,t,i+a-o+s*o,t,i+a-o),e.lineTo(t,i+o),e.bezierCurveTo(t,i+o-s*o,t+n-s*n,i,t+n,i),e.closePath()}return new I.BoundingBox(t,i,t+r,i+a)}},I.Element.rect.prototype=new I.Element.PathElementBase,I.Element.circle=function(e){this.base=I.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("cx").toPixels("x"),i=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=e&&(e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.closePath()),new I.BoundingBox(t-r,i-r,t+r,i+r)}},I.Element.circle.prototype=new I.Element.PathElementBase,I.Element.ellipse=function(e){this.base=I.Element.PathElementBase,this.base(e),this.path=function(e){var t=(Math.sqrt(2)-1)/3*4,i=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y"),a=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y");return null!=e&&(e.beginPath(),e.moveTo(a+i,n),e.bezierCurveTo(a+i,n+t*r,a+t*i,n+r,a,n+r),e.bezierCurveTo(a-t*i,n+r,a-i,n+t*r,a-i,n),e.bezierCurveTo(a-i,n-t*r,a-t*i,n-r,a,n-r),e.bezierCurveTo(a+t*i,n-r,a+i,n-t*r,a+i,n),e.closePath()),new I.BoundingBox(a-i,n-r,a+i,n+r)}},I.Element.ellipse.prototype=new I.Element.PathElementBase,I.Element.line=function(e){this.base=I.Element.PathElementBase,this.base(e),this.getPoints=function(){return[new I.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new I.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(e){var t=this.getPoints();return null!=e&&(e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y)),new I.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},I.Element.line.prototype=new I.Element.PathElementBase,I.Element.polyline=function(e){this.base=I.Element.PathElementBase,this.base(e),this.points=I.CreatePath(this.attribute("points").value),this.path=function(e){var t=new I.BoundingBox(this.points[0].x,this.points[0].y);null!=e&&(e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)t.addPoint(this.points[i].x,this.points[i].y),null!=e&&e.lineTo(this.points[i].x,this.points[i].y);return t},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return 0<e.length&&e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},I.Element.polyline.prototype=new I.Element.PathElementBase,I.Element.polygon=function(e){this.base=I.Element.polyline,this.base(e),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},I.Element.polygon.prototype=new I.Element.polyline,I.Element.path=function(e){this.base=I.Element.PathElementBase,this.base(e);var t=this.attribute("d").value;t=t.replace(/,/gm," ");for(var i=0;i<2;i++)t=t.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");for(t=(t=t.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2"),i=0;i<2;i++)t=t.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");t=t.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),t=I.compressSpaces(t),t=I.trim(t),this.PathParser=new function(e){this.tokens=e.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new I.Point(0,0),this.control=new I.Point(0,0),this.current=new I.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var e=new I.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(e)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new I.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,i){null!=i&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(i)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(t),this.path=function(e){var t=this.PathParser;t.reset();var i=new I.BoundingBox;for(null!=e&&e.beginPath();!t.isEnd();)switch(t.nextCommand(),t.command){case"M":case"m":var r=t.getAsCurrentPoint();for(t.addMarker(r),i.addPoint(r.x,r.y),null!=e&&e.moveTo(r.x,r.y),t.start=t.current;!t.isCommandOrEnd();)r=t.getAsCurrentPoint(),t.addMarker(r,t.start),i.addPoint(r.x,r.y),null!=e&&e.lineTo(r.x,r.y);break;case"L":case"l":for(;!t.isCommandOrEnd();){var a=t.current;r=t.getAsCurrentPoint(),t.addMarker(r,a),i.addPoint(r.x,r.y),null!=e&&e.lineTo(r.x,r.y)}break;case"H":case"h":for(;!t.isCommandOrEnd();){var n=new I.Point((t.isRelativeCommand()?t.current.x:0)+t.getScalar(),t.current.y);t.addMarker(n,t.current),t.current=n,i.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y)}break;case"V":case"v":for(;!t.isCommandOrEnd();)n=new I.Point(t.current.x,(t.isRelativeCommand()?t.current.y:0)+t.getScalar()),t.addMarker(n,t.current),t.current=n,i.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y);break;case"C":case"c":for(;!t.isCommandOrEnd();){var o=t.current,s=t.getPoint(),l=t.getAsControlPoint(),h=t.getAsCurrentPoint();t.addMarker(h,l,s),i.addBezierCurve(o.x,o.y,s.x,s.y,l.x,l.y,h.x,h.y),null!=e&&e.bezierCurveTo(s.x,s.y,l.x,l.y,h.x,h.y)}break;case"S":case"s":for(;!t.isCommandOrEnd();)o=t.current,s=t.getReflectedControlPoint(),l=t.getAsControlPoint(),h=t.getAsCurrentPoint(),t.addMarker(h,l,s),i.addBezierCurve(o.x,o.y,s.x,s.y,l.x,l.y,h.x,h.y),null!=e&&e.bezierCurveTo(s.x,s.y,l.x,l.y,h.x,h.y);break;case"Q":case"q":for(;!t.isCommandOrEnd();)o=t.current,l=t.getAsControlPoint(),h=t.getAsCurrentPoint(),t.addMarker(h,l,l),i.addQuadraticCurve(o.x,o.y,l.x,l.y,h.x,h.y),null!=e&&e.quadraticCurveTo(l.x,l.y,h.x,h.y);break;case"T":case"t":for(;!t.isCommandOrEnd();)o=t.current,l=t.getReflectedControlPoint(),t.control=l,h=t.getAsCurrentPoint(),t.addMarker(h,l,l),i.addQuadraticCurve(o.x,o.y,l.x,l.y,h.x,h.y),null!=e&&e.quadraticCurveTo(l.x,l.y,h.x,h.y);break;case"A":case"a":for(;!t.isCommandOrEnd();){o=t.current;var u=t.getScalar(),c=t.getScalar(),d=t.getScalar()*(Math.PI/180),f=t.getScalar(),p=t.getScalar(),m=(h=t.getAsCurrentPoint(),new I.Point(Math.cos(d)*(o.x-h.x)/2+Math.sin(d)*(o.y-h.y)/2,-Math.sin(d)*(o.x-h.x)/2+Math.cos(d)*(o.y-h.y)/2)),y=Math.pow(m.x,2)/Math.pow(u,2)+Math.pow(m.y,2)/Math.pow(c,2);1<y&&(u*=Math.sqrt(y),c*=Math.sqrt(y));var v=(f==p?-1:1)*Math.sqrt((Math.pow(u,2)*Math.pow(c,2)-Math.pow(u,2)*Math.pow(m.y,2)-Math.pow(c,2)*Math.pow(m.x,2))/(Math.pow(u,2)*Math.pow(m.y,2)+Math.pow(c,2)*Math.pow(m.x,2)));isNaN(v)&&(v=0);var g=new I.Point(v*u*m.y/c,v*-c*m.x/u),b=new I.Point((o.x+h.x)/2+Math.cos(d)*g.x-Math.sin(d)*g.y,(o.y+h.y)/2+Math.sin(d)*g.x+Math.cos(d)*g.y),x=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},w=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(x(e)*x(t))},S=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(w(e,t))},P=S([1,0],[(m.x-g.x)/u,(m.y-g.y)/c]),_=[(m.x-g.x)/u,(m.y-g.y)/c],E=[(-m.x-g.x)/u,(-m.y-g.y)/c],C=S(_,E);w(_,E)<=-1&&(C=Math.PI),1<=w(_,E)&&(C=0);var M=1-p?1:-1,T=P+M*(C/2),k=new I.Point(b.x+u*Math.cos(T),b.y+c*Math.sin(T));if(t.addMarkerAngle(k,T-M*Math.PI/2),t.addMarkerAngle(h,T-M*Math.PI),i.addPoint(h.x,h.y),null!=e){w=c<u?u:c;var L=c<u?1:u/c,O=c<u?c/u:1;e.translate(b.x,b.y),e.rotate(d),e.scale(L,O),e.arc(0,0,w,P,P+C,1-p),e.scale(1/L,1/O),e.rotate(-d),e.translate(-b.x,-b.y)}}break;case"Z":case"z":null!=e&&i.x1!==i.x2&&i.y1!==i.y2&&e.closePath(),t.current=t.start}return i},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),i=[],r=0;r<e.length;r++)i.push([e[r],t[r]]);return i}},I.Element.path.prototype=new I.Element.PathElementBase,I.Element.pattern=function(e){this.base=I.Element.ElementBase,this.base(e),this.createPattern=function(e,t){var i=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),a=new I.Element.svg;a.attributes.viewBox=new I.Property("viewBox",this.attribute("viewBox").value),a.attributes.width=new I.Property("width",i+"px"),a.attributes.height=new I.Property("height",r+"px"),a.attributes.transform=new I.Property("transform",this.attribute("patternTransform").value),a.children=this.children;var n=p();n.width=i,n.height=r;var o=n.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&o.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var s=-1;s<=1;s++)for(var l=-1;l<=1;l++)o.save(),a.attributes.x=new I.Property("x",s*n.width),a.attributes.y=new I.Property("y",l*n.height),a.render(o),o.restore();return e.createPattern(n,"repeat")}},I.Element.pattern.prototype=new I.Element.ElementBase,I.Element.marker=function(e){this.base=I.Element.ElementBase,this.base(e),this.baseRender=this.render,this.render=function(e,t,i){if(t){e.translate(t.x,t.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(i),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(e.lineWidth,e.lineWidth),e.save();var r=new I.Element.svg;r.attributes.viewBox=new I.Property("viewBox",this.attribute("viewBox").value),r.attributes.refX=new I.Property("refX",this.attribute("refX").value),r.attributes.refY=new I.Property("refY",this.attribute("refY").value),r.attributes.width=new I.Property("width",this.attribute("markerWidth").value),r.attributes.height=new I.Property("height",this.attribute("markerHeight").value),r.attributes.fill=new I.Property("fill",this.attribute("fill").valueOrDefault("black")),r.attributes.stroke=new I.Property("stroke",this.attribute("stroke").valueOrDefault("none")),r.children=this.children,r.render(e),e.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(1/e.lineWidth,1/e.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(-i),e.translate(-t.x,-t.y)}}},I.Element.marker.prototype=new I.Element.ElementBase,I.Element.defs=function(e){this.base=I.Element.ElementBase,this.base(e),this.render=function(e){}},I.Element.defs.prototype=new I.Element.ElementBase,I.Element.GradientBase=function(e){this.base=I.Element.ElementBase,this.base(e),this.stops=[];for(var t=0;t<this.children.length;t++){var i=this.children[t];"stop"==i.type&&this.stops.push(i)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(e){for(var t=0;t<this.attributesToInherit.length;t++){var i=this.attributesToInherit[t];!this.attribute(i).hasValue()&&e.attribute(i).hasValue()&&(this.attribute(i,!0).value=e.attribute(i).value)}},this.createGradient=function(e,t,i){var r=this;this.getHrefAttribute().hasValue()&&(r=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(r));var a=function(e){return i.hasValue()?new I.Property("color",e).addOpacity(i).value:e},n=this.getGradient(e,t);if(null==n)return a(r.stops[r.stops.length-1].color);for(var o=0;o<r.stops.length;o++)n.addColorStop(r.stops[o].offset,a(r.stops[o].color));if(this.attribute("gradientTransform").hasValue()){var s=I.ViewPort.viewPorts[0],l=new I.Element.rect;l.attributes.x=new I.Property("x",-I.MAX_VIRTUAL_PIXELS/3),l.attributes.y=new I.Property("y",-I.MAX_VIRTUAL_PIXELS/3),l.attributes.width=new I.Property("width",I.MAX_VIRTUAL_PIXELS),l.attributes.height=new I.Property("height",I.MAX_VIRTUAL_PIXELS);var h=new I.Element.g;h.attributes.transform=new I.Property("transform",this.attribute("gradientTransform").value),h.children=[l];var u=new I.Element.svg;u.attributes.x=new I.Property("x",0),u.attributes.y=new I.Property("y",0),u.attributes.width=new I.Property("width",s.width),u.attributes.height=new I.Property("height",s.height),u.children=[h];var c=p();c.width=s.width,c.height=s.height;var d=c.getContext("2d");return d.fillStyle=n,u.render(d),d.createPattern(c,"no-repeat")}return n}},I.Element.GradientBase.prototype=new I.Element.ElementBase,I.Element.linearGradient=function(e){this.base=I.Element.GradientBase,this.base(e),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(e,t){var i="objectBoundingBox"==this.gradientUnits()?t.getBoundingBox(e):null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var r="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),a="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),n="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),o="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return r==n&&a==o?null:e.createLinearGradient(r,a,n,o)}},I.Element.linearGradient.prototype=new I.Element.GradientBase,I.Element.radialGradient=function(e){this.base=I.Element.GradientBase,this.base(e),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(e,t){var i=t.getBoundingBox(e);this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var r="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),a="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),n=r,o=a;this.attribute("fx").hasValue()&&(n="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(o="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits()?(i.width()+i.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(n,o,0,r,a,s)}},I.Element.radialGradient.prototype=new I.Element.GradientBase,I.Element.stop=function(e){this.base=I.Element.ElementBase,this.base(e),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);var t=this.style("stop-color",!0);""===t.value&&(t.value="#000"),this.style("stop-opacity").hasValue()&&(t=t.addOpacity(this.style("stop-opacity"))),this.color=t.value},I.Element.stop.prototype=new I.Element.ElementBase,I.Element.AnimateBase=function(e){this.base=I.Element.ElementBase,this.base(e),I.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var i=this.calcValue();this.attribute("type").hasValue()&&(i=this.attribute("type").value+"("+i+")"),this.getProperty().value=i,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var e={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=e.progress*(this.values.value.length-1),i=Math.floor(t),r=Math.ceil(t);e.from=new I.Property("from",parseFloat(this.values.value[i])),e.to=new I.Property("to",parseFloat(this.values.value[r])),e.progress=(t-i)/(r-i)}else e.from=this.from,e.to=this.to;return e}},I.Element.AnimateBase.prototype=new I.Element.ElementBase,I.Element.animate=function(e){this.base=I.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress();return e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress+this.initialUnits}},I.Element.animate.prototype=new I.Element.AnimateBase,I.Element.animateColor=function(e){this.base=I.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress(),t=new f(e.from.value),i=new f(e.to.value);if(t.ok&&i.ok){var r=t.r+(i.r-t.r)*e.progress,a=t.g+(i.g-t.g)*e.progress,n=t.b+(i.b-t.b)*e.progress;return"rgb("+parseInt(r,10)+","+parseInt(a,10)+","+parseInt(n,10)+")"}return this.attribute("from").value}},I.Element.animateColor.prototype=new I.Element.AnimateBase,I.Element.animateTransform=function(e){this.base=I.Element.AnimateBase,this.base(e),this.calcValue=function(){for(var e=this.progress(),t=I.ToNumberArray(e.from.value),i=I.ToNumberArray(e.to.value),r="",a=0;a<t.length;a++)r+=t[a]+(i[a]-t[a])*e.progress+" ";return r}},I.Element.animateTransform.prototype=new I.Element.animate,I.Element.font=function(e){this.base=I.Element.ElementBase,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var t=0;t<this.children.length;t++){var i=this.children[t];"font-face"==i.type?(this.fontFace=i).style("font-family").hasValue()&&(I.Definitions[i.style("font-family").value]=this):"missing-glyph"==i.type?this.missingGlyph=i:"glyph"==i.type&&(""!=i.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[i.unicode]&&(this.glyphs[i.unicode]=[]),this.glyphs[i.unicode][i.arabicForm]=i):this.glyphs[i.unicode]=i)}},I.Element.font.prototype=new I.Element.ElementBase,I.Element.fontface=function(e){this.base=I.Element.ElementBase,this.base(e),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},I.Element.fontface.prototype=new I.Element.ElementBase,I.Element.missingglyph=function(e){this.base=I.Element.path,this.base(e),this.horizAdvX=0},I.Element.missingglyph.prototype=new I.Element.path,I.Element.glyph=function(e){this.base=I.Element.path,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},I.Element.glyph.prototype=new I.Element.path,I.Element.text=function(e){this.captureTextNodes=!0,this.base=I.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e);var t=this.style("dominant-baseline").toTextBaseline();null==t&&(t=this.style("alignment-baseline").toTextBaseline()),null!=t&&(e.textBaseline=t)},this.initializeCoordinates=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(e,this,0)},this.getBoundingBox=function(e){this.initializeCoordinates(e);for(var t=null,i=0;i<this.children.length;i++){var r=this.getChildBoundingBox(e,this,this,i);null==t?t=r:t.addBoundingBox(r)}return t},this.renderChildren=function(e){this.initializeCoordinates(e);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,this,t)},this.getAnchorDelta=function(e,t,i){var r=this.style("text-anchor").valueOrDefault("start");if("start"!=r){for(var a=0,n=i;n<t.children.length;n++){var o=t.children[n];if(i<n&&o.attribute("x").hasValue())break;a+=o.measureTextRecursive(e)}return-1*("end"==r?a:a/2)}return 0},this.adjustChildCoordinates=function(e,t,i,r){var a=i.children[r];return a.attribute("x").hasValue()?(a.x=a.attribute("x").toPixels("x")+t.getAnchorDelta(e,i,r),a.attribute("dx").hasValue()&&(a.x+=a.attribute("dx").toPixels("x"))):(a.attribute("dx").hasValue()&&(t.x+=a.attribute("dx").toPixels("x")),a.x=t.x),t.x=a.x+a.measureText(e),a.attribute("y").hasValue()?(a.y=a.attribute("y").toPixels("y"),a.attribute("dy").hasValue()&&(a.y+=a.attribute("dy").toPixels("y"))):(a.attribute("dy").hasValue()&&(t.y+=a.attribute("dy").toPixels("y")),a.y=t.y),t.y=a.y,a},this.getChildBoundingBox=function(e,t,i,r){var a=this.adjustChildCoordinates(e,t,i,r),n=a.getBoundingBox(e);for(r=0;r<a.children.length;r++){var o=t.getChildBoundingBox(e,t,a,r);n.addBoundingBox(o)}return n},this.renderChild=function(e,t,i,r){var a=this.adjustChildCoordinates(e,t,i,r);for(a.render(e),r=0;r<a.children.length;r++)t.renderChild(e,t,a,r)}},I.Element.text.prototype=new I.Element.RenderedElementBase,I.Element.TextElementBase=function(e){this.base=I.Element.RenderedElementBase,this.base(e),this.getGlyph=function(e,t,i){var r=t[i],a=null;if(e.isArabic){var n="isolated";(0==i||" "==t[i-1])&&i<t.length-2&&" "!=t[i+1]&&(n="terminal"),0<i&&" "!=t[i-1]&&i<t.length-2&&" "!=t[i+1]&&(n="medial"),0<i&&" "!=t[i-1]&&(i==t.length-1||" "==t[i+1])&&(n="initial"),void 0!==e.glyphs[r]&&null==(a=e.glyphs[r][n])&&"glyph"==e.glyphs[r].type&&(a=e.glyphs[r])}else a=e.glyphs[r];return null==a&&(a=e.missingGlyph),a},this.renderChildren=function(e){var t=this.parent.style("font-family").getDefinition();if(null==t)"stroke"==e.paintOrder?(""!=e.strokeStyle&&e.strokeText(I.compressSpaces(this.getText()),this.x,this.y),""!=e.fillStyle&&e.fillText(I.compressSpaces(this.getText()),this.x,this.y)):(""!=e.fillStyle&&e.fillText(I.compressSpaces(this.getText()),this.x,this.y),""!=e.strokeStyle&&e.strokeText(I.compressSpaces(this.getText()),this.x,this.y));else{var i=this.parent.style("font-size").numValueOrDefault(I.Font.Parse(I.ctx.font).fontSize),r=this.parent.style("font-style").valueOrDefault(I.Font.Parse(I.ctx.font).fontStyle),a=this.getText();t.isRTL&&(a=a.split("").reverse().join(""));for(var n=I.ToNumberArray(this.parent.attribute("dx").value),o=0;o<a.length;o++){var s=this.getGlyph(t,a,o),l=i/t.fontFace.unitsPerEm;e.translate(this.x,this.y),e.scale(l,-l);var h=e.lineWidth;e.lineWidth=e.lineWidth*t.fontFace.unitsPerEm/i,"italic"==r&&e.transform(1,0,.4,1,0,0),s.render(e),"italic"==r&&e.transform(1,0,-.4,1,0,0),e.lineWidth=h,e.scale(1/l,-1/l),e.translate(-this.x,-this.y),this.x+=i*(s.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm,void 0===n[o]||isNaN(n[o])||(this.x+=n[o])}}},this.getText=function(){},this.measureTextRecursive=function(e){for(var t=this.measureText(e),i=0;i<this.children.length;i++)t+=this.children[i].measureTextRecursive(e);return t},this.measureText=function(e){var t=this.parent.style("font-family").getDefinition();if(null!=t){var i=this.parent.style("font-size").numValueOrDefault(I.Font.Parse(I.ctx.font).fontSize),r=0,a=this.getText();t.isRTL&&(a=a.split("").reverse().join(""));for(var n=I.ToNumberArray(this.parent.attribute("dx").value),o=0;o<a.length;o++)r+=(this.getGlyph(t,a,o).horizAdvX||t.horizAdvX)*i/t.fontFace.unitsPerEm,void 0===n[o]||isNaN(n[o])||(r+=n[o]);return r}var s=I.compressSpaces(this.getText());if(!e.measureText)return 10*s.length;e.save(),this.setContext(e,!0);var l=e.measureText(s).width;return e.restore(),l},this.getBoundingBox=function(e){var t=this.parent.style("font-size").numValueOrDefault(I.Font.Parse(I.ctx.font).fontSize);return new I.BoundingBox(this.x,this.y-t,this.x+this.measureText(e),this.y)}},I.Element.TextElementBase.prototype=new I.Element.RenderedElementBase,I.Element.tspan=function(e){this.captureTextNodes=!0,this.base=I.Element.TextElementBase,this.base(e),this.text=I.compressSpaces(e.value||e.text||e.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},I.Element.tspan.prototype=new I.Element.TextElementBase,I.Element.tref=function(e){this.base=I.Element.TextElementBase,this.base(e),this.getText=function(){var e=this.getHrefAttribute().getDefinition();if(null!=e)return e.children[0].getText()}},I.Element.tref.prototype=new I.Element.TextElementBase,I.Element.a=function(e){this.base=I.Element.TextElementBase,this.base(e),this.hasText=0<e.childNodes.length;for(var t=0;t<e.childNodes.length;t++)3!=e.childNodes[t].nodeType&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].value||e.childNodes[0].data:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(e){if(this.hasText){this.baseRenderChildren(e);var t=new I.Property("fontSize",I.Font.Parse(I.ctx.font).fontSize);I.Mouse.checkBoundingBox(this,new I.BoundingBox(this.x,this.y-t.toPixels("y"),this.x+this.measureText(e),this.y))}else if(0<this.children.length){var i=new I.Element.g;i.children=this.children,i.parent=this,i.render(e)}},this.onclick=function(){u.open(this.getHrefAttribute().value)},this.onmousemove=function(){I.ctx.canvas.style.cursor="pointer"}},I.Element.a.prototype=new I.Element.TextElementBase,I.Element.image=function(e){this.base=I.Element.RenderedElementBase,this.base(e);var t=this.getHrefAttribute().value;if(""!=t){var n=t.match(/\.svg$/);if(I.Images.push(this),this.loaded=!1,n)this.img=I.ajax(t),this.loaded=!0;else{this.img=document.createElement("img"),1==I.opts.useCORS&&(this.img.crossOrigin="Anonymous");var o=this;this.img.onload=function(){o.loaded=!0},this.img.onerror=function(){I.log('ERROR: image "'+t+'" not found'),o.loaded=!0},this.img.src=t}this.renderChildren=function(e){var t=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=r&&0!=a&&(e.save(),n?e.drawSvg(this.img,t,i,r,a):(e.translate(t,i),I.AspectRatio(e,this.attribute("preserveAspectRatio").value,r,this.img.width,a,this.img.height,0,0),o.loaded&&(void 0===this.img.complete||this.img.complete)&&e.drawImage(this.img,0,0)),e.restore())},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),t=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");return new I.BoundingBox(e,t,e+i,t+r)}}},I.Element.image.prototype=new I.Element.RenderedElementBase,I.Element.g=function(e){this.base=I.Element.RenderedElementBase,this.base(e),this.getBoundingBox=function(e){for(var t=new I.BoundingBox,i=0;i<this.children.length;i++)t.addBoundingBox(this.children[i].getBoundingBox(e));return t}},I.Element.g.prototype=new I.Element.RenderedElementBase,I.Element.symbol=function(e){this.base=I.Element.RenderedElementBase,this.base(e),this.render=function(e){}},I.Element.symbol.prototype=new I.Element.RenderedElementBase,I.Element.style=function(e){this.base=I.Element.ElementBase,this.base(e);for(var t="",i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].data;t=t.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var r=(t=I.compressSpaces(t)).split("}");for(i=0;i<r.length;i++)if(""!=I.trim(r[i]))for(var a=r[i].split("{"),n=a[0].split(","),o=a[1].split(";"),s=0;s<n.length;s++){var l=I.trim(n[s]);if(""!=l){for(var h=I.Styles[l]||{},u=0;u<o.length;u++){var c=o[u].indexOf(":"),d=o[u].substr(0,c),f=o[u].substr(c+1,o[u].length-c);null!=d&&null!=f&&(h[I.trim(d)]=new I.Property(I.trim(d),I.trim(f)))}if(I.Styles[l]=h,I.StylesSpecificity[l]=P(l),"@font-face"==l)for(var p=h["font-family"].value.replace(/"/g,""),m=h.src.value.split(","),y=0;y<m.length;y++)if(0<m[y].indexOf('format("svg")'))for(var v=m[y].indexOf("url"),g=m[y].indexOf(")",v),b=m[y].substr(v+5,g-v-6),x=I.parseXml(I.ajax(b)).getElementsByTagName("font"),w=0;w<x.length;w++){var S=I.CreateElement(x[w]);I.Definitions[p]=S}}}},I.Element.style.prototype=new I.Element.ElementBase,I.Element.use=function(e){this.base=I.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))};var r=this.getHrefAttribute().getDefinition();this.path=function(e){null!=r&&r.path(e)},this.elementTransform=function(){if(null!=r&&r.style("transform",!1,!0).hasValue())return new I.Transform(r.style("transform",!1,!0).value)},this.getBoundingBox=function(e){if(null!=r)return r.getBoundingBox(e)},this.renderChildren=function(e){if(null!=r){var t=r;"symbol"==r.type&&((t=new I.Element.svg).type="svg",t.attributes.viewBox=new I.Property("viewBox",r.attribute("viewBox").value),t.attributes.preserveAspectRatio=new I.Property("preserveAspectRatio",r.attribute("preserveAspectRatio").value),t.attributes.overflow=new I.Property("overflow",r.attribute("overflow").value),t.children=r.children),"svg"==t.type&&(this.attribute("width").hasValue()&&(t.attributes.width=new I.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(t.attributes.height=new I.Property("height",this.attribute("height").value)));var i=t.parent;t.parent=null,t.render(e),t.parent=i}}},I.Element.use.prototype=new I.Element.RenderedElementBase,I.Element.mask=function(e){this.base=I.Element.ElementBase,this.base(e),this.apply=function(e,t){var i=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y");if(0==a&&0==n){for(var o=new I.BoundingBox,s=0;s<this.children.length;s++)o.addBoundingBox(this.children[s].getBoundingBox(e));i=Math.floor(o.x1),r=Math.floor(o.y1),a=Math.floor(o.width()),n=Math.floor(o.height())}var l=t.attribute("mask").value;t.attribute("mask").value="";var h=p();h.width=i+a,h.height=r+n;var u=h.getContext("2d");this.renderChildren(u);var c=p();c.width=i+a,c.height=r+n;var d=c.getContext("2d");t.render(d),d.globalCompositeOperation="destination-in",d.fillStyle=u.createPattern(h,"no-repeat"),d.fillRect(0,0,i+a,r+n),e.fillStyle=d.createPattern(c,"no-repeat"),e.fillRect(0,0,i+a,r+n),t.attribute("mask").value=l},this.render=function(e){}},I.Element.mask.prototype=new I.Element.ElementBase,I.Element.clipPath=function(e){this.base=I.Element.ElementBase,this.base(e),this.apply=function(e){var t="undefined"!=typeof CanvasRenderingContext2D,i=e.beginPath,r=e.closePath;t&&(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath=function(){}),i.call(e);for(var a=0;a<this.children.length;a++){var n=this.children[a];if(void 0!==n.path){var o=void 0!==n.elementTransform&&n.elementTransform();!o&&n.style("transform",!1,!0).hasValue()&&(o=new I.Transform(n.style("transform",!1,!0).value)),o&&o.apply(e),n.path(e),t&&(CanvasRenderingContext2D.prototype.closePath=r),o&&o.unapply(e)}}r.call(e),e.clip(),t&&(CanvasRenderingContext2D.prototype.beginPath=i,CanvasRenderingContext2D.prototype.closePath=r)},this.render=function(e){}},I.Element.clipPath.prototype=new I.Element.ElementBase,I.Element.filter=function(e){this.base=I.Element.ElementBase,this.base(e),this.apply=function(e,t){var i=t.getBoundingBox(e),r=Math.floor(i.x1),a=Math.floor(i.y1),n=Math.floor(i.width()),o=Math.floor(i.height()),s=t.style("filter").value;t.style("filter").value="";for(var l=0,h=0,u=0;u<this.children.length;u++){var c=this.children[u].extraFilterDistance||0;l=Math.max(l,c),h=Math.max(h,c)}var d=p();d.width=n+2*l,d.height=o+2*h;var f=d.getContext("2d");for(f.translate(-r+l,-a+h),t.render(f),u=0;u<this.children.length;u++)"function"==typeof this.children[u].apply&&this.children[u].apply(f,0,0,n+2*l,o+2*h);e.drawImage(d,0,0,n+2*l,o+2*h,r-l,a-h,n+2*l,o+2*h),t.style("filter",!0).value=s},this.render=function(e){}},I.Element.filter.prototype=new I.Element.ElementBase,I.Element.feMorphology=function(e){this.base=I.Element.ElementBase,this.base(e),this.apply=function(e,t,i,r,a){}},I.Element.feMorphology.prototype=new I.Element.ElementBase,I.Element.feComposite=function(e){this.base=I.Element.ElementBase,this.base(e),this.apply=function(e,t,i,r,a){}},I.Element.feComposite.prototype=new I.Element.ElementBase,I.Element.feColorMatrix=function(e){this.base=I.Element.ElementBase,this.base(e);var r=I.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var t=r[0];r=[.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715+.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var a=r[0]*Math.PI/180,i=function(e,t,i){return e+Math.cos(a)*t+Math.sin(a)*i};r=[i(.213,.787,-.213),i(.715,-.715,-.715),i(.072,-.072,.928),0,0,i(.213,-.213,.143),i(.715,.285,.14),i(.072,-.072,-.283),0,0,i(.213,-.213,-.787),i(.715,-.715,.715),i(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function u(e,t,i,r,a,n){return e[i*r*4+4*t+n]}function c(e,t,i,r,a,n,o){e[i*r*4+4*t+n]=o}function d(e,t){var i=r[e];return i*(i<0?t-255:t)}this.apply=function(e,t,i,r,a){var n=e.getImageData(0,0,r,a);for(i=0;i<a;i++)for(t=0;t<r;t++){var o=u(n.data,t,i,r,0,0),s=u(n.data,t,i,r,0,1),l=u(n.data,t,i,r,0,2),h=u(n.data,t,i,r,0,3);c(n.data,t,i,r,0,0,d(0,o)+d(1,s)+d(2,l)+d(3,h)+d(4,1)),c(n.data,t,i,r,0,1,d(5,o)+d(6,s)+d(7,l)+d(8,h)+d(9,1)),c(n.data,t,i,r,0,2,d(10,o)+d(11,s)+d(12,l)+d(13,h)+d(14,1)),c(n.data,t,i,r,0,3,d(15,o)+d(16,s)+d(17,l)+d(18,h)+d(19,1))}e.clearRect(0,0,r,a),e.putImageData(n,0,0)}},I.Element.feColorMatrix.prototype=new I.Element.ElementBase,I.Element.feGaussianBlur=function(e){this.base=I.Element.ElementBase,this.base(e),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(e,t,i,r,a){m&&void 0!==m.canvasRGBA?(e.canvas.id=I.UniqueId(),e.canvas.style.display="none",document.body.appendChild(e.canvas),m.canvasRGBA(e.canvas,t,i,r,a,this.blurRadius),document.body.removeChild(e.canvas)):I.log("ERROR: StackBlur.js must be included for blur to work")}},I.Element.feGaussianBlur.prototype=new I.Element.ElementBase,I.Element.title=function(e){},I.Element.title.prototype=new I.Element.ElementBase,I.Element.desc=function(e){},I.Element.desc.prototype=new I.Element.ElementBase,I.Element.MISSING=function(e){I.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},I.Element.MISSING.prototype=new I.Element.ElementBase,I.CreateElement=function(e){var t=e.nodeName.replace(/^[^:]+:/,"");t=t.replace(/\-/g,"");var i=null;return(i=void 0!==I.Element[t]?new I.Element[t](e):new I.Element.MISSING(e)).type=e.nodeName,i},I.load=function(e,t){I.loadXml(e,I.ajax(t))},I.loadXml=function(e,t){I.loadXmlDoc(e,I.parseXml(t))},I.loadXmlDoc=function(n,o){I.init(n);var i=function(e){for(var t=n.canvas;t;)e.x-=t.offsetLeft,e.y-=t.offsetTop,t=t.offsetParent;return u.scrollX&&(e.x+=u.scrollX),u.scrollY&&(e.y+=u.scrollY),e};1!=I.opts.ignoreMouse&&(n.canvas.onclick=function(e){var t=i(new I.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));I.Mouse.onclick(t.x,t.y)},n.canvas.onmousemove=function(e){var t=i(new I.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));I.Mouse.onmousemove(t.x,t.y)});var s=I.CreateElement(o.documentElement);s.root=!0,s.addStylesFromStyleDefinition();var l=!0,r=function(){I.ViewPort.Clear(),n.canvas.parentNode?I.ViewPort.SetCurrent(n.canvas.parentNode.clientWidth,n.canvas.parentNode.clientHeight):I.ViewPort.SetCurrent(800,600),1!=I.opts.ignoreDimensions&&(s.style("width").hasValue()&&(n.canvas.width=s.style("width").toPixels("x"),n.canvas.style&&(n.canvas.style.width=n.canvas.width+"px")),s.style("height").hasValue()&&(n.canvas.height=s.style("height").toPixels("y"),n.canvas.style&&(n.canvas.style.height=n.canvas.height+"px")));var e=n.canvas.clientWidth||n.canvas.width,t=n.canvas.clientHeight||n.canvas.height;if(1==I.opts.ignoreDimensions&&s.style("width").hasValue()&&s.style("height").hasValue()&&(e=s.style("width").toPixels("x"),t=s.style("height").toPixels("y")),I.ViewPort.SetCurrent(e,t),null!=I.opts.offsetX&&(s.attribute("x",!0).value=I.opts.offsetX),null!=I.opts.offsetY&&(s.attribute("y",!0).value=I.opts.offsetY),null!=I.opts.scaleWidth||null!=I.opts.scaleHeight){var i=null,r=null,a=I.ToNumberArray(s.attribute("viewBox").value);null!=I.opts.scaleWidth&&(s.attribute("width").hasValue()?i=s.attribute("width").toPixels("x")/I.opts.scaleWidth:isNaN(a[2])||(i=a[2]/I.opts.scaleWidth)),null!=I.opts.scaleHeight&&(s.attribute("height").hasValue()?r=s.attribute("height").toPixels("y")/I.opts.scaleHeight:isNaN(a[3])||(r=a[3]/I.opts.scaleHeight)),null==i&&(i=r),null==r&&(r=i),s.attribute("width",!0).value=I.opts.scaleWidth,s.attribute("height",!0).value=I.opts.scaleHeight,s.style("transform",!0,!0).value+=" scale("+1/i+","+1/r+")"}1!=I.opts.ignoreClear&&n.clearRect(0,0,e,t),s.render(n),l&&(l=!1,"function"==typeof I.opts.renderCallback&&I.opts.renderCallback(o))},a=!0;I.ImagesLoaded()&&(a=!1,r()),I.intervalID=setInterval(function(){var e=!1;if(a&&I.ImagesLoaded()&&(e=!(a=!1)),1!=I.opts.ignoreMouse&&(e|=I.Mouse.hasEvents()),1!=I.opts.ignoreAnimation)for(var t=0;t<I.Animations.length;t++)e|=I.Animations[t].update(1e3/I.FRAMERATE);"function"==typeof I.opts.forceRedraw&&1==I.opts.forceRedraw()&&(e=!0),e&&(r(),I.Mouse.runEvents())},1e3/I.FRAMERATE)},I.stop=function(){I.intervalID&&clearInterval(I.intervalID)},I.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var i=0;i<this.events.length;i++){var r=this.events[i];t.isPointInPath&&t.isPointInPath(r.x,r.y)&&(this.eventElements[i]=e)}},this.checkBoundingBox=function(e,t){for(var i=0;i<this.events.length;i++){var r=this.events[i];t.isPointInBox(r.x,r.y)&&(this.eventElements[i]=e)}},this.runEvents=function(){I.ctx.canvas.style.cursor="";for(var e=0;e<this.events.length;e++)for(var t=this.events[e],i=this.eventElements[e];i;)t.run(i),i=i.parent;this.events=[],this.eventElements=[]}},I}(i||{});"string"==typeof e&&(e=document.getElementById(e)),null!=e.svg&&e.svg.stop(),e.childNodes&&1==e.childNodes.length&&"OBJECT"==e.childNodes[0].nodeName||(e.svg=r);var a=e.getContext("2d");void 0!==t.documentElement?r.loadXmlDoc(a,t):"<"==t.substr(0,1)?r.loadXml(a,t):r.load(a,t)}else for(var n=document.querySelectorAll("svg"),o=0;o<n.length;o++){var s=n[o],l=document.createElement("canvas");l.width=s.clientWidth,l.height=s.clientHeight,s.parentNode.insertBefore(l,s),s.parentNode.removeChild(s);var h=document.createElement("div");h.appendChild(s),c(l,h.innerHTML)}};"undefined"==typeof Element||(void 0!==Element.prototype.matches?d=function(e,t){return e.matches(t)}:void 0!==Element.prototype.webkitMatchesSelector?d=function(e,t){return e.webkitMatchesSelector(t)}:void 0!==Element.prototype.mozMatchesSelector?d=function(e,t){return e.mozMatchesSelector(t)}:void 0!==Element.prototype.msMatchesSelector?d=function(e,t){return e.msMatchesSelector(t)}:void 0!==Element.prototype.oMatchesSelector?d=function(e,t){return e.oMatchesSelector(t)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(d=function(e,t){return $(e).is(t)}),void 0===d&&"undefined"!=typeof Sizzle&&(d=Sizzle.matchesSelector)));var t=/(\[[^\]]+\])/g,i=/(#[^\s\+>~\.\[:]+)/g,n=/(\.[^\s\+>~\.\[:]+)/g,o=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,s=/(:[\w-]+\([^\)]*\))/gi,l=/(:[^\s\+>~\.\[:]+)/g,h=/([^\s\+>~\.\[:]+)/g;function P(r){var a=[0,0,0],e=function(e,t){var i=r.match(e);null!=i&&(a[t]+=i.length,r=r.replace(e," "))};return r=(r=r.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[\s\S]*/gm," "),e(t,1),e(i,0),e(n,1),e(o,2),e(s,1),e(l,1),r=(r=r.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),e(h,2),a.join("")}"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,i,r,a,n){var o={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:i,scaleWidth:r,scaleHeight:a};for(var s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);c(this.canvas,e,o)}),e.exports=c}(e={exports:{}},e.exports),e.exports}(i("WOGj"),i("Qu5F"))},Qu5F:function(e,t){var G=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],W=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function s(e,t,i,r,a){if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLCanvasElement&&!e instanceof HTMLCanvasElement)return;var n,e=e.getContext("2d");try{try{n=e.getImageData(t,i,r,a)}catch(e){throw new Error("unable to access local image data: "+e)}}catch(e){throw new Error("unable to access image data: "+e)}return n}function l(e,t,i,r,a,n){var o;isNaN(n)||n<1||(n|=0,o=h(o=s(e,t,i,r,a),0,0,r,a,n),e.getContext("2d").putImageData(o,t,i))}function h(e,t,i,r,a,n){for(var o,s,l,h,u,c,d,f,p,m,y,v,g,b,x,w,S,P,_,E,C,M=e.data,T=n+n+1,k=r-1,L=a-1,O=n+1,I=O*(O+1)/2,F=new q,D=F,B=1;B<T;B++){var R,D=D.next=new q;B==O&&(R=D)}D.next=F;for(var A=null,N=null,j=h=0,V=G[n],z=W[n],U=0;U<a;U++){for(g=b=x=w=u=c=d=f=0,p=O*(S=M[h]),m=O*(P=M[h+1]),y=O*(_=M[h+2]),v=O*(E=M[h+3]),u+=I*S,c+=I*P,d+=I*_,f+=I*E,D=F,B=0;B<O;B++)D.r=S,D.g=P,D.b=_,D.a=E,D=D.next;for(B=1;B<O;B++)u+=(D.r=S=M[s=h+((k<B?k:B)<<2)])*(C=O-B),c+=(D.g=P=M[s+1])*C,d+=(D.b=_=M[s+2])*C,f+=(D.a=E=M[s+3])*C,g+=S,b+=P,x+=_,w+=E,D=D.next;for(A=F,N=R,o=0;o<r;o++)M[h+3]=E=f*V>>z,0!=E?(M[h]=(u*V>>z)*(E=255/E),M[h+1]=(c*V>>z)*E,M[h+2]=(d*V>>z)*E):M[h]=M[h+1]=M[h+2]=0,u-=p,c-=m,d-=y,f-=v,p-=A.r,m-=A.g,y-=A.b,v-=A.a,s=j+((s=o+n+1)<k?s:k)<<2,u+=g+=A.r=M[s],c+=b+=A.g=M[s+1],d+=x+=A.b=M[s+2],f+=w+=A.a=M[s+3],A=A.next,p+=S=N.r,m+=P=N.g,y+=_=N.b,v+=E=N.a,g-=S,b-=P,x-=_,w-=E,N=N.next,h+=4;j+=r}for(o=0;o<r;o++){for(b=x=w=g=c=d=f=u=0,p=O*(S=M[h=o<<2]),m=O*(P=M[h+1]),y=O*(_=M[h+2]),v=O*(E=M[h+3]),u+=I*S,c+=I*P,d+=I*_,f+=I*E,D=F,B=0;B<O;B++)D.r=S,D.g=P,D.b=_,D.a=E,D=D.next;for(l=r,B=1;B<=n;B++)u+=(D.r=S=M[h=l+o<<2])*(C=O-B),c+=(D.g=P=M[h+1])*C,d+=(D.b=_=M[h+2])*C,f+=(D.a=E=M[h+3])*C,g+=S,b+=P,x+=_,w+=E,D=D.next,B<L&&(l+=r);for(h=o,A=F,N=R,U=0;U<a;U++)M[(s=h<<2)+3]=E=f*V>>z,0<E?(M[s]=(u*V>>z)*(E=255/E),M[s+1]=(c*V>>z)*E,M[s+2]=(d*V>>z)*E):M[s]=M[s+1]=M[s+2]=0,u-=p,c-=m,d-=y,f-=v,p-=A.r,m-=A.g,y-=A.b,v-=A.a,s=o+((s=U+O)<L?s:L)*r<<2,u+=g+=A.r=M[s],c+=b+=A.g=M[s+1],d+=x+=A.b=M[s+2],f+=w+=A.a=M[s+3],A=A.next,p+=S=N.r,m+=P=N.g,y+=_=N.b,v+=E=N.a,g-=S,b-=P,x-=_,w-=E,N=N.next,h+=r}return e}function u(e,t,i,r,a,n){var o;isNaN(n)||n<1||(n|=0,o=c(o=s(e,t,i,r,a),0,0,r,a,n),e.getContext("2d").putImageData(o,t,i))}function c(e,t,i,r,a,n){for(var o,s,l,h,u,c,d,f,p,m,y,v,g,b,x,w,S,P=e.data,_=n+n+1,E=r-1,C=a-1,M=n+1,T=M*(M+1)/2,k=new q,L=k,O=1;O<_;O++){var I,L=L.next=new q;O==M&&(I=L)}L.next=k;for(var F=null,D=null,B=h=0,R=G[n],A=W[n],N=0;N<a;N++){for(y=v=g=u=c=d=0,f=M*(b=P[h]),p=M*(x=P[h+1]),m=M*(w=P[h+2]),u+=T*b,c+=T*x,d+=T*w,L=k,O=0;O<M;O++)L.r=b,L.g=x,L.b=w,L=L.next;for(O=1;O<M;O++)u+=(L.r=b=P[s=h+((E<O?E:O)<<2)])*(S=M-O),c+=(L.g=x=P[s+1])*S,d+=(L.b=w=P[s+2])*S,y+=b,v+=x,g+=w,L=L.next;for(F=k,D=I,o=0;o<r;o++)P[h]=u*R>>A,P[h+1]=c*R>>A,P[h+2]=d*R>>A,u-=f,c-=p,d-=m,f-=F.r,p-=F.g,m-=F.b,s=B+((s=o+n+1)<E?s:E)<<2,u+=y+=F.r=P[s],c+=v+=F.g=P[s+1],d+=g+=F.b=P[s+2],F=F.next,f+=b=D.r,p+=x=D.g,m+=w=D.b,y-=b,v-=x,g-=w,D=D.next,h+=4;B+=r}for(o=0;o<r;o++){for(v=g=y=c=d=u=0,f=M*(b=P[h=o<<2]),p=M*(x=P[h+1]),m=M*(w=P[h+2]),u+=T*b,c+=T*x,d+=T*w,L=k,O=0;O<M;O++)L.r=b,L.g=x,L.b=w,L=L.next;for(l=r,O=1;O<=n;O++)u+=(L.r=b=P[h=l+o<<2])*(S=M-O),c+=(L.g=x=P[h+1])*S,d+=(L.b=w=P[h+2])*S,y+=b,v+=x,g+=w,L=L.next,O<C&&(l+=r);for(h=o,F=k,D=I,N=0;N<a;N++)P[s=h<<2]=u*R>>A,P[s+1]=c*R>>A,P[s+2]=d*R>>A,u-=f,c-=p,d-=m,f-=F.r,p-=F.g,m-=F.b,s=o+((s=N+M)<C?s:C)*r<<2,u+=y+=F.r=P[s],c+=v+=F.g=P[s+1],d+=g+=F.b=P[s+2],F=F.next,f+=b=D.r,p+=x=D.g,m+=w=D.b,y-=b,v-=x,g-=w,D=D.next,h+=r}return e}function q(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}e.exports={image:function(e,t,i,r){if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLImageElement&&!e instanceof HTMLImageElement)return;var a=e.naturalWidth,n=e.naturalHeight;if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLCanvasElement&&!t instanceof HTMLCanvasElement)return;t.style.width=a+"px",t.style.height=n+"px",t.width=a,t.height=n;var o=t.getContext("2d");o.clearRect(0,0,a,n),o.drawImage(e,0,0),isNaN(i)||i<1||(r?l:u)(t,0,0,a,n,i)},canvasRGBA:l,canvasRGB:u,imageDataRGBA:h,imageDataRGB:c}},WOGj:function(e,t){e.exports=function(e){this.ok=!1,this.alpha=1,e=(e=(e="#"==e.charAt(0)?e.substr(1,6):e).replace(/ /g,"")).toLowerCase();var u={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};e=u[e]||e;for(var c=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],t=0;t<c.length;t++){var i=c[t].re,r=c[t].process,i=i.exec(e);i&&(i=r(i),this.r=i[0],this.g=i[1],this.b=i[2],3<i.length&&(this.alpha=i[3]),this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:255<this.r?255:this.r,this.g=this.g<0||isNaN(this.g)?0:255<this.g?255:this.g,this.b=this.b<0||isNaN(this.b)?0:255<this.b?255:this.b,this.alpha=this.alpha<0?0:1<this.alpha||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return"#"+(e=1==e.length?"0"+e:e)+(t=1==t.length?"0"+t:t)+(i=1==i.length?"0"+i:i)},this.getHelpXML=function(){for(var e,t=new Array,i=0;i<c.length;i++)for(var r=c[i].example,a=0;a<r.length;a++)t[t.length]=r[a];for(e in u)t[t.length]=e;var n=document.createElement("ul");n.setAttribute("id","rgbcolor-examples");for(i=0;i<t.length;i++)try{var o=document.createElement("li"),s=new RGBColor(t[i]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+s.toHex()+"; color:"+s.toHex(),l.appendChild(document.createTextNode("test"));var h=document.createTextNode(" "+t[i]+" -> "+s.toRGB()+" -> "+s.toHex());o.appendChild(l),o.appendChild(h),n.appendChild(o)}catch(e){}return n}}},"Z94/":function(e,t){var i=Object.prototype.toString;e.exports=function(e){return"number"==typeof e||!!(t=e)&&"object"==typeof t&&"[object Number]"==i.call(e);var t}},hhWd:function(e,r,a){e.exports=function(){var m=function(e){return typeof e==="number"&&parseFloat(e)==parseInt(e,10)&&!isNaN(e)},D=function(e){return e},r=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(e,t){if(this===undefined||this===null)throw new TypeError('"this" is null or not defined');var i=this.length>>>0;t=+t||0;if(Math.abs(t)===Infinity)t=0;if(t<0){t+=i;if(t<0)t=0}for(;t<i;t++)if(this[t]===e)return t;return-1};var e=function(e){this.objectID="";this.separator=" - ";this.legendSeparator=this.separator;this.method="";this.precision=0;this.precisionflag="auto";this.roundlength=2;this.is_uniqueValues=false;this.debug=false;this.silent=false;this.bounds=Array();this.ranges=Array();this.inner_ranges=null;this.colors=Array();this.counter=Array();this.stat_sorted=null;this.stat_mean=null;this.stat_median=null;this.stat_sum=null;this.stat_max=null;this.stat_min=null;this.stat_pop=null;this.stat_variance=null;this.stat_stddev=null;this.stat_cov=null;this.log=function(e,t){if(this.debug==true||t!=null)console.log(this.objectID+"(object id) :: "+e)};this.setBounds=function(e){this.log("Setting bounds ("+e.length+") : "+e.join());this.bounds=Array();this.bounds=e};this.setSerie=function(e){this.log("Setting serie ("+e.length+") : "+e.join());this.serie=Array();this.serie=e;this.resetStatistics();this.setPrecision()};this.setColors=function(e){this.log("Setting color ramp ("+e.length+") : "+e.join());this.colors=e};this.doCount=function(){if(this._nodata())return;var e=this.sorted();this.counter=new Array;for(i=0;i<this.bounds.length-1;i++)this.counter[i]=0;for(j=0;j<e.length;j++){var t=this.getClass(e[j]);this.counter[t]++}};this.setPrecision=function(e){if(typeof e!=="undefined"){this.precisionflag="manual";this.precision=e}if(this.precisionflag=="auto")for(var t=0;t<this.serie.length;t++){if(!isNaN(this.serie[t]+"")&&(this.serie[t]+"").toString().indexOf(".")!=-1)var i=(this.serie[t]+"").split(".")[1].length;else var i=0;if(i>this.precision)this.precision=i}if(this.precision>20){this.log("this.precision value ("+this.precision+') is greater than max value. Automatic set-up to 20 to prevent "Uncaught RangeError: toFixed()" when calling decimalFormat() method.');this.precision=20}this.log("Calling setPrecision(). Mode : "+this.precisionflag+" - Decimals : "+this.precision);this.serie=this.decimalFormat(this.serie)};this.decimalFormat=function(e){var t=new Array;for(var i=0;i<e.length;i++)if(r(e[i]))t[i]=parseFloat(parseFloat(e[i]).toFixed(this.precision));else t[i]=e[i];return t};this.setRanges=function(){this.ranges=Array();for(i=0;i<this.bounds.length-1;i++)this.ranges[i]=this.bounds[i]+this.separator+this.bounds[i+1]};this.min=function(){if(this._nodata())return;this.stat_min=this.serie[0];for(i=0;i<this.pop();i++)if(this.serie[i]<this.stat_min)this.stat_min=this.serie[i];return this.stat_min};this.max=function(){if(this._nodata())return;this.stat_max=this.serie[0];for(i=0;i<this.pop();i++)if(this.serie[i]>this.stat_max)this.stat_max=this.serie[i];return this.stat_max};this.sum=function(){if(this._nodata())return;if(this.stat_sum==null){this.stat_sum=0;for(i=0;i<this.pop();i++)this.stat_sum+=parseFloat(this.serie[i])}return this.stat_sum};this.pop=function(){if(this._nodata())return;if(this.stat_pop==null)this.stat_pop=this.serie.length;return this.stat_pop};this.mean=function(){if(this._nodata())return;if(this.stat_mean==null)this.stat_mean=parseFloat(this.sum()/this.pop());return this.stat_mean};this.median=function(){if(this._nodata())return;if(this.stat_median==null){this.stat_median=0;var e=this.sorted();if(e.length%2)this.stat_median=parseFloat(e[Math.ceil(e.length/2)-1]);else this.stat_median=(parseFloat(e[e.length/2-1])+parseFloat(e[e.length/2]))/2}return this.stat_median};this.variance=function(){round=typeof round==="undefined"?true:false;if(this._nodata())return;if(this.stat_variance==null){var e=0,t=this.mean();for(var i=0;i<this.pop();i++)e+=Math.pow(this.serie[i]-t,2);this.stat_variance=e/this.pop();if(round==true)this.stat_variance=Math.round(this.stat_variance*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength)}return this.stat_variance};this.stddev=function(e){e=typeof e==="undefined"?true:false;if(this._nodata())return;if(this.stat_stddev==null){this.stat_stddev=Math.sqrt(this.variance());if(e==true)this.stat_stddev=Math.round(this.stat_stddev*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength)}return this.stat_stddev};this.cov=function(e){e=typeof e==="undefined"?true:false;if(this._nodata())return;if(this.stat_cov==null){this.stat_cov=this.stddev()/this.mean();if(e==true)this.stat_cov=Math.round(this.stat_cov*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength)}return this.stat_cov};this.resetStatistics=function(){this.stat_sorted=null;this.stat_mean=null;this.stat_median=null;this.stat_sum=null;this.stat_max=null;this.stat_min=null;this.stat_pop=null;this.stat_variance=null;this.stat_stddev=null;this.stat_cov=null};this._nodata=function(){if(this.serie.length==0){if(this.silent)this.log("[silent mode] Error. You should first enter a serie!",true);else throw new TypeError("Error. You should first enter a serie!");return 1}else return 0};this._hasNegativeValue=function(){for(i=0;i<this.serie.length;i++)if(this.serie[i]<0)return true;return false};this._hasZeroValue=function(){for(i=0;i<this.serie.length;i++)if(parseFloat(this.serie[i])===0)return true;return false};this.sorted=function(){if(this.stat_sorted==null)if(this.is_uniqueValues==false)this.stat_sorted=this.serie.sort(function(e,t){return e-t});else this.stat_sorted=this.serie.sort(function(e,t){var i=e.toString().toLowerCase(),r=t.toString().toLowerCase();if(i<r)return-1;if(i>r)return 1;return 0});return this.stat_sorted};this.info=function(){if(this._nodata())return;var e="";e+=D("Population")+" : "+this.pop()+" - ["+D("Min")+" : "+this.min()+" | "+D("Max")+" : "+this.max()+"]"+"\n";e+=D("Mean")+" : "+this.mean()+" - "+D("Median")+" : "+this.median()+"\n";e+=D("Variance")+" : "+this.variance()+" - "+D("Standard deviation")+" : "+this.stddev()+" - "+D("Coefficient of variation")+" : "+this.cov()+"\n";return e};this.setClassManually=function(e){if(this._nodata())return;if(e[0]!==this.min()||e[e.length-1]!==this.max()){if(this.silent)this.log("[silent mode] "+t("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()),true);else throw new TypeError(D("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()));return}this.setBounds(e);this.setRanges();this.method=D("manual classification")+" ("+(e.length-1)+" "+D("classes")+")";return this.bounds};this.getClassEqInterval=function(e,t,r){if(this._nodata())return;var a=typeof t==="undefined"?this.min():t;var n=typeof r==="undefined"?this.max():r;var o=Array();var s=a;var l=(n-a)/e;for(i=0;i<=e;i++){o[i]=s;s+=l}o[e]=n;this.setBounds(o);this.setRanges();this.method=D("eq. intervals")+" ("+e+" "+D("classes")+")";return this.bounds};this.getQuantiles=function(e){var t=this.sorted();var i=[];var r=this.pop()/e;for(var a=1;a<e;a++){var n=Math.round(a*r+.49);i.push(t[n-1])}return i};this.getClassQuantile=function(e){if(this._nodata())return;var t=this.sorted();var i=this.getQuantiles(e);i.unshift(t[0]);if(i[t.length-1]!==t[t.length-1])i.push(t[t.length-1]);this.setBounds(i);this.setRanges();this.method=D("quantile")+" ("+e+" "+D("classes")+")";return this.bounds};this.getClassStdDeviation=function(e,t){if(this._nodata())return;var r=this.max();var a=this.min();var n=Array();if(e%2==1){var o=Math.floor(e/2);var s=o+1;n[o]=this.mean()-this.stddev()/2;n[s]=this.mean()+this.stddev()/2;for(i=o-1;i>0;i--){var l=n[i+1]-this.stddev();n[i]=l}for(i=s+1;i<e;i++){var l=n[i-1]+this.stddev();n[i]=l}}else{var h=e/2;n[h]=this.mean();for(i=h-1;i>0;i--){var l=n[i+1]-this.stddev();n[i]=l}for(i=h+1;i<e;i++){var l=n[i-1]+this.stddev();n[i]=l}}n[0]=typeof t==="undefined"?n[1]-this.stddev():this.min();n[e]=typeof t==="undefined"?n[e-1]+this.stddev():this.max();this.setBounds(n);this.setRanges();this.method=D("std deviation")+" ("+e+" "+D("classes")+")";return this.bounds};this.getClassGeometricProgression=function(e){if(this._nodata())return;if(this._hasNegativeValue()||this._hasZeroValue()){if(this.silent)this.log("[silent mode] "+D("geometric progression can't be applied with a serie containing negative or zero values."),true);else throw new TypeError(D("geometric progression can't be applied with a serie containing negative or zero values."));return}var t=Array();var r=this.min();var a=this.max();var n=Math.log(a)/Math.LN10;var o=Math.log(r)/Math.LN10;var s=(n-o)/e;for(i=0;i<e;i++)if(i==0)t[i]=o;else t[i]=t[i-1]+s;t=t.map(function(e){return Math.pow(10,e)});t.push(this.max());this.setBounds(t);this.setRanges();this.method=D("geometric progression")+" ("+e+" "+D("classes")+")";return this.bounds};this.getClassArithmeticProgression=function(e){if(this._nodata())return;var t=0;for(i=1;i<=e;i++)t+=i;var r=Array();var a=this.min();var n=this.max();var o=(n-a)/t;for(i=0;i<=e;i++)if(i==0)r[i]=a;else r[i]=r[i-1]+i*o;this.setBounds(r);this.setRanges();this.method=D("arithmetic progression")+" ("+e+" "+D("classes")+")";return this.bounds};this.getClassJenks=function(e){if(this._nodata())return;dataList=this.sorted();var t=[];for(var i=0,r=dataList.length+1;i<r;i++){var a=[];for(var n=0,o=e+1;n<o;n++)a.push(0);t.push(a)}var s=[];for(var l=0,h=dataList.length+1;l<h;l++){var u=[];for(var c=0,d=e+1;c<d;c++)u.push(0);s.push(u)}for(var f=1,p=e+1;f<p;f++){t[0][f]=1;s[0][f]=0;for(var m=1,y=dataList.length+1;m<y;m++)s[m][f]=Infinity;var v=0}for(var g=2,b=dataList.length+1;g<b;g++){var x=0;var w=0;var S=0;for(var P=1,_=g+1;P<_;P++){var E=g-P+1;var C=parseFloat(dataList[E-1]);w+=C*C;x+=C;S+=1;v=w-x*x/S;var M=E-1;if(M!=0)for(var T=2,k=e+1;T<k;T++)if(s[g][T]>=v+s[M][T-1]){t[g][T]=E;s[g][T]=v+s[M][T-1]}}t[g][1]=1;s[g][1]=v}var L=dataList.length;var O=[];for(l=0;l<=e;l++)O.push(0);O[e]=parseFloat(dataList[dataList.length-1]);O[0]=parseFloat(dataList[0]);var I=e;while(I>=2){var F=parseInt(t[L][I]-2);O[I-1]=dataList[F];L=parseInt(t[L][I]-1);I-=1}if(O[0]==O[1])O[0]=0;this.setBounds(O);this.setRanges();this.method=D("Jenks")+" ("+e+" "+D("classes")+")";return this.bounds};this.getClassUniqueValues=function(){if(this._nodata())return;this.is_uniqueValues=true;var e=this.sorted();var t=Array();for(i=0;i<this.pop();i++)if(t.indexOf(e[i])===-1)t.push(e[i]);this.bounds=t;this.method=D("unique values");return t};this.getClass=function(e){for(i=0;i<this.bounds.length;i++)if(this.is_uniqueValues==true){if(e==this.bounds[i])return i}else if(parseFloat(e)<=this.bounds[i+1])return i;return D("Unable to get value's class.")};this.getRanges=function(){return this.ranges};this.getRangeNum=function(e){var t,i;for(i=0;i<this.ranges.length;i++){t=this.ranges[i].split(/ - /);if(e<=parseFloat(t[1]))return i}};this.getInnerRanges=function(){if(this.inner_ranges!=null)return this.inner_ranges;var e=new Array;var t=this.sorted();var r=1;for(i=0;i<t.length;i++){if(i==0)var a=t[i];if(parseFloat(t[i])>parseFloat(this.bounds[r])){e[r-1]=""+a+this.separator+t[i-1];var a=t[i];r++}if(r==this.bounds.length-1){e[r-1]=""+a+this.separator+t[t.length-1];this.inner_ranges=e;return this.inner_ranges}}};this.getSortedlist=function(){return this.sorted().join(", ")};this.getHtmlLegend=function(e,t,r,a,n,o){var s="";var l=new Array;this.doCount();if(e!=null)ccolors=e;else ccolors=this.colors;if(t!=null)lg=t;else lg="Legend";if(r!=null)getcounter=true;else getcounter=false;if(a!=null)fn=a;else fn=function(e){return e};if(n==null)n="default";if(n=="discontinuous"){this.getInnerRanges();if(this.counter.indexOf(0)!==-1){if(this.silent)this.log("[silent mode] "+D("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"),true);else throw new TypeError(D("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"));return}}if(o!=="DESC")o="ASC";if(ccolors.length<this.ranges.length){if(this.silent)this.log("[silent mode] "+D("The number of colors should fit the number of ranges. Exit!"),true);else throw new TypeError(D("The number of colors should fit the number of ranges. Exit!"));return}if(this.is_uniqueValues==false)for(i=0;i<this.ranges.length;i++){if(getcounter===true)s=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>";var h=this.ranges[i].split(this.separator);var u=parseFloat(h[0]).toFixed(this.precision);var c=parseFloat(h[1]).toFixed(this.precision);if(n=="distinct"&&i!=0)if(m(u)){u=parseInt(u)+1;if(this.precisionflag=="manual"&&this.precision!=0)u=parseFloat(u).toFixed(this.precision)}else{u=parseFloat(u)+1/Math.pow(10,this.precision);u=parseFloat(u).toFixed(this.precision)}if(n=="discontinuous"){var h=this.inner_ranges[i].split(this.separator);var u=parseFloat(h[0]).toFixed(this.precision);var c=parseFloat(h[1]).toFixed(this.precision)}var d=fn(u)+this.legendSeparator+fn(c);var f='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+d+s+"</div>";l.push(f)}else for(i=0;i<this.bounds.length;i++){if(getcounter===true)s=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>";var d=fn(this.bounds[i]);var f='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+d+s+"</div>";l.push(f)}if(o==="DESC")l.reverse();var p='<div class="geostats-legend"><div class="geostats-legend-title">'+D(lg)+"</div>";for(i=0;i<l.length;i++)p+=l[i];p+="</div>";return p};this.objectID=(new Date).getUTCMilliseconds();this.log("Creating new geostats object");if(typeof e!=="undefined"&&e.length>0){this.serie=e;this.setPrecision();this.log("Setting serie ("+e.length+") : "+e.join())}else this.serie=Array();this.getJenks=this.getClassJenks;this.getGeometricProgression=this.getClassGeometricProgression;this.getEqInterval=this.getClassEqInterval;this.getQuantile=this.getClassQuantile;this.getStdDeviation=this.getClassStdDeviation;this.getUniqueValues=this.getClassUniqueValues;this.getArithmeticProgression=this.getClassArithmeticProgression};return window.geostats=e}()},o2tc:function(e){e.exports=JSON.parse('[{"name":"克拉玛依市","coord":[85.01486759299489,45.406422237230046]},{"name":"昌吉回族自治州","coord":[88.7154624754753,44.26991024636568]},{"name":"石河子市","coord":[86.0208600035924,44.239045558096805]},{"name":"霍林郭勒市","coord":[114.73479243733115,44.16058374713977]},{"name":"本溪市","coord":[124.64357865201586,41.177197783134275]},{"name":"嘉峪关市","coord":[98.16891560537093,39.76279786284264]},{"name":"莱芜市","coord":[117.65723565456207,36.27916499211527]},{"name":"神农架林区","coord":[110.48296222218153,31.581260143666697]},{"name":"天门市","coord":[113.00615321481195,30.64105781887143]},{"name":"鄂州市","coord":[114.94764081970385,30.325634953844585]},{"name":"潜江市","coord":[112.70703817700621,30.349210666019893]},{"name":"仙桃市","coord":[113.34688900729822,30.315951161935402]},{"name":"萍乡市","coord":[113.88072263074415,27.47193090553213]},{"name":"台湾省","coord":[120.14338943402045,23.596002465926095]},{"name":"东莞市","coord":[113.89443658529342,22.897826158636448]},{"name":"中山市","coord":[113.37118387764659,22.501478858616522]},{"name":"珠海市","coord":[113.21799258934986,22.23782602992192]},{"name":"北海市","coord":[109.18248083043899,21.695773689750148]},{"name":"香港","coord":[114.20689279508653,22.36016760139811]},{"name":"舟山市","coord":[122.22514712841459,30.338633120695956]},{"name":"克孜勒苏柯尔克孜","coord":[74.62910472637343,39.59886016069875]},{"name":"喀什地区","coord":[77.19899922143753,37.85462871211595]},{"name":"阿克苏地区","coord":[81.43930290016381,41.067304799230456]},{"name":"和田地区","coord":[80.69780509160952,36.95287032287055]},{"name":"阿里地区","coord":[82.536487505389,32.69566569631762]},{"name":"日喀则地区","coord":[86.5996831353606,29.54861754814263]},{"name":"那曲地区","coord":[88.32523292667608,33.20600450932715]},{"name":"玉树藏族自治州","coord":[95.2107128446203,33.90320387919257]},{"name":"迪庆藏族自治州","coord":[99.42465312188943,28.052797714348895]},{"name":"怒江傈傈族自治州","coord":[98.85737910439825,26.98345757528851]},{"name":"大理白族自治州","coord":[99.93934374816013,25.684737357453045]},{"name":"德宏傣族景颇族自","coord":[98.13830877778075,24.593421919561205]},{"name":"保山市","coord":[99.19031013453166,24.979380341662]},{"name":"临沧市","coord":[99.62483778975081,24.058807858948214]},{"name":"普洱市","coord":[100.94440267992684,23.44121660743221]},{"name":"西双版纳傣族自治","coord":[100.86105801845994,21.882475641324206]},{"name":"拉萨市","coord":[91.3684790613129,30.14176592960237]},{"name":"山南地区","coord":[92.11665242621062,28.33000201578789]},{"name":"林芝地区","coord":[94.9307847458166,29.125110156601963]},{"name":"昌都地区","coord":[97.33912235873476,30.48520825551814]},{"name":"丽江市","coord":[100.65713436205135,26.96190318191959]},{"name":"攀枝花市","coord":[101.73355913301131,26.714486678752795]},{"name":"凉山彝族自治州","coord":[102.08678551422615,27.683020519860396]},{"name":"楚雄彝族自治州","coord":[101.68264761198458,25.369603845264024]},{"name":"红河哈尼族彝族自","coord":[102.95101719613119,23.624860095239875]},{"name":"文山壮族苗族自治","coord":[104.8708359910614,23.579587266862504]},{"name":"百色市","coord":[106.69546907589859,23.98220841166522]},{"name":"崇左市","coord":[107.3277087317123,22.49769755349952]},{"name":"防城港市","coord":[107.88939931155171,21.94550204069006]},{"name":"南宁市","coord":[108.67078983716917,23.12207641861882]},{"name":"钦州市","coord":[108.8532307305186,22.157690108421384]},{"name":"玉林市","coord":[110.26918466489103,22.391823643610415]},{"name":"湛江市","coord":[109.93033457863683,21.086751055633457]},{"name":"茂名市","coord":[110.80336192333934,22.069184739040775]},{"name":"阳江市","coord":[111.70471342186183,22.108751366417575]},{"name":"江门市","coord":[112.53715618649149,22.297368082806777]},{"name":"广州市","coord":[113.4949302208309,23.28359314707863]},{"name":"清远市","coord":[113.10957368131268,24.334444053233856]},{"name":"肇庆市","coord":[112.11117530204233,23.60241158796112]},{"name":"梧州市","coord":[111.01709510772797,23.518132876753846]},{"name":"贺州市","coord":[111.50423061842756,24.4095096817199]},{"name":"桂林市","coord":[110.44046163393094,25.353966673735407]},{"name":"柳州市","coord":[109.34854449214147,24.972408051485047]},{"name":"河池市","coord":[107.81191841865586,24.649291651298164]},{"name":"黔东南苗族侗族自","coord":[108.39952601614591,26.429286420465576]},{"name":"贵阳市","coord":[106.59784062851153,26.797907456479816]},{"name":"安顺市","coord":[105.76161265300635,25.988644902171018]},{"name":"黔西南布依族苗族","coord":[105.5954078788574,25.404850939549405]},{"name":"曲靖市","coord":[103.9164335632742,25.697243690315265]},{"name":"六盘水市","coord":[104.77723228072432,26.15402255629164]},{"name":"毕节地区","coord":[105.03867422931839,27.077913968069666]},{"name":"昭通市","coord":[104.29730513046874,27.62418247971078]},{"name":"宜宾市","coord":[104.76748901448207,28.553501804266475]},{"name":"乐山市","coord":[103.56027669102787,29.160754519210577]},{"name":"自贡市","coord":[104.63272827056402,29.273152614922402]},{"name":"内江市","coord":[104.82644562304716,29.61272653799929]},{"name":"遵义市","coord":[106.82413636302059,28.191847588570702]},{"name":"达州市","coord":[107.59704170009518,31.32138258839703]},{"name":"遂宁市","coord":[105.48979445433736,30.677687821242678]},{"name":"广安市","coord":[106.56708164098042,30.43500706741521]},{"name":"泸州市","coord":[105.42591761727707,28.50277238478137]},{"name":"资阳市","coord":[104.97995126874034,30.154251886139654]},{"name":"雅安市","coord":[102.69931299964517,29.892630706195035]},{"name":"眉山市","coord":[104.07052881858888,29.894202166560405]},{"name":"甘孜藏族自治州","coord":[100.50721042614238,30.975216556269658]},{"name":"果洛藏族自治州","coord":[99.30775565051923,34.03539865224808]},{"name":"海南藏族自治州","coord":[100.39969108016373,35.90048272566899]},{"name":"黄南藏族自治州","coord":[101.5360706381689,35.10286360841902]},{"name":"赣南藏族自治州","coord":[102.97083885806067,34.326752803339026]},{"name":"陇南市","coord":[105.24780098912132,33.57031117443431]},{"name":"天水市","coord":[105.53503634660417,34.62320421368087]},{"name":"定西市","coord":[104.58787768541339,35.08900966621695]},{"name":"临夏回族自治州","coord":[103.2612870434902,35.591577124455235]},{"name":"西宁市","coord":[101.57680657999033,36.84800271717157]},{"name":"海东地区","coord":[102.30909850729282,36.287400615025646]},{"name":"海北藏族自治州","coord":[100.27122484450717,37.892557516083826]},{"name":"金昌市","coord":[102.02244049169511,38.497330414886164]},{"name":"酒泉市","coord":[95.94486678270127,40.56891536586272]},{"name":"海西蒙古族藏族自","coord":[94.67143298050689,36.022725148503724]},{"name":"巴音郭楞蒙古自治","coord":[88.18116214759745,39.556478810319916]},{"name":"哈密地区","coord":[93.84302392518026,42.95015211178875]},{"name":"叶鲁番地区","coord":[89.82035217277885,42.399368632283505]},{"name":"乌鲁木齐市","coord":[88.00048109561487,43.549986370786]},{"name":"阿勒泰地区","coord":[88.11213933257655,47.05593413019629]},{"name":"博尔塔拉蒙古自治","coord":[82.26402238163408,44.671135542630864]},{"name":"伊犁哈萨克自治州","coord":[82.80778717477179,43.53783381365267]},{"name":"阿拉善盟","coord":[103.29923966842289,40.10955801781495]},{"name":"武威市","coord":[102.73362058791429,37.94211141321436]},{"name":"兰州市","coord":[103.73793563506032,36.27379827886003]},{"name":"中卫市","coord":[105.6943786030716,37.20654236148948]},{"name":"银川市","coord":[106.20022174140034,38.52103167597483]},{"name":"石嘴山市","coord":[106.41544011793628,38.84054137571417]},{"name":"乌海市","coord":[106.8984175998405,39.54616572239788]},{"name":"鄂尔多斯市","coord":[108.43285571424619,39.24036799350715]},{"name":"巴彦淖尔市","coord":[107.45840392808307,41.30159860424196]},{"name":"包头市","coord":[110.46472193224272,41.48017783644221]},{"name":"呼和浩特市","coord":[111.48365173603975,40.498363056149884]},{"name":"乌兰察布市","coord":[112.61568977597707,41.75789561273154]},{"name":"大同市","coord":[113.7107192749083,39.898956799744184]},{"name":"朔州市","coord":[112.65428748167508,39.681772914701924]},{"name":"忻州市","coord":[112.36127575589583,38.88990233614568]},{"name":"榆林市","coord":[109.68473112169593,38.19921027134876]},{"name":"延安市","coord":[109.52425222161318,36.406522726136814]},{"name":"庆阳市","coord":[107.73052193155061,36.183821532624464]},{"name":"固原市","coord":[106.20191575442442,36.11634909496382]},{"name":"白银市","coord":[104.68634478137065,36.51582865625868]},{"name":"宝鸡市","coord":[107.33534779230747,34.3387216485855]},{"name":"汉中市","coord":[107.03534754266246,33.00142998064871]},{"name":"广元市","coord":[105.92928137563939,32.21872447205537]},{"name":"巴中市","coord":[107.03422410306194,31.99874720836291]},{"name":"南充市","coord":[106.32964805032347,31.156657700184095]},{"name":"绵阳市","coord":[104.58949560201106,31.88628780630976]},{"name":"德阳市","coord":[104.41542984932845,31.110558133718676]},{"name":"成都市","coord":[103.8852290010473,30.777258040348634]},{"name":"阿坝藏族羌族自治","coord":[102.26209319552814,32.45725845387284]},{"name":"安康市","coord":[109.14236501848015,32.77467694678074]},{"name":"十堰市","coord":[110.39934083416314,32.376209039347906]},{"name":"襄阳市","coord":[111.97539147094662,31.93399822417465]},{"name":"宜昌市","coord":[111.22204852395754,30.772457669035354]},{"name":"恩施市","coord":[109.42158366502872,30.260366574390105]},{"name":"张家界市","coord":[110.59760006538717,29.330107409240718]},{"name":"吉首市","coord":[109.72176899848378,28.681903937242495]},{"name":"铜仁地区","coord":[108.54247523485463,28.11736237519646]},{"name":"重庆市","coord":[107.86007108564992,30.186253395053196]},{"name":"怀化市","coord":[109.94325166787243,27.43919084801186]},{"name":"益阳市","coord":[112.43060358108062,28.75127294553697]},{"name":"娄底市","coord":[111.41891416951897,27.696312460064604]},{"name":"常德市","coord":[111.72571610131646,29.27189463838195]},{"name":"荆州市","coord":[112.65896596965268,30.05161542755362]},{"name":"荆门市","coord":[112.6586855902184,31.01267124474617]},{"name":"岳阳市","coord":[113.2595036144316,29.106247116930163]},{"name":"长沙市","coord":[113.15415586456598,28.222934680488425]},{"name":"湘潭市","coord":[112.51092596317824,27.69881544105668]},{"name":"株州市","coord":[113.49665538546823,27.03993794610501]},{"name":"衡阳市","coord":[112.48849636578527,26.783613569970782]},{"name":"邵阳市","coord":[110.6723832117475,26.81652287086792]},{"name":"永州市","coord":[111.8565364154186,25.768488267811968]},{"name":"韶关市","coord":[113.53420325850979,24.69848878771937]},{"name":"惠州市","coord":[114.32029589634925,23.25504544231892]},{"name":"佛山市","coord":[112.95925897403649,23.10116677189257]},{"name":"云浮市","coord":[111.78042514904234,22.840400494105687]},{"name":"深圳市","coord":[114.13138648919008,22.649563063468342]},{"name":"汕尾市","coord":[115.57412892884373,23.06989642104901]},{"name":"河源市","coord":[114.89746229844398,23.97971937124767]},{"name":"揭阳市","coord":[116.04290004239446,23.304802704715357]},{"name":"汕头市","coord":[116.7008461897183,23.35898625947344]},{"name":"潮州市","coord":[116.75405548481658,23.854381508863064]},{"name":"梅州市","coord":[116.13719397345734,24.15633544812716]},{"name":"漳州市","coord":[117.38279760543345,24.41111215459575]},{"name":"厦门市","coord":[118.04275971554665,24.675908246507944]},{"name":"龙岩市","coord":[116.69341144552507,25.20284542644492]},{"name":"泉州市","coord":[118.12035864630246,25.22984144365049]},{"name":"莆田市","coord":[118.82439690138142,25.439653480972687]},{"name":"福州市","coord":[119.1608285845262,25.99117532466728]},{"name":"三明市","coord":[117.51188176216434,26.318292906961602]},{"name":"南平市","coord":[118.16153136678187,27.306303151805437]},{"name":"抚州市","coord":[116.3455359885574,27.487043655935366]},{"name":"鹰潭市","coord":[117.01082360702333,28.241253742969946]},{"name":"吉安市","coord":[114.91377151807418,26.957486660664525]},{"name":"赣州市","coord":[115.046455717572,25.81565075681663]},{"name":"郴州市","coord":[113.1544526703492,25.871927095452524]},{"name":"新余市","coord":[114.94161795877827,27.79044654578371]},{"name":"宜春市","coord":[115.04574494880995,28.306428044943356]},{"name":"南昌市","coord":[115.9963824234495,28.664803351584705]},{"name":"九江市","coord":[115.53225905704193,29.362905920276297]},{"name":"上饶市","coord":[117.8595355766598,28.765755150094634]},{"name":"景德镇市","coord":[117.25387030721845,29.33426823662448]},{"name":"黄山市","coord":[117.85476357809696,29.969632034273722]},{"name":"池州市","coord":[117.34517113140791,30.208089337922335]},{"name":"铜陵市","coord":[117.93160431300694,30.926442655001676]},{"name":"安庆市","coord":[116.54307680610799,30.524265461641296]},{"name":"黄石市","coord":[115.02354597728443,29.924060229331015]},{"name":"咸宁市","coord":[114.26967602231792,29.652174021136048]},{"name":"黄冈市","coord":[115.2859016705373,30.65856897065683]},{"name":"武汉市","coord":[114.34552076948799,30.68836237966767]},{"name":"随州市","coord":[113.3850627838818,31.87891659924412]},{"name":"信阳市","coord":[114.81374730587638,32.0309685135914]},{"name":"驻马店市","coord":[114.07756451509235,32.896720987266114]},{"name":"商洛市","coord":[109.82044421310393,33.77403373563189]},{"name":"西安市","coord":[109.11839808451401,34.225257215515896]},{"name":"渭南市","coord":[109.75732444226935,35.025913644359306]},{"name":"铜川市","coord":[108.98695328111377,35.19235092947735]},{"name":"咸阳市","coord":[108.36398776446165,34.84311348287181]},{"name":"三门峡市","coord":[110.80049688104964,34.31818709571671]},{"name":"运城市","coord":[111.1736679525165,35.19010372283576]},{"name":"洛阳市","coord":[111.87577573098216,34.33379926109848]},{"name":"平顶山市","coord":[112.80931281928427,33.759895800153096]},{"name":"漯河市","coord":[113.83505724178012,33.70034266174508]},{"name":"许昌市","coord":[113.78762484088509,34.051835688452435]},{"name":"郑州市","coord":[113.49619951867594,34.61181797865449]},{"name":"焦作市","coord":[113.13404280173008,35.134167097471625]},{"name":"晋城市","coord":[112.7495732073233,35.63186423091449]},{"name":"长治市","coord":[112.85900842873183,36.45872910742828]},{"name":"临汾市","coord":[111.49379787924448,36.22810800777857]},{"name":"太原市","coord":[112.15628804033796,37.91704444063036]},{"name":"吕梁市","coord":[111.31901105774872,37.712740463356496]},{"name":"晋中市","coord":[113.08199599739676,37.36532613794343]},{"name":"邯郸市","coord":[114.41824047234618,36.530119932543315]},{"name":"安阳市","coord":[113.88883283163116,35.7797611183252]},{"name":"鹤壁市","coord":[114.3654094911545,35.75770487428472]},{"name":"新乡市","coord":[113.9184107718167,35.348471214026716]},{"name":"开封市","coord":[114.52801677500626,34.61371216679872]},{"name":"周口市","coord":[114.88509782391864,33.69999759722657]},{"name":"阜阳市","coord":[115.44595951398213,32.98060371610532]},{"name":"淮南市","coord":[116.68941991880993,32.79972275772595]},{"name":"蚌埠市","coord":[117.38594715783302,33.106729536033896]},{"name":"淮北市","coord":[116.69651711889378,33.69527529383458]},{"name":"宿州市","coord":[117.30175405886838,33.943330421260015]},{"name":"亳州市","coord":[116.12410804185097,33.46769392946132]},{"name":"商丘市","coord":[115.59575176872548,34.28339840831147]},{"name":"菏泽市","coord":[115.53631974831816,35.197319393220624]},{"name":"濮阳市","coord":[115.3070485514902,35.775883510964334]},{"name":"聊城市","coord":[115.8870069012884,36.40529594548765]},{"name":"邢台市","coord":[114.74259008644859,37.251396750084155]},{"name":"石家庄市","coord":[114.56923838363613,38.13141710980106]},{"name":"阳泉市","coord":[113.39216149668508,38.09075470547468]},{"name":"保定市","coord":[115.261524468934,39.09118520781398]},{"name":"衡水市","coord":[115.8182936677897,37.715661598187154]},{"name":"德州市","coord":[116.4582273790399,37.19372347888644]},{"name":"沧州市","coord":[116.76192710911863,38.20240042039232]},{"name":"廊坊市","coord":[116.50410772133856,39.27896741763884]},{"name":"天津市","coord":[117.31988934444873,39.37154482470619]},{"name":"北京市","coord":[116.59734730757869,40.237112944270976]},{"name":"张家口市","coord":[115.1823606483226,40.83732566607167]},{"name":"唐山市","coord":[117.8693184261954,39.71862889477249]},{"name":"秦皇岛市","coord":[119.30467355367742,39.990574652162564]},{"name":"承德市","coord":[117.16275671911026,41.36623845548547]},{"name":"葫芦岛市","coord":[119.9342336210531,40.5628822626519]},{"name":"朝阳市","coord":[120.11853493535794,41.471852354885755]},{"name":"赤峰市","coord":[118.50943546234379,43.25452976059767]},{"name":"锦州市","coord":[121.5167549323861,41.45933087433065]},{"name":"营口市","coord":[122.58571915054674,40.42093503997384]},{"name":"丹东市","coord":[124.33549382902183,40.46369290272115]},{"name":"辽阳市","coord":[123.34064798039414,41.152331397771356]},{"name":"盘锦市","coord":[122.06718005354679,41.05573599862555]},{"name":"阜新市","coord":[121.93889757908204,42.27641773244204]},{"name":"鞍山市","coord":[122.78904432242356,40.77781183142038]},{"name":"沈阳市","coord":[122.99508899709724,42.1162195010079]},{"name":"铁岭市","coord":[124.23100515588399,42.72666083611828]},{"name":"扶顺市","coord":[124.46027188217573,41.82955407638859]},{"name":"通辽市","coord":[122.0729370657937,43.90889130864869]},{"name":"兴安盟","coord":[120.79456431092532,45.92003249442161]},{"name":"白城市","coord":[123.10619907715235,45.25475749267784]},{"name":"齐齐哈尔市","coord":[124.5462214659102,47.55395009317394]},{"name":"大兴安岭地区","coord":[124.50992855161529,52.18438447846694]},{"name":"黑河市","coord":[127.14721400335922,49.25080134026901]},{"name":"大庆市","coord":[124.40329830095243,46.401048760966745]},{"name":"绥化市","coord":[126.5214484055605,46.76992452194825]},{"name":"松原市","coord":[124.21244334807682,44.75779381338502]},{"name":"四平市","coord":[124.27839350328821,43.52139065090318]},{"name":"通化市","coord":[125.67392830706305,41.91771808663852]},{"name":"辽源市","coord":[125.33529527643432,42.758340204944986]},{"name":"吉林市","coord":[126.83350281902375,43.60730120049175]},{"name":"长春市","coord":[125.53597875970374,44.24624314701737]},{"name":"白山市","coord":[127.16780160322108,42.093893880305075]},{"name":"哈尔滨市","coord":[127.39125008786029,45.36200668820575]},{"name":"鹤岗市","coord":[130.4703811258197,47.66520688940109]},{"name":"伊春市","coord":[128.91240831703635,47.93833794565277]},{"name":"七台河市","coord":[131.2677920224311,45.945099776108584]},{"name":"鸡西市","coord":[132.38059153660274,45.722934218318535]},{"name":"双鸭山市","coord":[132.3184817002743,46.65813679030265]},{"name":"佳木斯市","coord":[132.26174446608726,47.17569713691394]},{"name":"呼伦贝尔市","coord":[122.3210739998419,50.18176996070858]},{"name":"孝感市","coord":[113.83749892135485,31.11757234692128]},{"name":"贵港市","coord":[110.07354588052804,23.380735604767374]},{"name":"黔南布依族苗族自","coord":[107.30931767543106,26.2976919432269]},{"name":"宁德市","coord":[119.52482556634342,27.013151692716413]},{"name":"温州市","coord":[120.30037042732202,27.8699145504001]},{"name":"台州市","coord":[120.88886782713843,28.670799172772313]},{"name":"丽水市","coord":[119.56796851966463,28.170268394477755]},{"name":"衢州市","coord":[118.79479802644406,28.865874397158763]},{"name":"金华市","coord":[119.99381920686633,29.093455548185744]},{"name":"绍兴市","coord":[120.46546691682343,29.69382513836818]},{"name":"宁波市","coord":[121.42142987830871,29.70001162878972]},{"name":"杭州市","coord":[119.4405685790891,29.87218307296989]},{"name":"宣城市","coord":[118.68748382914703,30.628143499626418]},{"name":"湖州市","coord":[119.98261306633574,30.7945175862809]},{"name":"嘉兴市","coord":[120.83889215988998,30.67538495499343]},{"name":"上海市","coord":[121.37534147322967,31.25628247908459]},{"name":"苏州市","coord":[120.6906182622391,31.381280695137775]},{"name":"无锡市","coord":[120.32182300914366,31.54113306724517]},{"name":"常州市","coord":[119.61953292830165,31.611878565375576]},{"name":"南京市","coord":[118.71890548838064,31.910863187910323]},{"name":"镇江市","coord":[119.42349332902813,31.97942313430778]},{"name":"合肥市","coord":[117.30651975617157,31.79407863049138]},{"name":"六安市","coord":[116.24668220575353,31.820846193819513]},{"name":"滁州市","coord":[117.88422385307969,32.51792621904418]},{"name":"泰州市","coord":[120.03124303305091,32.56503102346783]},{"name":"南通市","coord":[120.85599446760912,32.18496706099728]},{"name":"盐城市","coord":[120.01812490612667,33.54219948734023]},{"name":"淮安市","coord":[119.0749424205415,33.39203631772854]},{"name":"宿迁市","coord":[118.45404943216346,33.666258719120265]},{"name":"徐州市","coord":[117.77482249295966,34.30847766157078]},{"name":"济宁市","coord":[116.74147276546373,35.27488504351119]},{"name":"枣庄市","coord":[117.43359942491492,34.884162021736]},{"name":"连云港市","coord":[119.01553213785074,34.54316517587849]},{"name":"临沂市","coord":[118.31478835349617,35.28173079028279]},{"name":"日照市","coord":[119.14265350444272,35.54479073199592]},{"name":"青岛市","coord":[120.27779044405756,36.3464117375903]},{"name":"威海市","coord":[122.12963327195605,37.13879077904251]},{"name":"烟台市","coord":[120.7689567423966,37.19772002195597]},{"name":"潍坊市","coord":[119.02178548592039,36.49292234053931]},{"name":"淄博市","coord":[117.92936024367185,36.60871347163638]},{"name":"泰安市","coord":[116.93810893944303,36.0423330118612]},{"name":"济南市","coord":[117.34560282551296,36.769574973846304]},{"name":"东营市","coord":[118.4915054457184,37.52194690335787]},{"name":"滨州市","coord":[117.67610299757533,37.4439597758601]},{"name":"昆明市","coord":[102.93100245594789,25.481300763922075]},{"name":"玉溪市","coord":[102.23080854291823,24.156168324611663]},{"name":"塔城地区","coord":[83.60908162840168,45.3721852373893]},{"name":"张掖市","coord":[100.47710030600572,38.704239320458385]},{"name":"南阳市","coord":[112.1400670951149,33.03033276715801]},{"name":"扬州市","coord":[119.48949608990988,32.80956776339646]},{"name":"延边朝鲜族自治州","coord":[129.3577692895626,43.24968794080283]},{"name":"牡丹江市","coord":[129.87240796405672,44.7073040108322]},{"name":"澳门","coord":[113.56289691515346,22.14602596262204]},{"name":"吴忠市","coord":[106.76894508116403,37.72566765880316]},{"name":"来宾市","coord":[109.25592217010114,23.86346274681084]},{"name":"平凉市","coord":[107.0708132782897,35.30329631658711]},{"name":"马鞍山市","coord":[118.27245878467022,31.657727937739004]},{"name":"芜湖市","coord":[118.32992684415504,31.081688223101658]},{"name":"澄迈县","coord":[110.04198076060266,19.694955078668105]},{"name":"保亭黎族苗族自治","coord":[109.6055304964257,18.6101488675304]},{"name":"乐东黎族自治县","coord":[109.04051999525574,18.643137437909203]},{"name":"儋州市","coord":[109.3431358337404,19.550974957403195]},{"name":"定安县","coord":[110.38744429685676,19.47557074114284]},{"name":"屯昌县","coord":[110.00574767630334,19.367175093044388]},{"name":"白沙黎族自治县","coord":[109.36860737761768,19.214416393082217]},{"name":"琼中黎族苗族自治","coord":[109.86691465937548,19.073671135862682]},{"name":"东方市","coord":[108.86903802405428,19.017352815445214]},{"name":"昌江黎族自治县","coord":[108.9686431884767,19.182594167127824]},{"name":"海口市","coord":[110.420654296875,19.806565564640795]},{"name":"济源市","coord":[112.38051465474433,35.07958362422394]},{"name":"五指山市","coord":[109.53595187364496,18.832908264613966]},{"name":"大连市","coord":[121.96662235866603,39.444150542439914]},{"name":"文昌市三沙市","coord":[110.81828537536748,19.756501444162936]},{"name":"三亚市","coord":[109.38424600793707,18.39186315877128]},{"name":"万宁市","coord":[110.28485046979574,18.860240588635115]},{"name":"陵水黎族自治县","coord":[109.95577603229562,18.594712684620465]},{"name":"临高县","coord":[109.71915395436967,19.79420403032508]},{"name":"琼海市","coord":[110.41650700703043,19.22315873149372]}]')},y7ZN:function(e,a,n){!function(e){var t,i;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*!
* 	   Copyright (c) 2016 @thinkinggis
* 	   Copyright© 2000-2017 SuperMap Software Co. Ltd
*     echartsLayer.
*     github: https://github.com/SuperMap/echartsLayer
*     license: MIT
*/
i=function(i){return a=[function(e,t){e.exports=i},function(e,t,i){i(2);i=i(6);e.exports=i},function(e,t,i){t=function(e){return i(0).registerCoordinateSystem("GLMap",i(3)),i(4),i(5),i(0).registerAction({type:"GLMapRoam",event:"GLMapRoam",update:"updateLayout"},function(e,t){}),{version:"1.0.0"}}.call(t,i,t,e);void 0===t||(e.exports=t)},function(e,t,i){t=function(e){var a=i(0);function n(e,t){this._GLMap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t}return n.prototype.dimensions=["lng","lat"],n.prototype.setMapOffset=function(e){this._mapOffset=e},n.prototype.getBMap=function(){return this._GLMap},n.prototype.fixLat=function(e){return 90<=e?89.99999999999999:e<=-90?-89.99999999999999:e},n.prototype.dataToPoint=function(e){e[1]=this.fixLat(e[1]);var t=this._GLMap.project(e),e=this._mapOffset;return[t.x-e[0],t.y-e[1]]},n.prototype.pointToData=function(e){var t=this._mapOffset;return[(e=this._bmap.project([e[0]+t[0],e[1]+t[1]])).lng,e.lat]},n.prototype.getViewRect=function(){var e=this._api;return new a.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},n.prototype.getRoamTransform=function(){return a.matrix.create()},n.prototype.prepareCustoms=function(e){var t=a.util,i=this.getViewRect();return{coordSys:{type:"GLMap",x:i.x,y:i.y,width:i.width,height:i.height},api:{coord:t.bind(this.dataToPoint,this),size:t.bind(function(n,o){return o=o||[0,0],t.map([0,1],function(e){var t=o[e],i=n[e]/2,r=[],a=[];return r[e]=t-i,a[e]=t+i,r[1-e]=a[1-e]=o[1-e],Math.abs(this.dataToPoint(r)[e]-this.dataToPoint(a)[e])},this)},this)}}},n.dimensions=n.prototype.dimensions,n.create=function(e,i){var r;e.eachComponent("GLMap",function(e){i.getZr().painter.getViewportRoot();var t=a.glMap;(r=new n(t,i)).setMapOffset(e.__mapOffset||[0,0]),e.coordinateSystem=r}),e.eachSeries(function(e){"GLMap"===e.get("coordinateSystem")&&(e.coordinateSystem=r)})},n}.call(t,i,t,e);void 0===t||(e.exports=t)},function(e,t,i){t=function(e){return i(0).extendComponentModel({type:"GLMap",getBMap:function(){return this.__GLMap},defaultOption:{roam:!1}})}.call(t,i,t,e);void 0===t||(e.exports=t)},function(e,t,i){t=function(e){return i(0).extendComponentView({type:"GLMap",render:function(r,e,a){function t(e,t){var i;n||(i=document.getElementsByClassName("mapboxgl-map")[0],i=[-parseInt(i.style.left,10)||0,-parseInt(i.style.top,10)||0],o.style.left=i[0]+"px",o.style.top=i[1]+"px",s.setMapOffset(i),r.__mapOffset=i,a.dispatchAction({type:"GLMapRoam"}))}var n=!0,i=echarts.glMap,o=a.getZr().painter.getViewportRoot(),s=r.coordinateSystem;function l(){n||a.dispatchAction({type:"GLMapRoam"})}i.off("move",this._oldMoveHandler),i.off("zoomend",this._oldZoomEndHandler),i.on("move",t),i.on("zoomend",l),this._oldMoveHandler=t,this._oldZoomEndHandler=l;r.get("roam");n=!1}})}.call(t,i,t,e);void 0===t||(e.exports=t)},function(e,t){function i(e){var t=e.getCanvasContainer();this._container=document.createElement("div"),this._container.style.width=e.getCanvas().style.width,this._container.style.height=e.getCanvas().style.height,this._container.setAttribute("id","echarts"),this._container.setAttribute("class","echartMap"),this._map=e,t.appendChild(this._container),this.chart=echarts.init(this._container),echarts.glMap=e,this.resize()}i.prototype.remove=function(){var t=this;this._map._listeners.move.forEach(function(e){"moveHandler"===e.name&&t._map.off("move",e)}),this._map._listeners.move.forEach(function(e){"zoomEndHandler"===e.name&&t._map.off("zoomend",e)}),this.chart.clear(),this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._map=void 0},i.prototype.resize=function(){var e=this;window.onresize=function(){e._container.style.width=e._map.getCanvas().style.width,e._container.style.height=e._map.getCanvas().style.height,e.chart.resize()}},e.exports=i}],n={},r.m=a,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1);function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var a,n},"object"===r(a)&&"object"===r(e)?e.exports=i(n("MT78")):(t=[n("MT78")],void 0===(i="function"==typeof(i=i)?i.apply(a,t):i)||(e.exports=i))}.call(this,n("YuTi")(e))}}]);